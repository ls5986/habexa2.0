import{c as le,r as n,o as d,aq as Te,M as Ce,j as e,C as B,b as U,p as J,B as l,T as o,d as Z,F as q,a as x,h as P,ar as Ne,k as Re,q as k,l as Be,a5 as we,a6 as Se,a7 as ke,as as Ue,w as Ae,I as $e,O as De,Q as We,V as Ie,D as Ye,ac as xe,ad as qe,i as Ve,u as Oe,at as He,x as Ge,f as Ke,au as be}from"./index-CWAbI_84.js";import{C as _e}from"./check-circle-BmT67hmn.js";import{M as pe}from"./message-circle-hlMZnhUJ.js";import{b as Qe,c as Je,d as Xe}from"./Stepper-C55H4-wY.js";import{P as Ze}from"./plus-BJNftltY.js";import{L as Fe,S as ve}from"./Switch-Qib5RASb.js";import{T as et}from"./trash-2-BTpuFs4Y.js";import{D as Le}from"./DialogActions-CSIKrx3Z.js";import{T as tt,a as ne}from"./Tabs-CLK7YeYR.js";import{S as Pe}from"./Slider-BgJH45HG.js";import{T as at,a as st,b as rt,c as ge}from"./TableRow-C7FEYZNH.js";import{E as nt}from"./external-link-CQb_kU7C.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=le("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=le("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=le("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=le("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=le("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),ct=()=>{const[z,r]=n.useState(null),[u,$]=n.useState(null),[T,N]=n.useState(null),[A,w]=n.useState(!0),[D,S]=n.useState(null),W=async()=>{try{const i=await d.get("/settings/profile");r(i.data)}catch(i){S(i.message)}},R=async()=>{try{const i=await d.get("/settings/alerts");$(i.data)}catch(i){S(i.message)}},O=async()=>{try{const i=await d.get("/settings/costs");N(i.data)}catch(i){S(i.message)}};return n.useEffect(()=>{(async()=>{w(!0),await Promise.all([W(),R(),O()]),w(!1)})()},[]),{profile:z,alertSettings:u,costSettings:T,loading:A,error:D,refetch:async()=>{await Promise.all([W(),R(),O()])},updateProfile:async i=>{var p,E;try{const _=await d.put("/settings/profile",i);return r(_.data),_.data}catch(_){throw new Error(((E=(p=_.response)==null?void 0:p.data)==null?void 0:E.detail)||"Failed to update profile")}},updateAlertSettings:async i=>{var p,E;try{const _=await d.put("/settings/alerts",i);return $(_.data),_.data}catch(_){throw new Error(((E=(p=_.response)==null?void 0:p.data)==null?void 0:E.detail)||"Failed to update alert settings")}},updateCostSettings:async i=>{var p,E;try{const _=await d.put("/settings/costs",i);return N(_.data),_.data}catch(_){throw new Error(((E=(p=_.response)==null?void 0:p.data)==null?void 0:E.detail)||"Failed to update cost settings")}}}};function dt(){const[z,r]=Te(),[u,$]=n.useState(null),[T,N]=n.useState(!0),[A,w]=n.useState(!1),[D,S]=n.useState(null),{showToast:W}=Ce();n.useEffect(()=>{if(R(),z.get("amazon_connected")==="true"&&(S({type:"success",text:"Amazon connected successfully!"}),W("Amazon account connected successfully!","success"),z.delete("amazon_connected"),r(z,{replace:!0}),R()),z.get("amazon_error")){const s=z.get("amazon_error");S({type:"error",text:s}),W(`Connection failed: ${s}`,"error"),z.delete("amazon_error"),r(z,{replace:!0})}},[]);const R=async()=>{try{const s=await d.get("/integrations/amazon/connection");$(s.data)}catch(s){console.error("Failed to fetch connection:",s),$({connected:!1})}finally{N(!1)}},O=async()=>{var s,F;w(!0);try{const i=await d.get("/integrations/amazon/oauth/authorize");window.location.href=i.data.authorization_url}catch(i){const p=((F=(s=i.response)==null?void 0:s.data)==null?void 0:F.detail)||"Failed to start connection";S({type:"error",text:p}),W(p,"error"),w(!1)}},f=async()=>{var s,F;if(confirm("Disconnect your Amazon account? You will need to reconnect to check gating status and get accurate fees."))try{await d.delete("/integrations/amazon/disconnect"),$({connected:!1}),S({type:"success",text:"Disconnected successfully"}),W("Amazon account disconnected","success"),R()}catch(i){const p=((F=(s=i.response)==null?void 0:s.data)==null?void 0:F.detail)||"Failed to disconnect";S({type:"error",text:p}),W(p,"error")}};return T?e.jsx(B,{children:e.jsx(U,{sx:{textAlign:"center",py:4},children:e.jsx(J,{})})}):e.jsx(B,{children:e.jsxs(U,{children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(ze,{size:32,style:{color:"#FF9900"}}),e.jsxs(l,{flex:1,children:[e.jsx(o,{variant:"h6",fontWeight:600,children:"Amazon Seller Account"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Connect to check YOUR gating status and fees"})]}),(u==null?void 0:u.connected)&&e.jsx(Z,{icon:e.jsx(_e,{size:16}),label:"Connected",color:"success"})]}),D&&e.jsx(q,{severity:D.type,sx:{mb:2},onClose:()=>S(null),children:D.text}),u!=null&&u.connected?e.jsxs(l,{children:[e.jsxs(l,{mb:2,children:[e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Seller ID:"})," ",u.seller_id||"Not available"]}),e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Marketplace:"})," ",u.marketplace_id||"US"]}),u.connected_at&&e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Connected:"})," ",new Date(u.connected_at).toLocaleDateString()]}),u.last_used_at&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Last used:"})," ",new Date(u.last_used_at).toLocaleString()]})]}),e.jsx(x,{variant:"outlined",color:"error",startIcon:e.jsx(Ee,{size:18}),onClick:f,children:"Disconnect"})]}):e.jsxs(l,{children:[e.jsx(q,{severity:"info",sx:{mb:2},children:"Connect your Amazon Seller account to see YOUR eligibility status on products. Each user connects their own account and sees their own gating status."}),e.jsx(x,{variant:"contained",size:"large",startIcon:A?e.jsx(J,{size:20,color:"inherit"}):e.jsx(ze,{size:20}),onClick:O,disabled:A,sx:{bgcolor:"#FF9900","&:hover":{bgcolor:"#E88B00"},color:"#000"},children:A?"Connecting...":"Connect Amazon"})]}),!(u!=null&&u.connected)&&e.jsxs(l,{sx:{mt:3,p:2,bgcolor:P.gray[50],borderRadius:2,border:"1px solid",borderColor:P.gray[200]},children:[e.jsx(o,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"ðŸ”“ Why Connect?"}),e.jsxs(l,{component:"ul",sx:{m:0,pl:2.5},children:[e.jsx("li",{children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Real gating checks"})," â€” Know if YOU can list a product, not just estimates"]})}),e.jsx("li",{children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Accurate FBA fees"})," â€” Get exact fees from Amazon for your account"]})}),e.jsx("li",{children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Better analysis"})," â€” More accurate profit calculations based on your account"]})})]})]})]})})}const ut=["Enter Phone","Verify Code","Connected"],ht=()=>{const z=Ne(),[r,u]=n.useState(null),[$,T]=n.useState(!0),[N,A]=n.useState(0),[w,D]=n.useState(""),[S,W]=n.useState(""),[R,O]=n.useState(""),[f,s]=n.useState(!1),[F,i]=n.useState(!1),[p,E]=n.useState([]),[_,ae]=n.useState([]),[se,I]=n.useState(!1),[ee,oe]=n.useState(!1),[H,G]=n.useState({}),[m,Y]=n.useState(null),[y,j]=n.useState({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),{showToast:h}=Ce(),{getLimit:ie,isLimitReached:K}=Re();n.useEffect(()=>{Q()},[]);const Q=async()=>{try{const t=await d.get("/integrations/telegram/status");u(t.data),t.data.connected&&X()}catch(t){console.error("Failed to fetch Telegram status:",t)}finally{T(!1)}},X=async()=>{try{const t=await d.get("/integrations/telegram/channels");E(t.data.channels||[])}catch(t){console.error("Failed to fetch channels:",t)}},ce=async()=>{var t,c;if(!w.trim()){h("Please enter your phone number","error");return}i(!0);try{const g=await d.post("/integrations/telegram/auth/start",{phone_number:w});h("Verification code sent to your Telegram app","success"),A(1)}catch(g){h(((c=(t=g.response)==null?void 0:t.data)==null?void 0:c.detail)||"Failed to send code","error")}finally{i(!1)}},de=async()=>{var t,c;if(!S.trim()){h("Please enter the verification code","error");return}i(!0);try{const g=await d.post("/integrations/telegram/auth/verify",{code:S,password:f?R:void 0});g.data.status==="2fa_required"?(s(!0),h("Please enter your 2FA password","warning")):g.data.status==="connected"&&(h("Telegram connected successfully!","success"),A(2),Q())}catch(g){h(((c=(t=g.response)==null?void 0:t.data)==null?void 0:c.detail)||"Verification failed","error")}finally{i(!1)}},b=async()=>{if(confirm("Disconnect Telegram? You will stop receiving deals from your channels."))try{await d.delete("/integrations/telegram/disconnect"),u({connected:!1}),E([]),A(0),D(""),W(""),h("Telegram disconnected","success")}catch{h("Failed to disconnect","error")}},M=async()=>{var t,c;oe(!0);try{const g=await d.get("/integrations/telegram/channels/available");ae(g.data.channels||[]),I(!0)}catch(g){h(((c=(t=g.response)==null?void 0:t.data)==null?void 0:c.detail)||"Failed to fetch channels","error")}finally{oe(!1)}},V=t=>{Y(t),j({...y,supplierName:t.title||t.name||""})},re=async(t=null)=>{var g,L;const c=t||m;if(c)try{const te={channel_id:c.id,channel_name:c.name||c.title,channel_username:c.username,channel_type:c.type||"channel",create_supplier:y.createSupplier,supplier_name:y.supplierName||c.name||c.title,supplier_website:y.supplierWebsite||null,supplier_contact_email:y.supplierEmail||null,supplier_notes:y.supplierNotes||null},ue=await d.post("/integrations/telegram/channels",te);h(`Added ${c.name}${ue.data.supplier_id?" and created supplier":""}`,"success"),Y(null),j({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),X(),Q(),ae(he=>he.map(a=>a.id===c.id?{...a,is_monitored:!0}:a)),se&&I(!1)}catch(te){h(((L=(g=te.response)==null?void 0:g.data)==null?void 0:L.detail)||"Failed to add channel","error")}},me=async t=>{var c,g;G(L=>({...L,[t]:!0}));try{const L=await d.post(`/integrations/telegram/channels/${t}/backfill?days=14`);h(`Synced ${L.data.messages} messages, found ${L.data.deals} deals`,"success"),X()}catch(L){h("Failed to sync: "+(((g=(c=L.response)==null?void 0:c.data)==null?void 0:g.detail)||L.message),"error")}finally{G(L=>({...L,[t]:!1}))}},fe=async t=>{try{await d.delete(`/integrations/telegram/channels/${t}`),h("Channel removed","success"),X(),Q()}catch{h("Failed to remove channel","error")}},ye=async()=>{var t,c;try{const g=await d.post("/integrations/telegram/monitoring/start");h(`Monitoring ${g.data.channels} channels`,"success"),Q()}catch(g){h(((c=(t=g.response)==null?void 0:t.data)==null?void 0:c.detail)||"Failed to start monitoring","error")}},je=async()=>{try{await d.post("/integrations/telegram/monitoring/stop"),h("Monitoring stopped","success"),Q()}catch{h("Failed to stop monitoring","error")}};return $?e.jsx(B,{children:e.jsx(U,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(J,{})})}):e.jsx(B,{children:e.jsxs(U,{children:[e.jsxs(l,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:2,children:[e.jsxs(l,{children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(pe,{size:20,style:{color:"#0088cc"}}),e.jsx(o,{variant:"h6",fontWeight:600,children:"Telegram Monitoring"}),e.jsx(Z,{icon:r!=null&&r.connected?e.jsx(_e,{size:16}):void 0,label:r!=null&&r.connected?"Connected":"Not Connected",color:r!=null&&r.connected?"success":"default",size:"small"}),(r==null?void 0:r.monitoring)&&e.jsx(Z,{label:"Monitoring",color:"primary",size:"small"})]}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Auto-extract deals from supplier channels"})]}),(r==null?void 0:r.connected)&&e.jsx(x,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(Ee,{size:18}),onClick:b,children:"Disconnect"})]}),!(r!=null&&r.connected)&&e.jsxs(l,{children:[e.jsx(Qe,{activeStep:N,sx:{mb:3},children:ut.map(t=>e.jsx(Je,{children:e.jsx(Xe,{children:t})},t))}),N===0&&e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:2,children:"Enter your phone number to connect your Telegram account. We'll send a verification code to your Telegram app."}),e.jsx(k,{label:"Phone Number",placeholder:"+1 234 567 8900",value:w,onChange:t=>D(t.target.value),fullWidth:!0,sx:{mb:2},helperText:"Include country code (e.g., +1 for US)"}),e.jsx(x,{variant:"contained",onClick:ce,disabled:F,startIcon:F?e.jsx(J,{size:16}):e.jsx(pe,{size:18}),sx:{bgcolor:"#0088cc","&:hover":{bgcolor:"#006699"}},children:F?"Sending...":"Send Code"})]}),N===1&&e.jsxs(l,{children:[e.jsx(q,{severity:"info",sx:{mb:2},children:"Check your Telegram app for the verification code"}),e.jsx(k,{label:"Verification Code",placeholder:"12345",value:S,onChange:t=>W(t.target.value.replace(/\D/g,"")),fullWidth:!0,autoFocus:!0,inputProps:{maxLength:5,inputMode:"numeric",pattern:"[0-9]*"},sx:{mb:2},helperText:"Enter the 5-digit code from Telegram"}),f&&e.jsx(k,{label:"2FA Password",type:"password",autoComplete:"current-password",value:R,onChange:t=>O(t.target.value),fullWidth:!0,sx:{mb:2},helperText:"Your Telegram 2FA password"}),e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(x,{variant:"outlined",onClick:()=>{A(0),W(""),s(!1)},children:"Back"}),e.jsx(x,{variant:"contained",onClick:de,disabled:F,startIcon:F?e.jsx(J,{size:16}):e.jsx(_e,{size:18}),children:F?"Verifying...":"Verify"})]})]})]}),(r==null?void 0:r.connected)&&e.jsxs(l,{children:[e.jsx(l,{mb:2,children:e.jsx(Be,{label:"Monitored Channels",used:p.length,limit:(r==null?void 0:r.channel_limit)||ie("telegram_channels")})}),e.jsxs(l,{display:"flex",gap:1,mb:2,children:[r!=null&&r.monitoring?e.jsx(x,{variant:"outlined",color:"warning",startIcon:e.jsx(it,{size:18}),onClick:je,children:"Stop Monitoring"}):e.jsx(x,{variant:"contained",color:"success",startIcon:e.jsx(lt,{size:18}),onClick:ye,disabled:p.length===0,children:"Start Monitoring"}),e.jsx(x,{variant:"outlined",startIcon:ee?e.jsx(J,{size:16}):e.jsx(Ze,{size:18}),onClick:M,disabled:ee||K("telegram_channels",p.length),children:"Add Channel"})]}),(p||[]).length>0?e.jsx(we,{dense:!0,children:(p||[]).map(t=>e.jsxs(Se,{children:[e.jsx(Fe,{children:e.jsx(pe,{size:18,style:{color:z.palette.primary.main}})}),e.jsx(ke,{primary:t.channel_name,secondary:e.jsxs(l,{display:"flex",gap:2,children:[e.jsxs("span",{children:[t.messages_received||0," messages"]}),e.jsxs("span",{children:[t.deals_extracted||0," deals"]})]}),secondaryTypographyProps:{component:"div"}}),e.jsx(Ue,{children:e.jsxs(l,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(Ae,{title:"Sync last 14 days of messages",children:e.jsx(x,{size:"small",variant:"outlined",onClick:()=>me(t.channel_id),disabled:H[t.channel_id],startIcon:H[t.channel_id]?e.jsx(J,{size:14}):e.jsx(ot,{size:14}),children:H[t.channel_id]?"Syncing...":"Sync 14 Days"})}),e.jsx(Ae,{title:"Remove channel",children:e.jsx($e,{edge:"end",size:"small",onClick:()=>fe(t.channel_id),children:e.jsx(et,{size:18})})})]})})]},t.id))}):e.jsx(q,{severity:"info",children:'No channels added yet. Click "Add Channel" to select channels to monitor.'}),(r==null?void 0:r.monitoring)&&e.jsxs(l,{mt:2,p:2,sx:{bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:2},children:[e.jsx(o,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Monitoring Active"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Deals will be automatically extracted and appear in your feed."})]})]}),e.jsxs(De,{open:se,onClose:()=>{I(!1),Y(null),j({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},maxWidth:"sm",fullWidth:!0,children:[e.jsx(We,{children:"Add Telegram Channel"}),e.jsx(Ie,{dividers:!0,children:(_||[]).length>0?e.jsxs(e.Fragment,{children:[e.jsx(we,{children:(_||[]).map(t=>e.jsxs(Se,{button:!0,selected:(m==null?void 0:m.id)===t.id,onClick:()=>V(t),children:[e.jsx(Fe,{children:e.jsx(pe,{size:20})}),e.jsx(ke,{primary:t.name,secondary:`${t.type} â€¢ ${t.member_count||"?"} members`}),t.is_monitored&&e.jsx(Z,{label:"Monitoring",size:"small",color:"success",sx:{ml:2}})]},t.id))}),m&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{sx:{my:2}}),e.jsxs(l,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2},children:[e.jsxs(o,{variant:"subtitle2",color:"primary",children:["Selected: ",m.name||m.title]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["@",m.username||"no-username"]})]}),e.jsx(xe,{control:e.jsx(qe,{checked:y.createSupplier,onChange:t=>j({...y,createSupplier:t.target.checked})}),label:"Create as Supplier"}),y.createSupplier&&e.jsxs(l,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(k,{label:"Supplier Name",value:y.supplierName,onChange:t=>j({...y,supplierName:t.target.value}),placeholder:(m==null?void 0:m.name)||(m==null?void 0:m.title)||"Supplier name",fullWidth:!0,size:"small"}),e.jsx(k,{label:"Website (optional)",value:y.supplierWebsite,onChange:t=>j({...y,supplierWebsite:t.target.value}),placeholder:"https://...",fullWidth:!0,size:"small"}),e.jsx(k,{label:"Contact Email (optional)",value:y.supplierEmail,onChange:t=>j({...y,supplierEmail:t.target.value}),placeholder:"contact@supplier.com",fullWidth:!0,size:"small"}),e.jsx(k,{label:"Notes (optional)",value:y.supplierNotes,onChange:t=>j({...y,supplierNotes:t.target.value}),placeholder:"Any notes about this supplier...",multiline:!0,rows:2,fullWidth:!0,size:"small"})]})]})]}):e.jsx(o,{color:"text.secondary",textAlign:"center",py:4,children:"No channels found. Make sure you're a member of some Telegram channels or groups."})}),e.jsxs(Le,{children:[e.jsx(x,{onClick:()=>{I(!1),Y(null),j({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},children:"Cancel"}),e.jsx(x,{variant:"contained",onClick:()=>re(),disabled:!m||K("telegram_channels",p.length),children:"Add Channel"})]})]})]})})},St=()=>{var te,ue,he;const[z]=Te(),r=z.get("tab"),u={profile:0,integrations:1,alerts:2,costs:3,billing:4},$=r&&u[r]!==void 0?u[r]:0,[T,N]=n.useState($);n.useEffect(()=>{r&&u[r]!==void 0&&N(u[r])},[r,z]);const{profile:A,alertSettings:w,costSettings:D,loading:S,updateProfile:W,updateAlertSettings:R,updateCostSettings:O}=ct(),{showToast:f}=Ce(),{subscription:s,openPortal:F,cancelSubscription:i,reactivateSubscription:p,refreshSubscription:E}=Ve(),_=Oe(),[ae,se]=n.useState([]),[I,ee]=n.useState(null),[oe,H]=n.useState(!1),[G,m]=n.useState(!1),[Y,y]=n.useState({full_name:"",avatar_url:""}),[j,h]=n.useState({current_password:"",new_password:"",confirm_password:""}),[ie,K]=n.useState(""),[Q,X]=n.useState(!1),[ce,de]=n.useState(!1),[b,M]=n.useState({min_roi:20,min_profit:3,max_rank:1e5,alerts_enabled:!0,alert_min_roi:30,alert_channels:["push","email"]}),[V,re]=n.useState({inbound_rate_per_lb:.35,default_prep_cost:.1});n.useEffect(()=>{A&&y({full_name:A.full_name||"",avatar_url:A.avatar_url||""})},[A]),n.useEffect(()=>{w&&M({min_roi:w.min_roi||20,min_profit:w.min_profit||3,max_rank:w.max_rank||1e5,alerts_enabled:w.alerts_enabled!==!1,alert_min_roi:w.alert_min_roi||30,alert_channels:w.alert_channels||["push","email"]})},[w]),n.useEffect(()=>{D&&re({inbound_rate_per_lb:D.inbound_rate_per_lb||D.default_inbound_shipping||.35,default_prep_cost:D.default_prep_cost||.1})},[D]),n.useEffect(()=>{T===4&&(async()=>{try{const[v,C]=await Promise.all([d.get("/billing/invoices"),d.get("/billing/usage")]);se(v.data.invoices||[]),ee(C.data)}catch(v){console.error("Failed to fetch billing data:",v);try{const C=await d.get("/billing/invoices");se(C.data.invoices||[])}catch(C){console.error("Failed to fetch invoices:",C)}try{const C=await d.get("/billing/usage");ee(C.data)}catch(C){console.error("Failed to fetch usage:",C)}}})()},[T]);const me=async()=>{try{const a=await d.get("/billing/usage");ee(a.data)}catch(a){console.error("Failed to fetch usage:",a)}},fe=async(a=!1)=>{var v,C;m(!0);try{a?(await d.post("/billing/cancel-immediately"),f("Subscription cancelled. You've been moved to the Free plan.","info")):(await i(!0),f("Subscription will cancel at end of billing period","info")),H(!1),await E(),await me()}catch(Me){f(((C=(v=Me.response)==null?void 0:v.data)==null?void 0:C.detail)||"Failed to cancel subscription","error")}finally{m(!1)}},ye=async()=>{m(!0);try{await p(),f("Subscription reactivated","success")}catch{f("Failed to reactivate subscription","error")}finally{m(!1)}},je=async()=>{m(!0);try{await F()}catch{f("Failed to open billing portal","error"),m(!1)}},t=async()=>{try{await W(Y),f("Profile updated successfully","success")}catch(a){f(a.message||"Failed to update profile","error")}},c=async()=>{try{await R(b),f("Alert settings saved","success")}catch(a){f(a.message||"Failed to save alert settings","error")}},g=async()=>{try{const a={inbound_rate_per_lb:V.inbound_rate_per_lb,default_prep_cost:V.default_prep_cost,default_inbound_shipping:V.inbound_rate_per_lb};await O(a),f("Cost settings saved","success")}catch(a){f(a.message||"Failed to save cost settings","error")}},L=async()=>{if(K(""),X(!1),j.new_password!==j.confirm_password){K("New passwords do not match");return}if(j.new_password.length<8){K("Password must be at least 8 characters");return}de(!0);try{const{data:{user:a}}=await be.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:v}=await be.auth.signInWithPassword({email:a.email,password:j.current_password});if(v){K("Current password is incorrect"),f("Current password is incorrect","error");return}const{error:C}=await be.auth.updateUser({password:j.new_password});if(C)throw C;X(!0),h({current_password:"",new_password:"",confirm_password:""}),f("Password changed successfully","success")}catch(a){K(a.message||"Failed to change password"),f(a.message||"Failed to change password","error")}finally{de(!1)}};return S?e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(J,{})}):e.jsxs(l,{children:[e.jsx(o,{variant:"h4",fontWeight:700,mb:4,children:"Settings"}),e.jsxs(tt,{value:T,onChange:(a,v)=>N(v),sx:{mb:4},children:[e.jsx(ne,{label:"Profile"}),e.jsx(ne,{label:"Integrations"}),e.jsx(ne,{label:"Alerts"}),e.jsx(ne,{label:"Costs"}),e.jsx(ne,{label:"Billing"})]}),T===0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:3,children:"Profile Settings"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(k,{label:"Full Name",value:Y.full_name,onChange:a=>y({...Y,full_name:a.target.value}),fullWidth:!0}),e.jsx(k,{label:"Avatar URL",value:Y.avatar_url,onChange:a=>y({...Y,avatar_url:a.target.value}),fullWidth:!0,placeholder:"https://..."}),e.jsx(x,{variant:"contained",onClick:t,sx:{backgroundColor:P.purple.main,"&:hover":{backgroundColor:P.purple.dark},alignSelf:"flex-start"},children:"Save Profile"})]})]})}),e.jsx(B,{sx:{mt:3},children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:3,children:"Change Password"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[ie&&e.jsx(q,{severity:"error",children:ie}),Q&&e.jsx(q,{severity:"success",children:"Password changed successfully!"}),e.jsx(k,{label:"Current Password",type:"password",autoComplete:"current-password",value:j.current_password,onChange:a=>h({...j,current_password:a.target.value}),fullWidth:!0,required:!0}),e.jsx(k,{label:"New Password",type:"password",autoComplete:"new-password",value:j.new_password,onChange:a=>h({...j,new_password:a.target.value}),fullWidth:!0,required:!0,inputProps:{minLength:8},helperText:"Must be at least 8 characters"}),e.jsx(k,{label:"Confirm New Password",type:"password",autoComplete:"new-password",value:j.confirm_password,onChange:a=>h({...j,confirm_password:a.target.value}),fullWidth:!0,required:!0}),e.jsx(x,{variant:"contained",onClick:L,disabled:ce,sx:{backgroundColor:P.purple.main,"&:hover":{backgroundColor:P.purple.dark},alignSelf:"flex-start"},children:ce?"Changing...":"Change Password"})]})]})})]}),T===1&&e.jsxs(l,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(dt,{}),e.jsx(ht,{})]}),T===2&&e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:3,children:"Alert Settings"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI for alerts"}),e.jsx(Pe,{value:b.alert_min_roi,onChange:(a,v)=>M({...b,alert_min_roi:v}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:a=>`${a}%`})]}),e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI to consider profitable"}),e.jsx(Pe,{value:b.min_roi,onChange:(a,v)=>M({...b,min_roi:v}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:a=>`${a}%`})]}),e.jsx(k,{label:"Minimum profit per unit",type:"number",value:b.min_profit,onChange:a=>M({...b,min_profit:parseFloat(a.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0}),e.jsx(k,{label:"Maximum sales rank",type:"number",value:b.max_rank,onChange:a=>M({...b,max_rank:parseInt(a.target.value)||0}),fullWidth:!0}),e.jsx(xe,{control:e.jsx(ve,{checked:b.alerts_enabled,onChange:a=>M({...b,alerts_enabled:a.target.checked})}),label:"Enable alerts"}),e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Notification Channels"}),e.jsx(xe,{control:e.jsx(ve,{checked:(te=b.alert_channels)==null?void 0:te.includes("push"),onChange:a=>{const v=b.alert_channels||[];a.target.checked?M({...b,alert_channels:[...v,"push"]}):M({...b,alert_channels:v.filter(C=>C!=="push")})}}),label:"Push notifications"}),e.jsx(xe,{control:e.jsx(ve,{checked:(ue=b.alert_channels)==null?void 0:ue.includes("email"),onChange:a=>{const v=b.alert_channels||[];a.target.checked?M({...b,alert_channels:[...v,"email"]}):M({...b,alert_channels:v.filter(C=>C!=="email")})}}),label:"Email alerts"})]}),e.jsx(x,{variant:"contained",onClick:c,sx:{backgroundColor:P.purple.main,"&:hover":{backgroundColor:P.purple.dark},alignSelf:"flex-start"},children:"Save Settings"})]})]})}),T===3&&e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:1,children:"ðŸ“¦ Shipping & Prep Costs"}),e.jsx(o,{variant:"body2",color:"text.secondary",mb:3,children:"These costs are included in all profit calculations"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(k,{label:"Inbound Shipping Rate",type:"number",step:"0.01",value:V.inbound_rate_per_lb,onChange:a=>re({...V,inbound_rate_per_lb:parseFloat(a.target.value)||0}),InputProps:{startAdornment:e.jsx(InputAdornment,{position:"start",children:"$"}),endAdornment:e.jsx(InputAdornment,{position:"end",children:"/lb"})},fullWidth:!0,helperText:"Cost to ship TO Amazon (typical: $0.30-0.50/lb)"}),e.jsx(k,{label:"Default Prep Cost",type:"number",step:"0.01",value:V.default_prep_cost,onChange:a=>re({...V,default_prep_cost:parseFloat(a.target.value)||0}),InputProps:{startAdornment:e.jsx(InputAdornment,{position:"start",children:"$"}),endAdornment:e.jsx(InputAdornment,{position:"end",children:"/unit"})},fullWidth:!0,helperText:"Labeling, poly bags, etc. (typical: $0.10-0.30)"}),e.jsx(x,{variant:"contained",onClick:g,sx:{backgroundColor:P.purple.main,"&:hover":{backgroundColor:P.purple.dark},alignSelf:"flex-start"},children:"Save Cost Settings"})]})]})}),T===4&&e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(B,{children:e.jsxs(U,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(l,{children:[e.jsx(o,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Current Plan"}),e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(Z,{label:((he=s==null?void 0:s.tier)==null?void 0:he.toUpperCase())||"FREE",color:(s==null?void 0:s.tier)==="free"?"default":"primary",sx:{fontWeight:600}}),(s==null?void 0:s.cancel_at_period_end)&&e.jsx(Z,{label:"Cancels at period end",color:"warning",size:"small"})]}),(s==null?void 0:s.status)==="trialing"&&(s==null?void 0:s.trial_end)&&e.jsxs(q,{severity:"info",sx:{mt:1,mb:1},children:["ðŸŽ‰ Free trial ends ",new Date(s.trial_end).toLocaleDateString()]}),(s==null?void 0:s.current_period_end)&&(s==null?void 0:s.status)!=="trialing"&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Renews: ",new Date(s.current_period_end).toLocaleDateString()]}),(s==null?void 0:s.cancel_at_period_end)&&e.jsxs(q,{severity:"warning",sx:{mt:1},children:["âš ï¸ Cancels on ",s!=null&&s.current_period_end?new Date(s.current_period_end).toLocaleDateString():"period end"]})]}),e.jsxs(l,{display:"flex",gap:1,children:[s!=null&&s.cancel_at_period_end?e.jsx(x,{variant:"outlined",onClick:ye,disabled:G,children:"Reactivate"}):(s==null?void 0:s.tier)!=="free"?e.jsx(x,{variant:"outlined",color:"error",onClick:()=>H(!0),disabled:G,children:"Cancel"}):null,e.jsx(x,{variant:"contained",onClick:()=>_("/pricing"),sx:{backgroundColor:P.purple.main,"&:hover":{backgroundColor:P.purple.dark}},children:(s==null?void 0:s.tier)==="free"?"Upgrade":"Change Plan"})]})]}),(s==null?void 0:s.tier)!=="free"&&e.jsx(x,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(He,{size:18}),onClick:je,disabled:G,sx:{mt:2},children:"Manage Billing & Payment Methods"})]})}),I&&e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:2,children:"Usage This Period"}),e.jsxs(l,{mb:2,children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(o,{variant:"body2",color:"text.secondary",children:"Analyses"}),e.jsxs(o,{variant:"body2",fontWeight:600,children:[I.analyses.used," / ",I.analyses.unlimited?"âˆž":I.analyses.limit]})]}),!I.analyses.unlimited&&e.jsx(Ge,{variant:"determinate",value:Math.min(I.analyses.used/I.analyses.limit*100,100),sx:{height:8,borderRadius:4,backgroundColor:P.gray[200],"& .MuiLinearProgress-bar":{backgroundColor:I.analyses.used>=I.analyses.limit*.9?P.error.main:P.purple.main}}})]})]})}),e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:2,children:"Invoice History"}),ae.length===0?e.jsx(o,{variant:"body2",color:"text.secondary",children:"No invoices yet"}):e.jsx(at,{size:"small",children:e.jsx(st,{children:ae.map(a=>e.jsxs(rt,{children:[e.jsx(ge,{children:e.jsx(o,{variant:"body2",fontWeight:600,children:new Date(a.created_at).toLocaleDateString()})}),e.jsx(ge,{children:e.jsx(o,{variant:"body2",color:"text.secondary",children:Ke((a.amount_paid||a.amount_due||0)/100)})}),e.jsx(ge,{children:e.jsx(Z,{label:a.status,size:"small",color:a.status==="paid"?"success":"default"})}),e.jsx(ge,{align:"right",children:a.stripe_invoice_url&&e.jsx(x,{size:"small",startIcon:e.jsx(nt,{size:14}),href:a.stripe_invoice_url,target:"_blank",children:"View"})})]},a.id))})})]})}),e.jsxs(De,{open:oe,onClose:()=>H(!1),children:[e.jsx(We,{children:"Cancel Subscription?"}),e.jsx(Ie,{children:(s==null?void 0:s.status)==="trialing"?e.jsxs(e.Fragment,{children:[e.jsx(q,{severity:"warning",sx:{mb:2},children:"Your trial will end immediately and you'll be downgraded to the Free plan."}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"You can resubscribe anytime, but won't be eligible for another free trial."})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{severity:"warning",sx:{mb:2},children:"Your subscription will remain active until the end of your current billing period. You'll continue to have access to all features until then."}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"After cancellation, you'll be moved to the Free plan. You can reactivate anytime."})]})}),e.jsxs(Le,{children:[e.jsx(x,{onClick:()=>H(!1),children:"Keep Subscription"}),e.jsx(x,{onClick:()=>fe((s==null?void 0:s.status)==="trialing"),color:"error",variant:"contained",disabled:G,children:G?"Canceling...":"Yes, Cancel"})]})]})]})]})};export{St as default};

import{r as c,i as z,m as N,Q as U,o as Y,j as r,B as h,p as k,T as i,a as v,h as a,K,ak as G,d as P,C as H,S as q,b as D,f as O,ah as Q,ai as J,aj as V}from"./index-BYznCITu.js";import{C as T}from"./Container-BuP4mASq.js";import{S as X,L as Z}from"./Switch-C_sNVs-g.js";import{G as L}from"./Grid-DCzzsCbl.js";import{C as ee}from"./check-CbC0u_It.js";const re=["lindsey@letsclink.com"],le=()=>{const[f,_]=c.useState([]),[W,A]=c.useState(!0),[u,M]=c.useState(!1),[j,b]=c.useState(null),[C,w]=c.useState(null),{subscription:t,createCheckout:F,setTier:I,resubscribe:B}=z(),{user:x}=N(),{showToast:d}=U(),p=(x==null?void 0:x.email)&&re.includes(x.email.toLowerCase());c.useEffect(()=>{S()},[]);const S=async()=>{var e,s;try{const o=await Y.get("/billing/plans");console.log("Plans response:",o.data),o.data&&o.data.plans?_(o.data.plans):(console.error("No plans in response:",o.data),d("Failed to load plans","error"))}catch(o){console.error("Failed to fetch plans:",o),d(((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.detail)||"Failed to load pricing plans","error")}finally{A(!1)}},$=async e=>{var s,o,m,n;if(p){w(e.tier);try{await I(e.tier),d(`Tier switched to ${e.name}`,"success")}catch(l){d(((o=(s=l.response)==null?void 0:s.data)==null?void 0:o.detail)||"Failed to switch tier","error")}finally{w(null)}}else{const l=(t==null?void 0:t.status)==="canceled"||(t==null?void 0:t.status)==="none",R=(t==null?void 0:t.had_free_trial)===!0;b(e.tier);try{const y=u?e.price_keys.yearly:e.price_keys.monthly;l?await B(y):await F(y,!R)}catch(y){d(((n=(m=y.response)==null?void 0:m.data)==null?void 0:n.detail)||"Checkout failed","error")}finally{b(null)}}},E=(e,s)=>typeof s=="boolean"?{text:g(e),included:s}:s===-1?{text:`Unlimited ${g(e)}`,included:!0}:{text:`${s} ${g(e)}`,included:!0},g=e=>e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase());return W?r.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:r.jsx(k,{})}):f.length===0?r.jsx(T,{maxWidth:"lg",sx:{py:8},children:r.jsxs(h,{textAlign:"center",children:[r.jsx(i,{variant:"h4",fontWeight:700,mb:2,children:"No Plans Available"}),r.jsx(i,{variant:"body1",color:"text.secondary",mb:3,children:"Unable to load pricing plans. Please try refreshing the page."}),r.jsx(v,{variant:"contained",onClick:S,sx:{backgroundColor:a.purple.main,"&:hover":{backgroundColor:a.purple.dark}},children:"Retry"})]})}):r.jsxs(T,{maxWidth:"lg",sx:{py:8},children:[r.jsxs(h,{textAlign:"center",mb:6,children:[r.jsx(i,{variant:"h3",fontWeight:700,gutterBottom:!0,children:"Choose Your Plan"}),p&&r.jsx(K,{severity:"info",sx:{mb:2,maxWidth:600,mx:"auto"},children:"Super Admin Mode: You can switch tiers instantly without payment."}),r.jsx(i,{variant:"h6",color:"text.secondary",mb:3,children:p?"Switch between tiers instantly":t!=null&&t.had_free_trial?"Choose your plan to continue using Habexa":"Start with a 7-day free trial. No credit card required."}),r.jsx(G,{control:r.jsx(X,{checked:u,onChange:e=>M(e.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:a.purple.main},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:a.purple.main}}}),label:r.jsxs(i,{children:["Yearly ",r.jsx(P,{label:"Save 17%",size:"small",sx:{ml:1,backgroundColor:a.success.light,color:a.success.main}})]})})]}),r.jsx(L,{container:!0,spacing:4,children:f.map(e=>{const s=u?e.yearly_price:e.monthly_price,o=(t==null?void 0:t.tier)===e.tier,m=Object.entries(e.features).map(([n,l])=>E(n,l));return r.jsx(L,{item:!0,xs:12,md:4,children:r.jsxs(H,{sx:{height:"100%",position:"relative",border:e.popular?`2px solid ${a.purple.main}`:"1px solid",borderColor:e.popular?a.purple.main:"divider",boxShadow:e.popular?"0 8px 24px rgba(124, 106, 250, 0.2)":"none"},children:[e.popular&&r.jsx(P,{icon:r.jsx(q,{size:16}),label:"Most Popular",sx:{position:"absolute",top:16,right:16,backgroundColor:a.purple.main,color:"white",fontWeight:600}}),r.jsxs(D,{sx:{p:4},children:[r.jsx(i,{variant:"h5",fontWeight:700,mb:1,children:e.name}),r.jsx(i,{variant:"body2",color:"text.secondary",mb:3,children:e.description}),r.jsxs(h,{mb:3,children:[r.jsx(i,{variant:"h3",fontWeight:700,component:"span",children:O(s)}),r.jsxs(i,{variant:"body2",color:"text.secondary",component:"span",children:["/",u?"year":"month"]})]}),r.jsx(Q,{sx:{mb:3},children:m.map((n,l)=>r.jsxs(J,{sx:{px:0},children:[r.jsx(Z,{sx:{minWidth:32},children:n.included?r.jsx(ee,{size:20,style:{color:a.success.main}}):r.jsx(h,{sx:{width:20,height:20,borderRadius:"50%",border:`2px solid ${a.gray[300]}`}})}),r.jsx(V,{primary:n.text,primaryTypographyProps:{color:n.included?"text.primary":"text.disabled"}})]},l))}),r.jsx(v,{fullWidth:!0,variant:e.popular?"contained":"outlined",onClick:()=>$(e),disabled:o||j===e.tier||C===e.tier,sx:{backgroundColor:e.popular?a.purple.main:"transparent",borderColor:a.purple.main,color:e.popular?"white":a.purple.main,"&:hover":{backgroundColor:e.popular?a.purple.dark:a.purple.lighter},py:1.5},children:j===e.tier||C===e.tier?r.jsx(k,{size:20}):o?"Current Plan":p?"Switch to This Plan":(t==null?void 0:t.status)==="canceled"||(t==null?void 0:t.status)==="none"?"Resubscribe":t!=null&&t.had_free_trial?"Subscribe":"Start Free Trial"})]})]})},e.tier)})})]})};export{le as default};

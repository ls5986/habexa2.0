import{c as ne,r as n,o as x,aq as De,M as we,j as e,C as R,b as B,p as J,B as l,T as o,d as Z,F as Y,a as g,h as F,ar as Re,k as Be,q as S,l as Ue,a5 as Se,a6 as ke,a7 as Ae,as as $e,w as Fe,I as Ye,O as We,Q as Ie,V as Le,D as qe,ac as fe,ad as Ve,i as Oe,u as He,at as Ge,x as Ke,f as Qe,au as ve}from"./index-D5Lu9gvQ.js";import{C as Ce}from"./check-circle-DwNv_QXB.js";import{M as ge}from"./message-circle-B9LvPmk-.js";import{b as Je,c as Xe,d as Ze}from"./Stepper-BzrxEvi4.js";import{P as et}from"./plus-xqXYkinT.js";import{L as Pe,S as _e}from"./Switch-CtnYwvBM.js";import{T as tt}from"./trash-2-DuEjtvlx.js";import{D as Ee}from"./DialogActions-hQt4FAcL.js";import{T as at,a as re}from"./Tabs-DoXgWvWH.js";import{S as ze}from"./Slider-CQAj5g-7.js";import{T as st,a as rt,b as nt,c as me}from"./TableRow-BE0jwtZO.js";import{E as lt}from"./external-link-DKqSwrhW.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=ne("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=ne("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ne("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ne("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=ne("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),dt=()=>{const[P,r]=n.useState(null),[d,U]=n.useState(null),[z,M]=n.useState(null),[k,_]=n.useState(!0),[T,C]=n.useState(null),D=async()=>{try{const i=await x.get("/settings/profile");r(i.data)}catch(i){C(i.message)}},N=async()=>{try{const i=await x.get("/settings/alerts");U(i.data)}catch(i){C(i.message)}},O=async()=>{try{const i=await x.get("/settings/costs");M(i.data)}catch(i){C(i.message)}};return n.useEffect(()=>{(async()=>{_(!0),await Promise.all([D(),N(),O()]),_(!1)})()},[]),{profile:P,alertSettings:d,costSettings:z,loading:k,error:T,refetch:async()=>{await Promise.all([D(),N(),O()])},updateProfile:async i=>{var h,L;try{const v=await x.put("/settings/profile",i);return r(v.data),v.data}catch(v){throw new Error(((L=(h=v.response)==null?void 0:h.data)==null?void 0:L.detail)||"Failed to update profile")}},updateAlertSettings:async i=>{var h,L;try{const v=await x.put("/settings/alerts",i);return U(v.data),v.data}catch(v){throw new Error(((L=(h=v.response)==null?void 0:h.data)==null?void 0:L.detail)||"Failed to update alert settings")}},updateCostSettings:async i=>{var h,L;try{const v=await x.put("/settings/costs",i);return M(v.data),v.data}catch(v){throw new Error(((L=(h=v.response)==null?void 0:h.data)==null?void 0:L.detail)||"Failed to update cost settings")}}}};function ut(){const[P,r]=De(),[d,U]=n.useState(null),[z,M]=n.useState(!0),[k,_]=n.useState(!1),[T,C]=n.useState(null),{showToast:D}=we();n.useEffect(()=>{if(N(),P.get("amazon_connected")==="true"&&(C({type:"success",text:"Amazon connected successfully!"}),D("Amazon account connected successfully!","success"),P.delete("amazon_connected"),r(P,{replace:!0}),N()),P.get("amazon_error")){const a=P.get("amazon_error");C({type:"error",text:a}),D(`Connection failed: ${a}`,"error"),P.delete("amazon_error"),r(P,{replace:!0})}},[]);const N=async()=>{try{const a=await x.get("/integrations/amazon/connection");U(a.data)}catch(a){console.error("Failed to fetch connection:",a),U({connected:!1})}finally{M(!1)}},O=async()=>{var a,A;_(!0);try{const i=await x.get("/integrations/amazon/oauth/authorize");window.location.href=i.data.authorization_url}catch(i){const h=((A=(a=i.response)==null?void 0:a.data)==null?void 0:A.detail)||"Failed to start connection";C({type:"error",text:h}),D(h,"error"),_(!1)}},f=async()=>{var a,A;if(confirm("Disconnect your Amazon account? You will need to reconnect to check gating status and get accurate fees."))try{await x.delete("/integrations/amazon/disconnect"),U({connected:!1}),C({type:"success",text:"Disconnected successfully"}),D("Amazon account disconnected","success"),N()}catch(i){const h=((A=(a=i.response)==null?void 0:a.data)==null?void 0:A.detail)||"Failed to disconnect";C({type:"error",text:h}),D(h,"error")}};return z?e.jsx(R,{children:e.jsx(B,{sx:{textAlign:"center",py:4},children:e.jsx(J,{})})}):e.jsx(R,{children:e.jsxs(B,{children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Te,{size:32,style:{color:"#FF9900"}}),e.jsxs(l,{flex:1,children:[e.jsx(o,{variant:"h6",fontWeight:600,children:"Amazon Seller Account"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Connect to check YOUR gating status and fees"})]}),(d==null?void 0:d.connected)&&e.jsx(Z,{icon:e.jsx(Ce,{size:16}),label:"Connected",color:"success"})]}),T&&e.jsx(Y,{severity:T.type,sx:{mb:2},onClose:()=>C(null),children:T.text}),d!=null&&d.connected?e.jsxs(l,{children:[e.jsxs(l,{mb:2,children:[e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Seller ID:"})," ",d.seller_id||"Not available"]}),e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Marketplace:"})," ",d.marketplace_id||"US"]}),d.connected_at&&e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Connected:"})," ",new Date(d.connected_at).toLocaleDateString()]}),d.last_used_at&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Last used:"})," ",new Date(d.last_used_at).toLocaleString()]})]}),e.jsx(g,{variant:"outlined",color:"error",startIcon:e.jsx(Me,{size:18}),onClick:f,children:"Disconnect"})]}):e.jsxs(l,{children:[e.jsx(Y,{severity:"info",sx:{mb:2},children:"Connect your Amazon Seller account to see YOUR eligibility status on products. Each user connects their own account and sees their own gating status."}),e.jsx(g,{variant:"contained",size:"large",startIcon:k?e.jsx(J,{size:20,color:"inherit"}):e.jsx(Te,{size:20}),onClick:O,disabled:k,sx:{bgcolor:"#FF9900","&:hover":{bgcolor:"#E88B00"},color:"#000"},children:k?"Connecting...":"Connect Amazon"})]}),!(d!=null&&d.connected)&&e.jsxs(l,{sx:{mt:3,p:2,bgcolor:F.gray[50],borderRadius:2,border:"1px solid",borderColor:F.gray[200]},children:[e.jsx(o,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"ðŸ”“ Why Connect?"}),e.jsxs(l,{component:"ul",sx:{m:0,pl:2.5},children:[e.jsx("li",{children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Real gating checks"})," â€” Know if YOU can list a product, not just estimates"]})}),e.jsx("li",{children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Accurate FBA fees"})," â€” Get exact fees from Amazon for your account"]})}),e.jsx("li",{children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Better analysis"})," â€” More accurate profit calculations based on your account"]})})]})]})]})})}const ht=["Enter Phone","Verify Code","Connected"],pt=()=>{const P=Re(),[r,d]=n.useState(null),[U,z]=n.useState(!0),[M,k]=n.useState(0),[_,T]=n.useState(""),[C,D]=n.useState(""),[N,O]=n.useState(""),[f,a]=n.useState(!1),[A,i]=n.useState(!1),[h,L]=n.useState([]),[v,te]=n.useState([]),[le,W]=n.useState(!1),[oe,ie]=n.useState(!1),[H,G]=n.useState({}),[m,$]=n.useState(null),[y,j]=n.useState({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),{showToast:u}=we(),{getLimit:ce,isLimitReached:K}=Be();n.useEffect(()=>{Q()},[]);const Q=async()=>{try{const t=await x.get("/integrations/telegram/status");d(t.data),t.data.connected&&X()}catch(t){console.error("Failed to fetch Telegram status:",t)}finally{z(!1)}},X=async()=>{try{const t=await x.get("/integrations/telegram/channels");L(t.data.channels||[])}catch(t){console.error("Failed to fetch channels:",t)}},de=async()=>{var t,c;if(!_.trim()){u("Please enter your phone number","error");return}i(!0);try{const p=await x.post("/integrations/telegram/auth/start",{phone_number:_});u("Verification code sent to your Telegram app","success"),k(1)}catch(p){u(((c=(t=p.response)==null?void 0:t.data)==null?void 0:c.detail)||"Failed to send code","error")}finally{i(!1)}},ue=async()=>{var t,c;if(!C.trim()){u("Please enter the verification code","error");return}i(!0);try{const p=await x.post("/integrations/telegram/auth/verify",{code:C,password:f?N:void 0});p.data.status==="2fa_required"?(a(!0),u("Please enter your 2FA password","warning")):p.data.status==="connected"&&(u("Telegram connected successfully!","success"),k(2),Q())}catch(p){u(((c=(t=p.response)==null?void 0:t.data)==null?void 0:c.detail)||"Verification failed","error")}finally{i(!1)}},b=async()=>{if(confirm("Disconnect Telegram? You will stop receiving deals from your channels."))try{await x.delete("/integrations/telegram/disconnect"),d({connected:!1}),L([]),k(0),T(""),D(""),u("Telegram disconnected","success")}catch{u("Failed to disconnect","error")}},E=async()=>{var t,c;ie(!0);try{const p=await x.get("/integrations/telegram/channels/available");te(p.data.channels||[]),W(!0)}catch(p){u(((c=(t=p.response)==null?void 0:t.data)==null?void 0:c.detail)||"Failed to fetch channels","error")}finally{ie(!1)}},q=t=>{$(t),j({...y,supplierName:t.title||t.name||""})},ae=async(t=null)=>{var p,I;const c=t||m;if(c)try{const se={channel_id:c.id,channel_name:c.name||c.title,channel_username:c.username,channel_type:c.type||"channel",create_supplier:y.createSupplier,supplier_name:y.supplierName||c.name||c.title,supplier_website:y.supplierWebsite||null,supplier_contact_email:y.supplierEmail||null,supplier_notes:y.supplierNotes||null},pe=await x.post("/integrations/telegram/channels",se);u(`Added ${c.name}${pe.data.supplier_id?" and created supplier":""}`,"success"),$(null),j({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),X(),Q(),te(xe=>xe.map(ee=>ee.id===c.id?{...ee,is_monitored:!0}:ee)),le&&W(!1)}catch(se){u(((I=(p=se.response)==null?void 0:p.data)==null?void 0:I.detail)||"Failed to add channel","error")}},ye=async t=>{var c,p;G(I=>({...I,[t]:!0}));try{const I=await x.post(`/integrations/telegram/channels/${t}/backfill?days=14`);u(`Synced ${I.data.messages} messages, found ${I.data.deals} deals`,"success"),X()}catch(I){u("Failed to sync: "+(((p=(c=I.response)==null?void 0:c.data)==null?void 0:p.detail)||I.message),"error")}finally{G(I=>({...I,[t]:!1}))}},he=async t=>{try{await x.delete(`/integrations/telegram/channels/${t}`),u("Channel removed","success"),X(),Q()}catch{u("Failed to remove channel","error")}},je=async()=>{var t,c;try{const p=await x.post("/integrations/telegram/monitoring/start");u(`Monitoring ${p.data.channels} channels`,"success"),Q()}catch(p){u(((c=(t=p.response)==null?void 0:t.data)==null?void 0:c.detail)||"Failed to start monitoring","error")}},be=async()=>{try{await x.post("/integrations/telegram/monitoring/stop"),u("Monitoring stopped","success"),Q()}catch{u("Failed to stop monitoring","error")}};return U?e.jsx(R,{children:e.jsx(B,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(J,{})})}):e.jsx(R,{children:e.jsxs(B,{children:[e.jsxs(l,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:2,children:[e.jsxs(l,{children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(ge,{size:20,style:{color:"#0088cc"}}),e.jsx(o,{variant:"h6",fontWeight:600,children:"Telegram Monitoring"}),e.jsx(Z,{icon:r!=null&&r.connected?e.jsx(Ce,{size:16}):void 0,label:r!=null&&r.connected?"Connected":"Not Connected",color:r!=null&&r.connected?"success":"default",size:"small"}),(r==null?void 0:r.monitoring)&&e.jsx(Z,{label:"Monitoring",color:"primary",size:"small"})]}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Auto-extract deals from supplier channels"})]}),(r==null?void 0:r.connected)&&e.jsx(g,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(Me,{size:18}),onClick:b,children:"Disconnect"})]}),!(r!=null&&r.connected)&&e.jsxs(l,{children:[e.jsx(Je,{activeStep:M,sx:{mb:3},children:ht.map(t=>e.jsx(Xe,{children:e.jsx(Ze,{children:t})},t))}),M===0&&e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:2,children:"Enter your phone number to connect your Telegram account. We'll send a verification code to your Telegram app."}),e.jsx(S,{label:"Phone Number",placeholder:"+1 234 567 8900",value:_,onChange:t=>T(t.target.value),fullWidth:!0,sx:{mb:2},helperText:"Include country code (e.g., +1 for US)"}),e.jsx(g,{variant:"contained",onClick:de,disabled:A,startIcon:A?e.jsx(J,{size:16}):e.jsx(ge,{size:18}),sx:{bgcolor:"#0088cc","&:hover":{bgcolor:"#006699"}},children:A?"Sending...":"Send Code"})]}),M===1&&e.jsxs(l,{children:[e.jsx(Y,{severity:"info",sx:{mb:2},children:"Check your Telegram app for the verification code"}),e.jsx(S,{label:"Verification Code",placeholder:"12345",value:C,onChange:t=>D(t.target.value.replace(/\D/g,"")),fullWidth:!0,autoFocus:!0,inputProps:{maxLength:5,inputMode:"numeric",pattern:"[0-9]*"},sx:{mb:2},helperText:"Enter the 5-digit code from Telegram"}),f&&e.jsx(S,{label:"2FA Password",type:"password",autoComplete:"current-password",value:N,onChange:t=>O(t.target.value),fullWidth:!0,sx:{mb:2},helperText:"Your Telegram 2FA password"}),e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(g,{variant:"outlined",onClick:()=>{k(0),D(""),a(!1)},children:"Back"}),e.jsx(g,{variant:"contained",onClick:ue,disabled:A,startIcon:A?e.jsx(J,{size:16}):e.jsx(Ce,{size:18}),children:A?"Verifying...":"Verify"})]})]})]}),(r==null?void 0:r.connected)&&e.jsxs(l,{children:[e.jsx(l,{mb:2,children:e.jsx(Ue,{label:"Monitored Channels",used:h.length,limit:(r==null?void 0:r.channel_limit)||ce("telegram_channels")})}),e.jsxs(l,{display:"flex",gap:1,mb:2,children:[r!=null&&r.monitoring?e.jsx(g,{variant:"outlined",color:"warning",startIcon:e.jsx(ct,{size:18}),onClick:be,children:"Stop Monitoring"}):e.jsx(g,{variant:"contained",color:"success",startIcon:e.jsx(ot,{size:18}),onClick:je,disabled:h.length===0,children:"Start Monitoring"}),e.jsx(g,{variant:"outlined",startIcon:oe?e.jsx(J,{size:16}):e.jsx(et,{size:18}),onClick:E,disabled:oe||K("telegram_channels",h.length),children:"Add Channel"})]}),(h||[]).length>0?e.jsx(Se,{dense:!0,children:(h||[]).map(t=>e.jsxs(ke,{children:[e.jsx(Pe,{children:e.jsx(ge,{size:18,style:{color:P.palette.primary.main}})}),e.jsx(Ae,{primary:t.channel_name,secondary:e.jsxs(l,{display:"flex",gap:2,children:[e.jsxs("span",{children:[t.messages_received||0," messages"]}),e.jsxs("span",{children:[t.deals_extracted||0," deals"]})]}),secondaryTypographyProps:{component:"div"}}),e.jsx($e,{children:e.jsxs(l,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(Fe,{title:"Sync last 14 days of messages",children:e.jsx(g,{size:"small",variant:"outlined",onClick:()=>ye(t.channel_id),disabled:H[t.channel_id],startIcon:H[t.channel_id]?e.jsx(J,{size:14}):e.jsx(it,{size:14}),children:H[t.channel_id]?"Syncing...":"Sync 14 Days"})}),e.jsx(Fe,{title:"Remove channel",children:e.jsx(Ye,{edge:"end",size:"small",onClick:()=>he(t.channel_id),children:e.jsx(tt,{size:18})})})]})})]},t.id))}):e.jsx(Y,{severity:"info",children:'No channels added yet. Click "Add Channel" to select channels to monitor.'}),(r==null?void 0:r.monitoring)&&e.jsxs(l,{mt:2,p:2,sx:{bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:2},children:[e.jsx(o,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Monitoring Active"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Deals will be automatically extracted and appear in your feed."})]})]}),e.jsxs(We,{open:le,onClose:()=>{W(!1),$(null),j({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ie,{children:"Add Telegram Channel"}),e.jsx(Le,{dividers:!0,children:(v||[]).length>0?e.jsxs(e.Fragment,{children:[e.jsx(Se,{children:(v||[]).map(t=>e.jsxs(ke,{button:!0,selected:(m==null?void 0:m.id)===t.id,onClick:()=>q(t),children:[e.jsx(Pe,{children:e.jsx(ge,{size:20})}),e.jsx(Ae,{primary:t.name,secondary:`${t.type} â€¢ ${t.member_count||"?"} members`}),t.is_monitored&&e.jsx(Z,{label:"Monitoring",size:"small",color:"success",sx:{ml:2}})]},t.id))}),m&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{sx:{my:2}}),e.jsxs(l,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2},children:[e.jsxs(o,{variant:"subtitle2",color:"primary",children:["Selected: ",m.name||m.title]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["@",m.username||"no-username"]})]}),e.jsx(fe,{control:e.jsx(Ve,{checked:y.createSupplier,onChange:t=>j({...y,createSupplier:t.target.checked})}),label:"Create as Supplier"}),y.createSupplier&&e.jsxs(l,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(S,{label:"Supplier Name",value:y.supplierName,onChange:t=>j({...y,supplierName:t.target.value}),placeholder:(m==null?void 0:m.name)||(m==null?void 0:m.title)||"Supplier name",fullWidth:!0,size:"small"}),e.jsx(S,{label:"Website (optional)",value:y.supplierWebsite,onChange:t=>j({...y,supplierWebsite:t.target.value}),placeholder:"https://...",fullWidth:!0,size:"small"}),e.jsx(S,{label:"Contact Email (optional)",value:y.supplierEmail,onChange:t=>j({...y,supplierEmail:t.target.value}),placeholder:"contact@supplier.com",fullWidth:!0,size:"small"}),e.jsx(S,{label:"Notes (optional)",value:y.supplierNotes,onChange:t=>j({...y,supplierNotes:t.target.value}),placeholder:"Any notes about this supplier...",multiline:!0,rows:2,fullWidth:!0,size:"small"})]})]})]}):e.jsx(o,{color:"text.secondary",textAlign:"center",py:4,children:"No channels found. Make sure you're a member of some Telegram channels or groups."})}),e.jsxs(Ee,{children:[e.jsx(g,{onClick:()=>{W(!1),$(null),j({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},children:"Cancel"}),e.jsx(g,{variant:"contained",onClick:()=>ae(),disabled:!m||K("telegram_channels",h.length),children:"Add Channel"})]})]})]})})},kt=()=>{var pe,xe,ee;const[P]=De(),r=P.get("tab"),d={profile:0,integrations:1,alerts:2,costs:3,billing:4},U=r&&d[r]!==void 0?d[r]:0,[z,M]=n.useState(U);n.useEffect(()=>{r&&d[r]!==void 0&&M(d[r])},[r,P]);const{profile:k,alertSettings:_,costSettings:T,loading:C,updateProfile:D,updateAlertSettings:N,updateCostSettings:O}=dt(),{showToast:f}=we(),{subscription:a,openPortal:A,cancelSubscription:i,reactivateSubscription:h,refreshSubscription:L}=Oe(),v=He(),[te,le]=n.useState([]),[W,oe]=n.useState(null),[ie,H]=n.useState(!1),[G,m]=n.useState(!1),[$,y]=n.useState({full_name:"",avatar_url:""}),[j,u]=n.useState({current_password:"",new_password:"",confirm_password:""}),[ce,K]=n.useState(""),[Q,X]=n.useState(!1),[de,ue]=n.useState(!1),[b,E]=n.useState({min_roi:20,min_profit:3,max_rank:1e5,alerts_enabled:!0,alert_min_roi:30,alert_channels:["push","email"]}),[q,ae]=n.useState({inbound_rate_per_lb:.35,default_prep_cost:.1});n.useEffect(()=>{k&&y({full_name:k.full_name||"",avatar_url:k.avatar_url||""})},[k]),n.useEffect(()=>{_&&E({min_roi:_.min_roi||20,min_profit:_.min_profit||3,max_rank:_.max_rank||1e5,alerts_enabled:_.alerts_enabled!==!1,alert_min_roi:_.alert_min_roi||30,alert_channels:_.alert_channels||["push","email"]})},[_]),n.useEffect(()=>{T&&ae({inbound_rate_per_lb:T.inbound_rate_per_lb||T.default_inbound_shipping||.35,default_prep_cost:T.default_prep_cost||.1})},[T]),n.useEffect(()=>{z===4&&(ye(),he())},[z]);const ye=async()=>{try{const s=await x.get("/billing/invoices");le(s.data.invoices||[])}catch(s){console.error("Failed to fetch invoices:",s)}},he=async()=>{try{const s=await x.get("/billing/usage");oe(s.data)}catch(s){console.error("Failed to fetch usage:",s)}},je=async(s=!1)=>{var w,V;m(!0);try{s?(await x.post("/billing/cancel-immediately"),f("Subscription cancelled. You've been moved to the Free plan.","info")):(await i(!0),f("Subscription will cancel at end of billing period","info")),H(!1),await L(),await he()}catch(Ne){f(((V=(w=Ne.response)==null?void 0:w.data)==null?void 0:V.detail)||"Failed to cancel subscription","error")}finally{m(!1)}},be=async()=>{m(!0);try{await h(),f("Subscription reactivated","success")}catch{f("Failed to reactivate subscription","error")}finally{m(!1)}},t=async()=>{m(!0);try{await A()}catch{f("Failed to open billing portal","error"),m(!1)}},c=async()=>{try{await D($),f("Profile updated successfully","success")}catch(s){f(s.message||"Failed to update profile","error")}},p=async()=>{try{await N(b),f("Alert settings saved","success")}catch(s){f(s.message||"Failed to save alert settings","error")}},I=async()=>{try{const s={inbound_rate_per_lb:q.inbound_rate_per_lb,default_prep_cost:q.default_prep_cost,default_inbound_shipping:q.inbound_rate_per_lb};await O(s),f("Cost settings saved","success")}catch(s){f(s.message||"Failed to save cost settings","error")}},se=async()=>{if(K(""),X(!1),j.new_password!==j.confirm_password){K("New passwords do not match");return}if(j.new_password.length<8){K("Password must be at least 8 characters");return}ue(!0);try{const{data:{user:s}}=await ve.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:w}=await ve.auth.signInWithPassword({email:s.email,password:j.current_password});if(w){K("Current password is incorrect"),f("Current password is incorrect","error");return}const{error:V}=await ve.auth.updateUser({password:j.new_password});if(V)throw V;X(!0),u({current_password:"",new_password:"",confirm_password:""}),f("Password changed successfully","success")}catch(s){K(s.message||"Failed to change password"),f(s.message||"Failed to change password","error")}finally{ue(!1)}};return C?e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(J,{})}):e.jsxs(l,{children:[e.jsx(o,{variant:"h4",fontWeight:700,mb:4,children:"Settings"}),e.jsxs(at,{value:z,onChange:(s,w)=>M(w),sx:{mb:4},children:[e.jsx(re,{label:"Profile"}),e.jsx(re,{label:"Integrations"}),e.jsx(re,{label:"Alerts"}),e.jsx(re,{label:"Costs"}),e.jsx(re,{label:"Billing"})]}),z===0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsxs(B,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:3,children:"Profile Settings"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(S,{label:"Full Name",value:$.full_name,onChange:s=>y({...$,full_name:s.target.value}),fullWidth:!0}),e.jsx(S,{label:"Avatar URL",value:$.avatar_url,onChange:s=>y({...$,avatar_url:s.target.value}),fullWidth:!0,placeholder:"https://..."}),e.jsx(g,{variant:"contained",onClick:c,sx:{backgroundColor:F.purple.main,"&:hover":{backgroundColor:F.purple.dark},alignSelf:"flex-start"},children:"Save Profile"})]})]})}),e.jsx(R,{sx:{mt:3},children:e.jsxs(B,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:3,children:"Change Password"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[ce&&e.jsx(Y,{severity:"error",children:ce}),Q&&e.jsx(Y,{severity:"success",children:"Password changed successfully!"}),e.jsx(S,{label:"Current Password",type:"password",autoComplete:"current-password",value:j.current_password,onChange:s=>u({...j,current_password:s.target.value}),fullWidth:!0,required:!0}),e.jsx(S,{label:"New Password",type:"password",autoComplete:"new-password",value:j.new_password,onChange:s=>u({...j,new_password:s.target.value}),fullWidth:!0,required:!0,inputProps:{minLength:8},helperText:"Must be at least 8 characters"}),e.jsx(S,{label:"Confirm New Password",type:"password",autoComplete:"new-password",value:j.confirm_password,onChange:s=>u({...j,confirm_password:s.target.value}),fullWidth:!0,required:!0}),e.jsx(g,{variant:"contained",onClick:se,disabled:de,sx:{backgroundColor:F.purple.main,"&:hover":{backgroundColor:F.purple.dark},alignSelf:"flex-start"},children:de?"Changing...":"Change Password"})]})]})})]}),z===1&&e.jsxs(l,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(ut,{}),e.jsx(pt,{})]}),z===2&&e.jsx(R,{children:e.jsxs(B,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:3,children:"Alert Settings"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI for alerts"}),e.jsx(ze,{value:b.alert_min_roi,onChange:(s,w)=>E({...b,alert_min_roi:w}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:s=>`${s}%`})]}),e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI to consider profitable"}),e.jsx(ze,{value:b.min_roi,onChange:(s,w)=>E({...b,min_roi:w}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:s=>`${s}%`})]}),e.jsx(S,{label:"Minimum profit per unit",type:"number",value:b.min_profit,onChange:s=>E({...b,min_profit:parseFloat(s.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0}),e.jsx(S,{label:"Maximum sales rank",type:"number",value:b.max_rank,onChange:s=>E({...b,max_rank:parseInt(s.target.value)||0}),fullWidth:!0}),e.jsx(fe,{control:e.jsx(_e,{checked:b.alerts_enabled,onChange:s=>E({...b,alerts_enabled:s.target.checked})}),label:"Enable alerts"}),e.jsxs(l,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",mb:1,children:"Notification Channels"}),e.jsx(fe,{control:e.jsx(_e,{checked:(pe=b.alert_channels)==null?void 0:pe.includes("push"),onChange:s=>{const w=b.alert_channels||[];s.target.checked?E({...b,alert_channels:[...w,"push"]}):E({...b,alert_channels:w.filter(V=>V!=="push")})}}),label:"Push notifications"}),e.jsx(fe,{control:e.jsx(_e,{checked:(xe=b.alert_channels)==null?void 0:xe.includes("email"),onChange:s=>{const w=b.alert_channels||[];s.target.checked?E({...b,alert_channels:[...w,"email"]}):E({...b,alert_channels:w.filter(V=>V!=="email")})}}),label:"Email alerts"})]}),e.jsx(g,{variant:"contained",onClick:p,sx:{backgroundColor:F.purple.main,"&:hover":{backgroundColor:F.purple.dark},alignSelf:"flex-start"},children:"Save Settings"})]})]})}),z===3&&e.jsx(R,{children:e.jsxs(B,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:1,children:"ðŸ“¦ Shipping & Prep Costs"}),e.jsx(o,{variant:"body2",color:"text.secondary",mb:3,children:"These costs are included in all profit calculations"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(S,{label:"Inbound Shipping Rate",type:"number",step:"0.01",value:q.inbound_rate_per_lb,onChange:s=>ae({...q,inbound_rate_per_lb:parseFloat(s.target.value)||0}),InputProps:{startAdornment:e.jsx(InputAdornment,{position:"start",children:"$"}),endAdornment:e.jsx(InputAdornment,{position:"end",children:"/lb"})},fullWidth:!0,helperText:"Cost to ship TO Amazon (typical: $0.30-0.50/lb)"}),e.jsx(S,{label:"Default Prep Cost",type:"number",step:"0.01",value:q.default_prep_cost,onChange:s=>ae({...q,default_prep_cost:parseFloat(s.target.value)||0}),InputProps:{startAdornment:e.jsx(InputAdornment,{position:"start",children:"$"}),endAdornment:e.jsx(InputAdornment,{position:"end",children:"/unit"})},fullWidth:!0,helperText:"Labeling, poly bags, etc. (typical: $0.10-0.30)"}),e.jsx(g,{variant:"contained",onClick:I,sx:{backgroundColor:F.purple.main,"&:hover":{backgroundColor:F.purple.dark},alignSelf:"flex-start"},children:"Save Cost Settings"})]})]})}),z===4&&e.jsxs(l,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(R,{children:e.jsxs(B,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(l,{children:[e.jsx(o,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Current Plan"}),e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(Z,{label:((ee=a==null?void 0:a.tier)==null?void 0:ee.toUpperCase())||"FREE",color:(a==null?void 0:a.tier)==="free"?"default":"primary",sx:{fontWeight:600}}),(a==null?void 0:a.cancel_at_period_end)&&e.jsx(Z,{label:"Cancels at period end",color:"warning",size:"small"})]}),(a==null?void 0:a.status)==="trialing"&&(a==null?void 0:a.trial_end)&&e.jsxs(Y,{severity:"info",sx:{mt:1,mb:1},children:["ðŸŽ‰ Free trial ends ",new Date(a.trial_end).toLocaleDateString()]}),(a==null?void 0:a.current_period_end)&&(a==null?void 0:a.status)!=="trialing"&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Renews: ",new Date(a.current_period_end).toLocaleDateString()]}),(a==null?void 0:a.cancel_at_period_end)&&e.jsxs(Y,{severity:"warning",sx:{mt:1},children:["âš ï¸ Cancels on ",a!=null&&a.current_period_end?new Date(a.current_period_end).toLocaleDateString():"period end"]})]}),e.jsxs(l,{display:"flex",gap:1,children:[a!=null&&a.cancel_at_period_end?e.jsx(g,{variant:"outlined",onClick:be,disabled:G,children:"Reactivate"}):(a==null?void 0:a.tier)!=="free"?e.jsx(g,{variant:"outlined",color:"error",onClick:()=>H(!0),disabled:G,children:"Cancel"}):null,e.jsx(g,{variant:"contained",onClick:()=>v("/pricing"),sx:{backgroundColor:F.purple.main,"&:hover":{backgroundColor:F.purple.dark}},children:(a==null?void 0:a.tier)==="free"?"Upgrade":"Change Plan"})]})]}),(a==null?void 0:a.tier)!=="free"&&e.jsx(g,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Ge,{size:18}),onClick:t,disabled:G,sx:{mt:2},children:"Manage Billing & Payment Methods"})]})}),W&&e.jsx(R,{children:e.jsxs(B,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:2,children:"Usage This Period"}),e.jsxs(l,{mb:2,children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(o,{variant:"body2",color:"text.secondary",children:"Analyses"}),e.jsxs(o,{variant:"body2",fontWeight:600,children:[W.analyses.used," / ",W.analyses.unlimited?"âˆž":W.analyses.limit]})]}),!W.analyses.unlimited&&e.jsx(Ke,{variant:"determinate",value:Math.min(W.analyses.used/W.analyses.limit*100,100),sx:{height:8,borderRadius:4,backgroundColor:F.gray[200],"& .MuiLinearProgress-bar":{backgroundColor:W.analyses.used>=W.analyses.limit*.9?F.error.main:F.purple.main}}})]})]})}),e.jsx(R,{children:e.jsxs(B,{children:[e.jsx(o,{variant:"h6",fontWeight:600,mb:2,children:"Invoice History"}),te.length===0?e.jsx(o,{variant:"body2",color:"text.secondary",children:"No invoices yet"}):e.jsx(st,{size:"small",children:e.jsx(rt,{children:te.map(s=>e.jsxs(nt,{children:[e.jsx(me,{children:e.jsx(o,{variant:"body2",fontWeight:600,children:new Date(s.created_at).toLocaleDateString()})}),e.jsx(me,{children:e.jsx(o,{variant:"body2",color:"text.secondary",children:Qe((s.amount_paid||s.amount_due||0)/100)})}),e.jsx(me,{children:e.jsx(Z,{label:s.status,size:"small",color:s.status==="paid"?"success":"default"})}),e.jsx(me,{align:"right",children:s.stripe_invoice_url&&e.jsx(g,{size:"small",startIcon:e.jsx(lt,{size:14}),href:s.stripe_invoice_url,target:"_blank",children:"View"})})]},s.id))})})]})}),e.jsxs(We,{open:ie,onClose:()=>H(!1),children:[e.jsx(Ie,{children:"Cancel Subscription?"}),e.jsx(Le,{children:(a==null?void 0:a.status)==="trialing"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{severity:"warning",sx:{mb:2},children:"Your trial will end immediately and you'll be downgraded to the Free plan."}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"You can resubscribe anytime, but won't be eligible for another free trial."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{severity:"warning",sx:{mb:2},children:"Your subscription will remain active until the end of your current billing period. You'll continue to have access to all features until then."}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"After cancellation, you'll be moved to the Free plan. You can reactivate anytime."})]})}),e.jsxs(Ee,{children:[e.jsx(g,{onClick:()=>H(!1),children:"Keep Subscription"}),e.jsx(g,{onClick:()=>je((a==null?void 0:a.status)==="trialing"),color:"error",variant:"contained",disabled:G,children:G?"Canceling...":"Yes, Cancel"})]})]})]})]})};export{kt as default};

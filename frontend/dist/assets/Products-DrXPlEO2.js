import{a5 as As,a6 as Ps,r as l,a7 as zs,a8 as Ye,a9 as Is,aa as Je,j as e,ab as xs,J as Fs,ac as Ns,c as hs,O as Fe,B as u,T as t,C as ge,b as Le,d as de,K as ne,F as ms,h as te,A as ts,$ as xe,a0 as he,a1 as ue,ad as ke,ae as Ae,af as Pe,ag as se,z as $s,a as A,o as W,I as fe,ah as gs,ai as rs,aj as ns,p as ye,q as je,a2 as Ts,Q as es,D as Ms,k as js,s as fs,u as Rs,P as is,e as Us,G as ys,t as Ws,ak as Es,al as Qe,Z as Ds,am as Bs,E as we,R as qs}from"./index-BYznCITu.js";import{S as Ls,a as Os,b as Vs,c as Oe,d as Ve}from"./Stepper-MXxkIWKC.js";import{G as K}from"./Grid-DCzzsCbl.js";import{T as vs,a as bs,b as Ze,c as ee}from"./TableRow-hZp2xtn3.js";import{C as as}from"./clock-D6aOgYj_.js";import{C as Hs}from"./check-circle-mt917hOV.js";import{T as Ks}from"./TableHead-DQ0-QNtv.js";import{D as me}from"./DialogActions-DoklkOxt.js";import{C as os}from"./Close-CL9dEM5i.js";import{A as Xe,U as cs}from"./upload-BDsT2InR.js";import{S as Js}from"./SupplierFormModal-CyFr387d.js";import{h as He}from"./errorHandler-l0UVzPhu.js";import{T as Qs,a as ds}from"./Tabs-BoFdI0tU.js";import{T as Ge}from"./trash-2-B_awrX4j.js";import{R as Gs}from"./refresh-cw-nAbQQF7o.js";import{E as Zs}from"./external-link-6b3xdYup.js";function Xs(n){return As("MuiStepContent",n)}Ps("MuiStepContent",["root","last","transition"]);const Ys=["children","className","TransitionComponent","transitionDuration","TransitionProps"],et=n=>{const{classes:x,last:c}=n;return Ns({root:["root",c&&"last"],transition:["transition"]},Xs,x)},st=xs("div",{name:"MuiStepContent",slot:"Root",overridesResolver:(n,x)=>{const{ownerState:c}=n;return[x.root,c.last&&x.last]}})(({ownerState:n,theme:x})=>Je({marginLeft:12,paddingLeft:20,paddingRight:8,borderLeft:x.vars?`1px solid ${x.vars.palette.StepContent.border}`:`1px solid ${x.palette.mode==="light"?x.palette.grey[400]:x.palette.grey[600]}`},n.last&&{borderLeft:"none"})),tt=xs(Ye,{name:"MuiStepContent",slot:"Transition",overridesResolver:(n,x)=>x.transition})({}),Ke=l.forwardRef(function(x,c){const h=zs({props:x,name:"MuiStepContent"}),{children:f,className:m,TransitionComponent:U=Ye,transitionDuration:P="auto",TransitionProps:k}=h,L=Is(h,Ys),{orientation:a}=l.useContext(Ls),{active:g,last:i,expanded:v}=l.useContext(Os),S=Je({},h,{last:i}),E=et(S);let p=P;return P==="auto"&&!U.muiSupportAuto&&(p=void 0),e.jsx(st,Je({className:Fs(E.root,m),ref:c,ownerState:S},L,{children:e.jsx(tt,Je({as:U,in:g||v,className:E.transition,ownerState:S,timeout:p,unmountOnExit:!0},k,{children:f}))}))});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=hs("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=hs("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ss=Fe(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),_s=Fe(e.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),Cs=Fe(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),at=Fe(e.jsx("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),us=Fe(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload");function ot({job:n,parsedData:x,conversionData:c,pricingData:h,keepaData:f}){var P,k,L;const m=a=>{var i;if(!n)return"pending";if(n.status==="completed")return"completed";if(n.status==="failed")return"error";const g=((i=n.metadata)==null?void 0:i.current_stage)||n.stage||"parse";return a==="parse"?g==="parse"?"active":"completed":a==="convert"?g==="parse"?"pending":g==="convert"?"active":"completed":a==="pricing"?["parse","convert"].includes(g)?"pending":g==="pricing"||g==="analyzing"?"active":"completed":a==="keepa"?["parse","convert","pricing","analyzing"].includes(g)?"pending":g==="keepa"?"active":"completed":"pending"},U=a=>{switch(a){case"completed":return e.jsx(Hs,{size:20,color:te.success.main});case"active":return e.jsx(as,{size:20,color:te.warning.main});case"error":return e.jsx(ts,{size:20,color:te.error.main});default:return e.jsx(as,{size:20,color:te.gray[400]})}};return e.jsxs(u,{sx:{mt:2},children:[e.jsxs(Vs,{orientation:"vertical",children:[e.jsxs(Oe,{active:m("parse")==="active",completed:m("parse")==="completed",children:[e.jsx(Ve,{StepIconComponent:()=>U(m("parse")),error:m("parse")==="error",children:e.jsx(t,{variant:"subtitle1",fontWeight:600,children:"Stage 0: Parse Excel"})}),e.jsx(Ke,{children:x?e.jsx(ge,{variant:"outlined",sx:{mt:1,bgcolor:"background.paper"},children:e.jsxs(Le,{children:[e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Total Rows"}),e.jsx(t,{variant:"h6",children:x.total_rows||0})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Valid UPCs"}),e.jsx(t,{variant:"h6",children:x.valid_upcs||0})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Products with Promo"}),e.jsx(t,{variant:"h6",children:x.products_with_promo||0})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Format Detected"}),e.jsx(de,{label:x.format||"Standard",size:"small"})]}),x.pack_distribution&&e.jsxs(K,{item:!0,xs:12,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Pack Sizes"}),e.jsx(t,{variant:"body2",children:x.pack_distribution})]})]}),x.preview&&x.preview.length>0&&e.jsxs(u,{sx:{mt:2},children:[e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:["Preview (First ",Math.min(5,x.preview.length)," rows):"]}),e.jsx(vs,{size:"small",children:e.jsxs(bs,{children:[e.jsxs(Ze,{children:[e.jsx(ee,{children:e.jsx("strong",{children:"UPC"})}),e.jsx(ee,{children:e.jsx("strong",{children:"Brand"})}),e.jsx(ee,{children:e.jsx("strong",{children:"Pack"})}),e.jsx(ee,{children:e.jsx("strong",{children:"Buy Cost"})}),e.jsx(ee,{children:e.jsx("strong",{children:"Promo"})}),e.jsx(ee,{children:e.jsx("strong",{children:"Promo Qty"})}),e.jsx(ee,{children:e.jsx("strong",{children:"Promo %"})})]}),x.preview.slice(0,5).map((a,g)=>{var i,v,S;return e.jsxs(Ze,{children:[e.jsx(ee,{children:(i=a.upc)==null?void 0:i.slice(0,12)}),e.jsx(ee,{children:(v=a.brand)==null?void 0:v.slice(0,15)}),e.jsx(ee,{children:a.pack_size}),e.jsxs(ee,{children:["$",((S=a.buy_cost)==null?void 0:S.toFixed(4))||"N/A"]}),e.jsx(ee,{children:a.has_promo?"âœ“":"â€”"}),e.jsx(ee,{children:a.promo_qty||"â€”"}),e.jsx(ee,{children:a.promo_percent?`${a.promo_percent}%`:"â€”"})]},g)})]})})]})]})}):e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Parsing file..."})})]}),e.jsxs(Oe,{active:m("convert")==="active",completed:m("convert")==="completed",children:[e.jsx(Ve,{StepIconComponent:()=>U(m("convert")),error:m("convert")==="error",children:e.jsx(t,{variant:"subtitle1",fontWeight:600,children:"Stage 1: UPC â†’ ASIN Conversion"})}),e.jsx(Ke,{children:c?e.jsx(ge,{variant:"outlined",sx:{mt:1,bgcolor:"background.paper"},children:e.jsxs(Le,{children:[e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Total UPCs"}),e.jsx(t,{variant:"h6",children:c.total_upcs||0})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"ASINs Found"}),e.jsxs(t,{variant:"h6",color:"success.main",children:[c.asins_found||0," âœ…"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Not Found"}),e.jsxs(t,{variant:"h6",color:"warning.main",children:[c.not_found||0," âš ï¸"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Conversion Rate"}),e.jsxs(t,{variant:"h6",children:[((P=c.conversion_rate)==null?void 0:P.toFixed(1))||0,"%"]})]})]}),c.not_found>0&&e.jsxs(ne,{severity:"warning",sx:{mt:2},children:[c.not_found," products need manual ASIN entry"]})]})}):e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Converting UPCs to ASINs..."})})]}),e.jsxs(Oe,{active:m("pricing")==="active",completed:m("pricing")==="completed",children:[e.jsx(Ve,{StepIconComponent:()=>U(m("pricing")),error:m("pricing")==="error",children:e.jsx(t,{variant:"subtitle1",fontWeight:600,children:"Stage 2: SP-API Pricing & Fees"})}),e.jsx(Ke,{children:h?e.jsx(ge,{variant:"outlined",sx:{mt:1,bgcolor:"background.paper"},children:e.jsx(Le,{children:e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Products Analyzed"}),e.jsx(t,{variant:"h6",children:h.analyzed||0})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Profitable (ROI â‰¥ 30%)"}),e.jsxs(t,{variant:"h6",color:"success.main",children:[h.profitable||0," âœ…"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Not Profitable"}),e.jsxs(t,{variant:"h6",color:"error.main",children:[h.not_profitable||0," âœ—"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Average ROI"}),e.jsxs(t,{variant:"h6",children:[((k=h.avg_roi)==null?void 0:k.toFixed(1))||0,"%"]})]}),h.best_roi&&e.jsxs(K,{item:!0,xs:12,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Best ROI"}),e.jsxs(t,{variant:"body2",children:[(L=h.best_roi.value)==null?void 0:L.toFixed(1),"% (ASIN: ",h.best_roi.asin,")"]})]})]})})}):e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Fetching pricing and fees..."})})]}),e.jsxs(Oe,{active:m("keepa")==="active",completed:m("keepa")==="completed",children:[e.jsx(Ve,{StepIconComponent:()=>U(m("keepa")),error:m("keepa")==="error",children:e.jsx(t,{variant:"subtitle1",fontWeight:600,children:"Stage 3: Keepa Deep Analysis"})}),e.jsx(Ke,{children:f?e.jsx(ge,{variant:"outlined",sx:{mt:1,bgcolor:"background.paper"},children:e.jsx(Le,{children:e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Products Analyzed"}),e.jsx(t,{variant:"h6",children:f.analyzed||0})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Still Profitable at Worst"}),e.jsxs(t,{variant:"h6",color:"success.main",children:[f.still_profitable||0," âœ…"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Risky"}),e.jsxs(t,{variant:"h6",color:"warning.main",children:[f.risky||0," âš ï¸"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Amazon is Seller"}),e.jsxs(t,{variant:"h6",color:"warning.main",children:[f.amazon_seller||0," âš ï¸"]})]})]})})}):e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Fetching Keepa data for profitable products..."})})]})]}),n&&n.progress!==void 0&&e.jsxs(u,{sx:{mt:3},children:[e.jsx(ms,{variant:"determinate",value:n.progress||0,sx:{height:8,borderRadius:1}}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[n.processed_items||0," / ",n.total_items||"?"," items processed"]})]})]})}function it({open:n,onClose:x,previewData:c,onConfirm:h}){var E;const[f,m]=l.useState((c==null?void 0:c.suggested_mapping)||{}),U=[{key:"asin",label:"ASIN",required:!1},{key:"upc",label:"UPC",required:!1},{key:"sku",label:"SKU",required:!1},{key:"title",label:"Product Name",required:!0},{key:"brand",label:"Brand",required:!0},{key:"category",label:"Category",required:!1},{key:"cost",label:"Buy Cost",required:!1,calculated:!0},{key:"moq",label:"MOQ",required:!1},{key:"case_pack",label:"Case Pack",required:!1},{key:"wholesale_cost_case",label:"Wholesale Cost (Case)",required:!1},{key:"supplier_name",label:"Supplier",required:!1},{key:"percent_off",label:"Percent Off (%)",required:!1},{key:"promo_qty",label:"Promo Qty",required:!1}],P=f.wholesale_cost_case&&f.case_pack,k=f.cost,L=!P&&!k,a=(p,r)=>{m({...f,[p]:r})},g=()=>{h(f)};if(!c)return null;const{columns:i,preview_data:v,validation:S}=c;return e.jsxs(xe,{open:n,onClose:x,maxWidth:"lg",fullWidth:!0,children:[e.jsx(he,{children:"Map Columns"}),e.jsxs(ue,{children:[e.jsx(ne,{severity:"info",sx:{mb:2},children:"AI detected your columns. Review and adjust the mapping below."}),((E=S==null?void 0:S.warnings)==null?void 0:E.length)>0&&e.jsx(ne,{severity:"warning",sx:{mb:2},children:S.warnings.join(". ")}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Column Mapping"}),e.jsx(u,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:3},children:U.map(p=>e.jsxs(ke,{size:"small",children:[e.jsxs(Ae,{children:[p.label,(p.required||p.key==="cost"&&L)&&e.jsx("span",{style:{color:"red"},children:" *"}),p.key==="cost"&&P&&e.jsx("span",{style:{color:"green",fontSize:"0.75rem",marginLeft:4},children:"(will be calculated)"})]}),e.jsxs(Pe,{value:f[p.key]||"",onChange:r=>a(p.key,r.target.value),label:p.label,disabled:p.key==="cost"&&P,children:[e.jsx(se,{value:"",children:e.jsx("em",{children:p.key==="cost"&&P?"Auto-calculated":"Not mapped"})}),i.map(r=>e.jsx(se,{value:r,children:r},r))]})]},p.key))}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Preview (First 5 Rows)"}),e.jsx($s,{sx:{overflow:"auto",maxHeight:400},children:e.jsxs(vs,{size:"small",children:[e.jsx(Ks,{children:e.jsx(Ze,{children:Object.keys(f).map(p=>e.jsx(ee,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"caption",fontWeight:"bold",children:p.toUpperCase()}),e.jsxs(t,{variant:"caption",display:"block",color:"text.secondary",children:["from: ",f[p]]})]})},p))})}),e.jsx(bs,{children:v==null?void 0:v.slice(0,5).map((p,r)=>{const z=P&&f.wholesale_cost_case&&f.case_pack?(()=>{const F=parseFloat(p[f.wholesale_cost_case]),$=parseFloat(p[f.case_pack]);return!isNaN(F)&&!isNaN($)&&$>0?(F/$).toFixed(2):"â€”"})():null;return e.jsx(Ze,{children:Object.entries(f).map(([F,$])=>F==="cost"&&z!==null?e.jsx(ee,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",fontWeight:"bold",color:"success.main",children:z}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"(calculated)"})]})},F):e.jsx(ee,{children:p[$]||"â€”"},F))},r)})})]})}),e.jsxs(u,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Mapped fields:"}),Object.entries(f).map(([p,r])=>e.jsx(de,{label:`${p} â† ${r}`,size:"small",color:"primary",variant:"outlined"},p))]})]}),e.jsxs(me,{children:[e.jsx(A,{onClick:x,children:"Cancel"}),e.jsxs(A,{onClick:g,variant:"contained",disabled:!(S!=null&&S.valid)&&!P,title:!(S!=null&&S.valid)&&!P?"Please map required fields":"",children:["Import ",c.total_rows," Products"]})]})]})}function lt({open:n,onClose:x,onComplete:c}){var y,B,R,be,Se,_e,Ce,Ne,$e,ze,Te,Me,Re,Ue,We,Ee,Ie,De,Be,qe;const[h,f]=l.useState([]),[m,U]=l.useState(""),[P,k]=l.useState(""),[L,a]=l.useState(!1),[g,i]=l.useState(!1),[v,S]=l.useState(null),[E,p]=l.useState(null),[r,z]=l.useState(null),[F,$]=l.useState(!1),[G,j]=l.useState(null),[T,J]=l.useState(!1),[oe,D]=l.useState(null),[ie,Q]=l.useState(!1),[ae,ve]=l.useState(null);l.useEffect(()=>{n&&(q(),M())},[n]),l.useEffect(()=>{if(!n||!E||(r==null?void 0:r.status)==="completed"||(r==null?void 0:r.status)==="failed")return;const _=setInterval(async()=>{var I,O,V,le;try{const o=(await W.get(`/jobs/${E}`)).data;if(z(o),o.status==="completed"||o.status==="failed"){if(clearInterval(_),$(!1),o.status==="failed"){const d=((I=o.errors)==null?void 0:I[0])||o.error||"Upload failed. Please check the errors.";j(d)}o.status==="completed"&&c&&setTimeout(()=>{c(o.result)},500)}}catch(s){if(console.error("Error polling job:",s),((O=s.response)==null?void 0:O.status)===404){clearInterval(_),$(!1),z(null),j("Job not found. The upload may have been cancelled or deleted.");return}clearInterval(_),$(!1),j(((le=(V=s.response)==null?void 0:V.data)==null?void 0:le.detail)||"Failed to check job status. Please refresh the page.")}},3e3);return()=>clearInterval(_)},[n,E,r==null?void 0:r.status,c]);const q=async()=>{try{const _=await W.get("/suppliers");f(_.data.suppliers||_.data||[])}catch(_){console.error("Error fetching suppliers:",_)}},M=()=>{U(""),k(""),a(!1),S(null),p(null),z(null),$(!1),j(null),J(!1)},N=async()=>{var _,I;if(P.trim()){i(!0);try{const V=(await W.post("/suppliers",{name:P.trim()})).data;f([...h,V]),U(V.id),a(!1),k("")}catch(O){j(((I=(_=O.response)==null?void 0:_.data)==null?void 0:I.detail)||"Failed to create supplier")}finally{i(!1)}}},Z=_=>{var V;const I=(V=_.target.files)==null?void 0:V[0];if(!I)return;const O=I.name.toLowerCase().slice(I.name.lastIndexOf("."));if(![".csv",".xlsx",".xls"].includes(O)){j("Please upload a .csv or .xlsx file");return}S(I),j(null)},X=async()=>{var _,I;if(!v||!m){j("Please select a supplier and file");return}$(!0),j(null);try{const O=new FormData;O.append("file",v);const V=await W.post("/products/upload/preview",O,{headers:{"Content-Type":"multipart/form-data"}}),le=await new Promise(s=>{const o=new FileReader;o.onload=()=>s(o.result.split(",")[1]),o.readAsDataURL(v)});ve(le),D(V.data),Q(!0),$(!1)}catch(O){console.error("Preview error:",O);const V=((I=(_=O.response)==null?void 0:_.data)==null?void 0:I.detail)||O.message||"Failed to preview file. Please try again.";j(V),$(!1)}},b=async _=>{var I,O;Q(!1),$(!0),j(null);try{const V=await W.post("/products/upload/confirm",{filename:v.name,file_data:ae,column_mapping:_,supplier_id:m});if(V.data.job_id)p(V.data.job_id);else{const le=new FormData;le.append("file",v),le.append("supplier_id",m);const s=await W.post("/products/upload",le,{headers:{"Content-Type":"multipart/form-data"}});p(s.data.job_id)}}catch(V){console.error("Upload error:",V);const le=((O=(I=V.response)==null?void 0:I.data)==null?void 0:O.detail)||V.message||"Upload failed. Please try again.";j(le),$(!1),p(null)}},re=((y=h.find(_=>_.id===m))==null?void 0:y.name)||"";return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{open:n,onClose:x,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(he,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Upload Price List",e.jsx(fe,{onClick:x,size:"small",children:e.jsx(os,{fontSize:"small"})})]}),e.jsxs(ue,{children:[(r==null?void 0:r.status)==="completed"&&e.jsx(u,{children:e.jsxs(ne,{severity:r.error_count>0&&r.success_count===0?"error":r.error_count>0?"warning":"success",sx:{mb:2},children:[e.jsx(Xe,{children:r.error_count>0&&r.success_count===0?"Upload Completed with Errors":r.error_count>0?"Upload Completed with Some Errors":"Upload Complete"}),e.jsxs(t,{variant:"body2",sx:{mt:1},children:["Supplier: ",e.jsx("strong",{children:((B=r.metadata)==null?void 0:B.supplier_name)||((R=r.result)==null?void 0:R.supplier_name)||"Unknown"})]}),e.jsxs(t,{variant:"body2",children:["Products created: ",e.jsx("strong",{children:((be=r.result)==null?void 0:be.products_created)||r.success_count||0})]}),e.jsxs(t,{variant:"body2",children:["Deals processed: ",e.jsx("strong",{children:((Se=r.result)==null?void 0:Se.deals_processed)||r.success_count||0})]}),(r.error_count>0||((_e=r.errors)==null?void 0:_e.length)>0||((Ne=(Ce=r.result)==null?void 0:Ce.errors)==null?void 0:Ne.length)>0)&&e.jsxs(u,{sx:{mt:2},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[r.error_count||(($e=r.errors)==null?void 0:$e.length)||((Te=(ze=r.result)==null?void 0:ze.errors)==null?void 0:Te.length)," row(s) had errors"]}),e.jsxs(A,{size:"small",onClick:()=>J(!T),endIcon:T?e.jsx(_s,{}):e.jsx(Cs,{}),children:[T?"Hide":"Show"," Errors"]}),e.jsx(Ye,{in:T,children:e.jsx(gs,{dense:!0,sx:{maxHeight:200,overflow:"auto",mt:1},children:(r.errors||((Me=r.result)==null?void 0:Me.errors)||[]).map((_,I)=>e.jsx(rs,{children:e.jsx(ns,{primary:_,primaryTypographyProps:{variant:"caption"}})},I))})})]})]})}),(r==null?void 0:r.status)==="failed"&&e.jsxs(ne,{severity:"error",sx:{mb:2},children:[e.jsx(Xe,{children:"Upload Failed"}),e.jsx(t,{variant:"body2",children:r.error})]}),((r==null?void 0:r.status)==="processing"||(r==null?void 0:r.status)==="pending"||(r==null?void 0:r.status)==="parsing"||(r==null?void 0:r.status)==="analyzing")&&e.jsxs(u,{sx:{mb:2},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ye,{size:20}),e.jsx(t,{variant:"body1",children:r.status==="parsing"?"Parsing file...":r.status==="analyzing"?"Analyzing products...":`Processing for ${re}...`})]}),e.jsx(ot,{job:r,parsedData:((Re=r.metadata)==null?void 0:Re.parsed_data)||((Ue=r.result)==null?void 0:Ue.parsed_data),conversionData:((We=r.metadata)==null?void 0:We.conversion_data)||((Ee=r.result)==null?void 0:Ee.conversion_data),pricingData:((Ie=r.metadata)==null?void 0:Ie.pricing_data)||((De=r.result)==null?void 0:De.pricing_data),keepaData:((Be=r.metadata)==null?void 0:Be.keepa_data)||((qe=r.result)==null?void 0:qe.keepa_data)})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{sx:{mb:3},children:[e.jsxs(ke,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ae,{children:"Supplier *"}),e.jsxs(Pe,{value:m,label:"Supplier *",onChange:_=>{const I=_.target.value;console.log("Selected supplier ID:",I),U(I)},renderValue:_=>{if(!_)return e.jsx("em",{style:{color:"#999"},children:"Select supplier..."});const I=h.find(O=>O.id===_);return(I==null?void 0:I.name)||"Unknown"},sx:{width:"100%","& .MuiSelect-select":{overflow:"visible",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingRight:"32px"}},MenuProps:{PaperProps:{sx:{maxHeight:300,"& .MuiMenuItem-root":{whiteSpace:"normal",wordBreak:"break-word"}}}},children:[e.jsx(se,{value:"",children:"Select supplier..."}),h.map(_=>e.jsx(se,{value:_.id,children:_.name},_.id))]})]}),L?e.jsxs(u,{sx:{display:"flex",gap:1},children:[e.jsx(je,{fullWidth:!0,size:"small",label:"New supplier name",value:P,onChange:_=>k(_.target.value),onKeyDown:_=>_.key==="Enter"&&N(),autoFocus:!0}),e.jsx(A,{variant:"contained",size:"small",onClick:N,disabled:g||!P.trim(),children:g?e.jsx(ye,{size:16}):"Add"}),e.jsx(fe,{size:"small",onClick:()=>{a(!1),k("")},children:e.jsx(os,{fontSize:"small"})})]}):e.jsx(A,{variant:"outlined",size:"small",startIcon:e.jsx(Ss,{}),onClick:()=>a(!0),fullWidth:!0,children:"Add New Supplier"})]}),e.jsxs(u,{sx:{mb:2},children:[e.jsx("input",{type:"file",id:"file-upload",hidden:!0,accept:".csv,.xlsx,.xls",onChange:Z}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(u,{sx:{border:"2px dashed",borderColor:v?"primary.main":"divider",borderRadius:2,p:4,textAlign:"center",cursor:"pointer",bgcolor:v?"primary.50":"background.paper","&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},children:v?e.jsxs(u,{children:[e.jsx(t,{variant:"body1",fontWeight:"600",children:v.name}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[(v.size/1024).toFixed(1)," KB"]}),e.jsx(t,{variant:"caption",color:"primary",sx:{display:"block",mt:1},children:"Click to change"})]}):e.jsxs(u,{children:[e.jsx(us,{sx:{fontSize:32,color:"text.secondary",mb:1}}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Drop CSV or Excel file here"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:".csv, .xlsx, .xls"})]})})})]}),G&&e.jsx(ne,{severity:"error",sx:{mb:2},children:G}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"center"},children:"All products in this file will be assigned to the selected supplier"})]})]}),e.jsx(me,{children:(r==null?void 0:r.status)==="completed"?e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:M,children:"Upload Another"}),e.jsx(A,{variant:"contained",onClick:x,children:"Done"})]}):(r==null?void 0:r.status)==="failed"?e.jsx(A,{onClick:M,children:"Try Again"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:x,children:"Cancel"}),e.jsx(A,{variant:"contained",onClick:X,disabled:!v||!m||F,startIcon:F?null:e.jsx(us,{}),sx:{"&:disabled":{opacity:.5}},children:F?e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ye,{size:16}),"Starting..."]}):`Upload to ${re||"Supplier"}`})]})})]}),e.jsx(it,{open:ie,onClose:()=>{Q(!1),$(!1)},previewData:oe,onConfirm:b})]})}function ct({open:n,onClose:x,productsWithoutSuppliers:c=[],groupedByFile:h={},productCount:f=0,onConfirm:m}){const{suppliers:U,loading:P,createSupplier:k,refreshSuppliers:L}=Ts(),{showToast:a}=es(),[g,i]=l.useState(""),[v,S]=l.useState(!1),[E,p]=l.useState(!1);l.useEffect(()=>{n&&U.length>0&&!g&&i(U[0].id)},[n,U,g]);const r=async()=>{var z,F,$,G,j;if(!g){a("Please select a supplier","error");return}p(!0);try{const T=c.map(D=>(D==null?void 0:D.id)||(D==null?void 0:D.product_id)).filter(D=>D&&!D.toString().startsWith("placeholder-"));if(T.length===0){const ie=(await W.post("/products/assign-supplier",{supplier_id:g,assign_all_pending:!0})).data.total||c.length;a(`Assigned supplier to ${ie} products`,"success"),setTimeout(()=>{m(g),x()},1e3);return}const oe=(await W.post("/products/assign-supplier",{product_ids:T,supplier_id:g})).data.total;a(`Assigned supplier to ${oe} products`,"success"),setTimeout(()=>{m(g),x()},1e3)}catch(T){console.error("Failed to assign suppliers:",T);const J=(($=(F=(z=T.response)==null?void 0:z.data)==null?void 0:F.detail)==null?void 0:$.message)||((j=(G=T.response)==null?void 0:G.data)==null?void 0:j.detail)||"Failed to assign suppliers";a(J,"error")}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{open:n,onClose:x,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:e.jsx(t,{variant:"h6",fontWeight:600,children:"Select Supplier for Analysis"})}),e.jsxs(ue,{children:[e.jsxs(ne,{severity:"warning",sx:{mb:3},children:[e.jsxs(t,{variant:"body2",fontWeight:600,gutterBottom:!0,children:[f||c.length," product",(f||c.length)!==1?"s":""," ",(f||c.length)===1?"has":"have"," no supplier assigned."]}),e.jsx(t,{variant:"body2",children:"Analysis requires a supplier to track where products come from. Please select a supplier to assign to these products."})]}),e.jsx(u,{sx:{mb:2},children:e.jsxs(ke,{fullWidth:!0,children:[e.jsx(Ae,{children:"Supplier"}),e.jsx(Pe,{value:g,onChange:z=>i(z.target.value),label:"Supplier",disabled:E||P,children:U.map(z=>e.jsx(se,{value:z.id,children:z.name},z.id))})]})}),e.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(A,{startIcon:e.jsx(Ss,{}),onClick:()=>S(!0),variant:"outlined",size:"small",children:"Create New Supplier"})}),e.jsx(Ms,{sx:{my:2}}),Object.keys(h).length>0?e.jsxs(u,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Products grouped by file:"}),Object.entries(h).map(([z,F])=>e.jsxs(u,{sx:{mb:1,p:1,bgcolor:"action.hover",borderRadius:1},children:[e.jsxs(t,{variant:"caption",fontWeight:600,display:"block",children:[z,": ",F.length," product",F.length!==1?"s":""]}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[F.slice(0,5).map($=>$.asin).join(", "),F.length>5&&` ... and ${F.length-5} more`]})]},z))]}):c.length>0&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Products: ",c.slice(0,10).map(z=>z.asin).join(", "),c.length>10&&` ... and ${c.length-10} more`]})]}),e.jsxs(me,{children:[e.jsx(A,{onClick:x,disabled:E,children:"Cancel"}),e.jsx(A,{onClick:r,variant:"contained",disabled:!g||E,children:E?"Assigning...":`Assign to ${f||c.length} Product${(f||c.length)!==1?"s":""}`})]})]}),e.jsx(Js,{open:v,onClose:async()=>{S(!1),L&&await L()},supplier:null})]})}function dt({productIds:n=null,analyzeAllPending:x=!1,onComplete:c=null,buttonText:h="Analyze All",className:f=""}){const{hasFeature:m,promptUpgrade:U}=js(),{showToast:P}=es(),[k,L]=l.useState(null),[a,g]=l.useState(null),[i,v]=l.useState(!1),[S,E]=l.useState(!1),[p,r]=l.useState(!1),[z,F]=l.useState(!1),[$,G]=l.useState([]),[j,T]=l.useState({}),[J,oe]=l.useState(0);l.useEffect(()=>{if(!k)return;const q=setInterval(async()=>{var M;try{const N=await W.get(`/jobs/${k}`);g(N.data),(N.data.status==="completed"||N.data.status==="failed"||N.data.status==="cancelled")&&(clearInterval(q),N.data.status==="completed"&&c&&c(N.data))}catch(N){console.error("Error polling job:",N),((M=N.response)==null?void 0:M.status)===404&&clearInterval(q)}},2e3);return()=>clearInterval(q)},[k,c]);const D=async()=>{var q,M,N,Z,X,b;if(!m("bulk_analyze")){U("bulk_analyze");return}v(!0);try{const re={};n?re.product_ids=n:x&&(re.analyze_all_pending=!0);const y=await W.post("/batch/analyze",re);L(y.data.job_id),g({status:"pending",total_items:y.data.total,progress:0}),E(!0)}catch(re){console.error("Error starting batch:",re),console.error("Error response:",(q=re.response)==null?void 0:q.data),console.error("Error response detail:",(N=(M=re.response)==null?void 0:M.data)==null?void 0:N.detail);const y=(X=(Z=re.response)==null?void 0:Z.data)==null?void 0:X.detail;let B=y;if(typeof y=="string")try{B=JSON.parse(y)}catch{B={message:y}}if(console.log("Parsed error object:",B),B&&typeof B=="object"&&B.error==="products_missing_suppliers"){console.log("Products without suppliers:",B.products),console.log("Grouped by file:",B.grouped_by_file),console.log("Count:",B.count);const R=B.count||((b=B.products)==null?void 0:b.length)||0,be=B.products||[];oe(R);let Se=be;R>0&&be.length===0&&(Se=Array(Math.min(R,100)).fill(null).map((_e,Ce)=>({id:`placeholder-${Ce}`,asin:"...",title:"Product details loading..."}))),G(Se),T(B.grouped_by_file||{}),F(!0)}else{const R=(B==null?void 0:B.message)||(y==null?void 0:y.message)||(typeof y=="string"?y:JSON.stringify(y))||"Failed to start analysis";console.error("Showing error toast:",R),P(R,"error")}}finally{v(!1)}},ie=async q=>{F(!1),G([]),setTimeout(()=>{D()},2e3)},Q=async()=>{var q,M;if(k)try{await W.post(`/jobs/${k}/cancel`),g(N=>({...N,status:"cancelled"})),setTimeout(()=>{E(!1),ae()},1e3)}catch(N){console.error("Error cancelling:",N);const Z=((M=(q=N.response)==null?void 0:q.data)==null?void 0:M.detail)||N.message||"Failed to cancel job";P(`Failed to cancel: ${Z}`,"error")}},ae=()=>{L(null),g(null),E(!1),r(!1)};if(S&&a){const q=a.status==="processing"||a.status==="pending",M=a.status==="completed",N=a.status==="failed",Z=a.status==="cancelled",X=a.errors||[],b=q&&a.processed_items>0?Math.ceil((a.total_items-a.processed_items)/5):0;return e.jsxs(xe,{open:S,onClose:q?void 0:ae,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(he,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(t,{variant:"h6",children:[q&&"Analyzing Products...",M&&"Analysis Complete",N&&"Analysis Failed",Z&&"Analysis Cancelled"]}),!q&&e.jsx(fe,{onClick:ae,size:"small",children:e.jsx(os,{})})]}),e.jsxs(ue,{children:[e.jsxs(u,{sx:{mb:2},children:[e.jsx(ms,{variant:"determinate",value:a.progress||0,sx:{mb:1,height:8,borderRadius:1},color:M?"success":N?"error":"primary"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[a.processed_items||0," / ",a.total_items||0," products"]})]}),e.jsxs(u,{sx:{mb:2},children:[a.success_count>0&&e.jsxs(t,{variant:"body2",color:"success.main",sx:{mb:.5},children:["âœ“ Success: ",a.success_count]}),a.error_count>0&&e.jsxs(t,{variant:"body2",color:"error.main",sx:{mb:.5},children:["âœ— Errors: ",a.error_count]})]}),q&&b>0&&e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:2},children:["~",b," seconds remaining"]}),M&&e.jsxs(ne,{severity:"success",sx:{mb:2},children:[e.jsx(Xe,{children:"Analysis Complete"}),e.jsxs(t,{variant:"body2",children:["Successfully analyzed ",a.success_count," products",a.error_count>0&&", {job.error_count} errors"]})]}),N&&e.jsxs(ne,{severity:"error",sx:{mb:2},children:[e.jsx(Xe,{children:"Analysis Failed"}),e.jsx(t,{variant:"body2",children:X[0]||"Unknown error"})]}),X.length>0&&e.jsxs(u,{sx:{mt:2},children:[e.jsxs(A,{size:"small",onClick:()=>r(!p),endIcon:p?e.jsx(_s,{}):e.jsx(Cs,{}),children:["View ",X.length," ",X.length===1?"error":"errors"]}),e.jsx(Ye,{in:p,children:e.jsxs(gs,{dense:!0,sx:{maxHeight:200,overflow:"auto",mt:1},children:[X.slice(0,20).map((re,y)=>e.jsx(rs,{children:e.jsx(ns,{primary:re,primaryTypographyProps:{variant:"caption"}})},y)),X.length>20&&e.jsx(rs,{children:e.jsx(ns,{primary:`... and ${X.length-20} more errors`,primaryTypographyProps:{variant:"caption",color:"text.secondary"}})})]})})]})]}),e.jsxs(me,{children:[q&&e.jsx(A,{onClick:Q,color:"error",children:"Cancel"}),!q&&e.jsx(A,{onClick:ae,variant:"contained",children:M?"Done":"Close"})]})]})}const ve=m("bulk_analyze");return e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"contained",onClick:D,disabled:i||!ve,startIcon:i?e.jsx(ye,{size:16}):e.jsx(at,{}),className:f,title:ve?"":"Bulk analysis requires Starter or higher",children:i?"Starting...":h}),e.jsx(ct,{open:z,onClose:()=>{F(!1),G([]),T({})},productsWithoutSuppliers:$,groupedByFile:j,productCount:J,onConfirm:ie})]})}const ut=({open:n,onClose:x,deal:c,analysis:h,onSave:f})=>{var v,S,E;const[m,U]=l.useState(""),[P,k]=l.useState(!1),{showToast:L}=es(),a=l.useMemo(()=>{var J,oe;if(!m||!c)return null;const p=parseFloat(m);if(isNaN(p)||p<=0)return null;const r=c.buy_cost||((oe=(J=c.product_sources)==null?void 0:J[0])==null?void 0:oe.buy_cost)||0,z=p*.15+4.5,F=.35*.5,G=r+F+.1,j=p-z-G,T=G>0?j/G*100:0;return{fees:z,profit:j,roi:T,landed:G}},[m,c]),g=async()=>{var p,r;if(!(!m||!(h!=null&&h.id))){k(!0);try{await W.patch(`/analysis/${h.id}/manual-price`,{sell_price:parseFloat(m)}),L("Manual price saved successfully","success"),f(),x(),U("")}catch(z){L(((r=(p=z.response)==null?void 0:p.data)==null?void 0:r.detail)||"Failed to save manual price","error")}finally{k(!1)}}},i=p=>({no_active_offers:"No active sellers on Amazon",no_response:"No response from Amazon API",gated:"Product is gated/restricted",invalid_asin:"ASIN may be invalid",unknown:"Unknown reason"})[p]||p||"Unknown";return e.jsxs(xe,{open:n,onClose:x,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:"Enter Manual Sell Price"}),e.jsxs(ue,{children:[e.jsx(ne,{severity:"warning",sx:{mb:2},children:"No pricing data available from Amazon. You can enter a manual sell price based on your research."}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:(c==null?void 0:c.title)||"Unknown Product"}),e.jsxs(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["ASIN: ",c==null?void 0:c.asin," | Buy Cost: $",(c==null?void 0:c.buy_cost)||((S=(v=c==null?void 0:c.product_sources)==null?void 0:v[0])==null?void 0:S.buy_cost)||"0.00"]}),(h==null?void 0:h.pricing_status_reason)&&e.jsx(de,{label:`Reason: ${i(h.pricing_status_reason)}`,size:"small",color:"warning",sx:{mb:2}}),(h==null?void 0:h.fba_lowest_365d)&&e.jsxs(ne,{severity:"info",sx:{mb:2},children:["Keepa shows historical FBA low of $",(E=h.fba_lowest_365d)==null?void 0:E.toFixed(2),h.amazon_was_seller&&" (Amazon was a seller)"]}),e.jsx(je,{label:"Sell Price",type:"number",step:"0.01",value:m,onChange:p=>U(p.target.value),fullWidth:!0,InputProps:{startAdornment:e.jsx(fs,{position:"start",children:"$"})},sx:{mt:2},autoFocus:!0}),a&&e.jsxs(u,{sx:{mt:2,p:2,bgcolor:"grey.100",borderRadius:1},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Estimated (fees are approximate):"}),e.jsxs(t,{variant:"body2",children:["Fees: ~$",a.fees.toFixed(2)]}),e.jsxs(t,{variant:"body2",children:["Landed Cost: $",a.landed.toFixed(2)]}),e.jsxs(t,{variant:"body2",children:["Profit: $",a.profit.toFixed(2)]}),e.jsxs(t,{variant:"body1",fontWeight:"bold",color:a.roi>=30?"success.main":a.roi>0?"warning.main":"error.main",sx:{mt:1},children:["ROI: ",a.roi.toFixed(1),"%"]})]}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"Note: Fees are estimated at ~15% referral + $4.50 FBA. Re-analyze when product has active offers for accurate fees."})]}),e.jsxs(me,{children:[e.jsx(A,{onClick:x,children:"Cancel"}),e.jsx(A,{onClick:g,variant:"contained",disabled:!m||P||isNaN(parseFloat(m))||parseFloat(m)<=0,children:P?e.jsx(ye,{size:20}):"Save Manual Price"})]})]})},pt=[{id:"new",label:"New",icon:is,color:te.purple.main},{id:"analyzing",label:"Analyzing",icon:as,color:te.warning.main},{id:"reviewed",label:"Reviewed",icon:Us,color:te.info.main},{id:"buy_list",label:"Buy List",icon:ys,color:te.success.main},{id:"ordered",label:"Ordered",icon:rt,color:te.gray[400]}];function ps(n,x){const[c,h]=l.useState(n);return l.useEffect(()=>{const f=setTimeout(()=>{h(n)},x);return()=>{clearTimeout(f)}},[n,x]),c}const ws=qs.memo(({deal:n,selected:x,onSelect:c,onClick:h,onUpdateMoq:f,onDelete:m,onSetAsin:U,onOpenManualPrice:P,onSelectAsin:k,onEnterAsin:L,onMoveToBuyList:a,analysis:g})=>{const i=n.roi||0,v=n.profit||0,S=n.moq||1,E=n.buy_cost||0,p=n.total_investment||S*E,r=S*v,z=n.asin_status||"found",F=z==="not_found"||!n.asin,$=z==="multiple_found",G=n.potential_asins||[],j=n.is_variation&&n.variation_count>1,T=g||{},J=T.pricing_status||"complete",oe=T.needs_review||J==="no_pricing",[D,ie]=l.useState(!1),[Q,ae]=l.useState(S),[ve,q]=l.useState(!1),[M,N]=l.useState(""),Z=()=>{f(n.deal_id,Q),ie(!1)},X=()=>{M.length===10&&(U(n.product_id,M),q(!1),N(""))};return e.jsxs(u,{sx:{display:"grid",gridTemplateColumns:"40px 50px 140px 1fr 120px 70px 60px 80px 80px 90px 80px 80px 60px",p:1.5,borderBottom:"1px solid",borderColor:"divider",alignItems:"center",gap:1,"&:hover":{bgcolor:"action.hover"},cursor:"pointer"},onClick:h,children:[e.jsx(Qe,{size:"small",checked:x,onClick:b=>b.stopPropagation(),onChange:c}),e.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:n.image_url?e.jsx(u,{component:"img",src:n.image_url,sx:{width:40,height:40,borderRadius:1,objectFit:"cover",flexShrink:0,border:"1px solid",borderColor:"divider"},onError:b=>{b.target.style.display="none"}}):e.jsx(u,{sx:{width:40,height:40,bgcolor:"grey.100",borderRadius:1,border:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(is,{size:20,color:"#999"})})}),e.jsx(u,{sx:{display:"flex",flexDirection:"column",gap:.5},children:$?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(de,{label:`Choose ASIN (${G.length})`,color:"warning",size:"small",onClick:b=>{b.stopPropagation(),k&&k(n)},sx:{fontSize:10,height:20,cursor:"pointer","&:hover":{bgcolor:"warning.dark"}}}),n.upc&&e.jsxs(t,{variant:"caption",color:"text.secondary",fontSize:9,children:["UPC: ",n.upc]})]}):F?e.jsxs(e.Fragment,{children:[ve?e.jsxs(u,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[e.jsx(je,{size:"small",placeholder:"Enter ASIN",value:M,onChange:b=>N(b.target.value.toUpperCase().slice(0,10)),onClick:b=>b.stopPropagation(),sx:{width:100,fontSize:11},inputProps:{style:{fontSize:11,fontFamily:"monospace"}}}),e.jsx(A,{size:"small",variant:"contained",onClick:b=>{b.stopPropagation(),X()},disabled:M.length!==10,sx:{minWidth:40,height:28,fontSize:10},children:"Save"})]}):e.jsx(u,{sx:{display:"flex",gap:.5,alignItems:"center"},children:e.jsx(de,{label:"Enter ASIN",color:"error",size:"small",onClick:b=>{b.stopPropagation(),L&&L(n)},sx:{fontSize:10,height:20,cursor:"pointer","&:hover":{bgcolor:"error.dark"}}})}),n.upc&&e.jsxs(t,{variant:"caption",color:"text.secondary",fontSize:10,children:["UPC: ",n.upc]})]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"body2",fontFamily:"monospace",fontSize:12,fontWeight:500,children:n.asin}),j&&e.jsx(de,{label:`Variation (${n.variation_count})`,size:"small",variant:"outlined",sx:{fontSize:9,height:18,mt:.5}}),n.upc&&e.jsxs(t,{variant:"caption",color:"text.secondary",fontSize:9,children:["UPC: ",n.upc]})]})}),e.jsx(t,{variant:"body2",noWrap:!0,sx:{minWidth:0,fontWeight:500},children:n.title||(n.roi===void 0&&n.profit===void 0?"Pending analysis...":"Unknown Product")}),e.jsx(t,{variant:"body2",color:"text.secondary",noWrap:!0,children:n.supplier_name||"Unknown"}),e.jsx(u,{sx:{textAlign:"center",display:"flex",justifyContent:"center"},onClick:b=>b.stopPropagation(),children:D?e.jsx(je,{size:"small",type:"number",value:Q,onChange:b=>ae(parseInt(b.target.value)||1),onBlur:Z,onKeyDown:b=>b.key==="Enter"&&Z(),autoFocus:!0,sx:{width:50},inputProps:{min:1,style:{textAlign:"center",padding:"4px"}}}):e.jsx(de,{label:S,size:"small",variant:"outlined",onClick:()=>ie(!0),sx:{minWidth:40,cursor:"pointer",bgcolor:"background.paper",borderColor:"divider",color:"text.primary",fontWeight:500,"&:hover":{bgcolor:"action.hover",borderColor:te.purple.main,color:te.purple.main}}})}),e.jsx(u,{sx:{textAlign:"center"},children:e.jsx(t,{variant:"body2",color:"text.secondary",children:n.case_pack||n.pack_size||"-"})}),e.jsxs(u,{sx:{textAlign:"right"},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["$",(E||0).toFixed(2)]}),n.has_promo&&n.promo_percent&&e.jsx(de,{label:`${n.promo_percent}% OFF`,color:"success",size:"small",sx:{fontWeight:"bold",fontSize:9,height:18,mt:.5}})]}),e.jsxs(t,{variant:"body2",align:"right",fontWeight:"600",color:(p||0)>500?"warning.main":"text.primary",children:["$",(p||0).toFixed(2)]}),e.jsx(t,{variant:"body2",align:"right",fontWeight:"600",color:i>=30?"success.main":i>0?"warning.main":"error.main",children:i?`${i.toFixed(0)}%`:"-"}),e.jsx(we,{title:`Total: $${(r||0).toFixed(2)}`,children:e.jsxs(t,{variant:"body2",align:"right",color:(v||0)>0?"success.main":"error.main",children:["$",v?v.toFixed(2):"-"]})}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[oe&&e.jsx(we,{title:`Reason: ${T.pricing_status_reason||"No pricing data"}`,children:e.jsx(de,{label:J==="manual"?"Manual":"No Pricing",color:J==="manual"?"info":"warning",size:"small",onClick:b=>{b.stopPropagation(),J==="no_pricing"&&P&&P(n,T)},sx:{height:18,fontSize:9,cursor:J==="no_pricing"?"pointer":"default","&:hover":J==="no_pricing"?{bgcolor:"warning.dark"}:{}}})}),e.jsx(de,{label:n.stage||"new",size:"small",sx:{height:22,fontSize:11}})]}),e.jsxs(u,{sx:{display:"flex",gap:.5,alignItems:"center"},onClick:b=>b.stopPropagation(),children:[n.stage!=="buy_list"&&e.jsx(we,{title:"Move to Buy List",children:e.jsx(fe,{size:"small",onClick:b=>{b.stopPropagation(),a&&a(n)},sx:{color:"success.main"},children:e.jsx(ys,{size:14})})}),e.jsx(we,{title:"View on Amazon",children:e.jsx(fe,{size:"small",component:"a",href:`https://amazon.com/dp/${n.asin}`,target:"_blank",children:e.jsx(Zs,{size:14})})}),e.jsx(we,{title:"Delete product",children:e.jsx(fe,{size:"small",onClick:b=>{b.stopPropagation(),m(n)},sx:{color:"error.main"},children:e.jsx(Ge,{size:14})})})]})]})});ws.displayName="DealRow";function zt(){var O,V,le;const n=Rs(),x=l.useRef(!1),[c,h]=l.useState([]),[f,m]=l.useState({stages:{},total:0}),[U,P]=l.useState(!0),[k,L]=l.useState(null),[a,g]=l.useState([]),[i,v]=l.useState({minRoi:"",minProfit:"",search:"",supplier:"",asinStatus:"all",pricingStatus:"all"}),[S,E]=l.useState(!1),[p,r]=l.useState([]),[z,F]=l.useState(!1),[$,G]=l.useState(!1),[j,T]=l.useState({open:!1,deal:null}),[J,oe]=l.useState({open:!1,deal:null,analysis:null}),[D,ie]=l.useState({open:!1,product:null}),[Q,ae]=l.useState({open:!1,product:null,asinInput:""}),[ve,q]=l.useState({all:0,found:0,not_found:0,multiple_found:0,manual:0}),[M,N]=l.useState({all:0,asin_found:0,needs_selection:0,needs_asin:0,manual_entry:0}),[Z,X]=l.useState({open:!1,count:0}),{hasFeature:b,promptUpgrade:re}=js(),{showToast:y}=es(),B=ps(i.search,500),R=l.useCallback(async(s=!1)=>{var o,d,C;if(!x.current){x.current=!0,P(!0);try{const w=new URLSearchParams;k&&w.append("stage",k),i.minRoi&&w.append("min_roi",i.minRoi),i.minProfit&&w.append("min_profit",i.minProfit),B&&w.append("search",B),i.supplier&&w.append("supplier_id",i.supplier),i.asinStatus&&i.asinStatus!=="all"&&(w.append("asin_status",i.asinStatus),console.log("âœ… Adding asin_status to params:",i.asinStatus)),w.append("limit","100");const ce=`/products?${w.toString()}`;console.log("ðŸŒ API URL:",ce),s&&w.append("_t",Date.now().toString());const[Y,ss]=await Promise.all([W.get(ce),W.get(`/products/stats${s?`?_t=${Date.now()}`:""}`)]);console.log("ðŸ“¥ API Response:",{status:Y.status,hasData:!!Y.data,dataKeys:Y.data?Object.keys(Y.data):[],isArray:Array.isArray(Y.data)});let H=[];Array.isArray(Y.data)?H=Y.data:Array.isArray((o=Y.data)==null?void 0:o.deals)?H=Y.data.deals:Array.isArray((d=Y.data)==null?void 0:d.data)&&(H=Y.data.data),console.log("ðŸ” Filter applied:",i.asinStatus),console.log("ðŸ“¦ Products returned:",H.length),H.length>0&&console.log("âœ… First product ASIN:",H[0].asin),h(H);const pe=ss.data||{stages:{},total:0};m({...pe,stages:{...{new:0,analyzing:0,reviewed:0,top_products:0,buy_list:0,ordered:0},...pe.stages||{}},total:pe.total||0}),(C=Y.data)!=null&&C.counts&&q(Y.data.counts),console.log("Products loaded:",H.length,"items"),H.length>0&&(console.log("First product fields:",Object.keys(H[0])),console.log("First product sample:",{asin:H[0].asin,title:H[0].title,stage:H[0].stage,status:H[0].status,product_status:H[0].product_status,analysis_status:H[0].analysis_status,roi:H[0].roi,profit:H[0].profit,deal_score:H[0].deal_score})),console.log("Stats data:",pe),H.length===0&&pe.total===0&&console.warn("No products found - view might be empty or missing")}catch(w){console.error("Failed to fetch:",w),y("Failed to load products. Please try refreshing.","error")}finally{P(!1),x.current=!1}}},[k,i.minRoi,i.minProfit,B,i.supplier,i.asinStatus,y]),be=l.useCallback(async()=>{var s,o;try{const d=await W.get("/suppliers");let C=[];Array.isArray(d.data)?C=d.data:Array.isArray((s=d.data)==null?void 0:s.suppliers)?C=d.data.suppliers:Array.isArray((o=d.data)==null?void 0:o.data)&&(C=d.data.data),r(C)}catch(d){console.error("Failed to fetch suppliers:",d)}},[]),Se=l.useCallback(async()=>{try{const s=await W.get("/products/stats/asin-status");s.data&&(console.log("ðŸ“Š ASIN Stats:",s.data),N(s.data))}catch(s){console.error("Failed to fetch ASIN status stats:",s)}},[]);l.useEffect(()=>{R(),be(),Se()},[]);const _e=ps(k,300);l.useEffect(()=>{_e!==void 0&&R()},[_e]);const Ce=s=>{if(s.target.checked){const o=Array.isArray(c)?c:[];g(o.map(d=>d.deal_id))}else g([])},Ne=async()=>{var s,o;try{const d=new URLSearchParams;k&&d.append("stage",k),i.minRoi&&d.append("min_roi",i.minRoi),i.minProfit&&d.append("min_profit",i.minProfit),B&&d.append("search",B),i.supplier&&d.append("supplier_id",i.supplier),i.asinStatus&&i.asinStatus!=="all"&&d.append("asin_status",i.asinStatus),d.append("limit","10000");const C=await W.get(`/products?${d.toString()}`);let w=[];Array.isArray(C.data)?w=C.data:Array.isArray((s=C.data)==null?void 0:s.deals)?w=C.data.deals:Array.isArray((o=C.data)==null?void 0:o.data)&&(w=C.data.data);const ce=w.map(Y=>Y.deal_id).filter(Boolean);g(ce),y(`Selected all ${ce.length} products`,"success")}catch(d){He(d,y)}},$e=async()=>{if(a.length)try{await W.post("/products/bulk-action",{action:"delete",product_ids:a}),y(`Deleted ${a.length} product${a.length>1?"s":""}`,"success"),g([]),R(!0)}catch(s){He(s,y)}},ze=s=>{g(o=>o.includes(s)?o.filter(d=>d!==s):[...o,s])},Te=async()=>{if(a.length){G(!0);try{const s=await W.post("/products/bulk-analyze",{deal_ids:a});y(`Queued ${s.data.queued} products for analysis`,"success"),g([]),R()}catch(s){He(s,y)}finally{G(!1)}}},Me=async s=>{if(a.length)try{await W.post("/products/bulk-stage",{deal_ids:a,stage:s}),g([]),R()}catch(o){He(o,y)}},Re=s=>{R(!0),y(`Upload complete! ${(s==null?void 0:s.products_created)||0} products created.`,"success")},Ue=async()=>{var s,o;if(!b("export_data")){re("export_data");return}try{const d=k?`?stage=${k}`:"",w=(await W.get(`/products/export${d}`)).data.rows||[];if(!w.length)return;const ce=Object.keys(w[0]),Y=[ce.join(","),...w.map(ls=>ce.map(ks=>`"${ls[ks]||""}"`).join(","))].join(`
`),ss=new Blob([Y],{type:"text/csv"}),H=URL.createObjectURL(ss),pe=document.createElement("a");pe.href=H,pe.download=`deals-${k||"all"}-${Date.now()}.csv`,pe.click()}catch(d){console.error("Export failed:",d),y("Export failed: "+(((o=(s=d.response)==null?void 0:s.data)==null?void 0:o.detail)||d.message),"error")}},We=async(s,o)=>{var d,C;try{await W.patch(`/products/deal/${s}`,{moq:o}),h(w=>w.map(ce=>ce.deal_id===s?{...ce,moq:o,total_investment:(ce.buy_cost||0)*o}:ce))}catch(w){console.error("Failed to update MOQ:",w),y("Failed to update MOQ: "+(((C=(d=w.response)==null?void 0:d.data)==null?void 0:C.detail)||w.message),"error")}},Ee=async(s,o)=>{var d,C;try{await W.patch(`/products/${s}/asin`,{asin:o}),y("ASIN set successfully. Product is now ready for analysis.","success"),R(!0)}catch(w){console.error("Failed to set ASIN:",w),y("Failed to set ASIN: "+(((C=(d=w.response)==null?void 0:d.data)==null?void 0:C.detail)||w.message),"error")}},Ie=async(s,o)=>{var d,C;try{await W.post(`/products/${s}/select-asin`,{asin:o}),y("ASIN selected and queued for analysis","success"),ie({open:!1,product:null}),R(!0)}catch(w){console.error("Failed to select ASIN:",w),y("Failed to select ASIN: "+(((C=(d=w.response)==null?void 0:d.data)==null?void 0:C.detail)||w.message),"error")}},De=async()=>{var s,o;if(!(!Q.product||Q.asinInput.length!==10))try{await W.patch(`/products/${Q.product.product_id||Q.product.id}/manual-asin`,{asin:Q.asinInput.toUpperCase()}),y("ASIN set and queued for analysis","success"),ae({open:!1,product:null,asinInput:""}),R(!0)}catch(d){console.error("Failed to set manual ASIN:",d),y("Failed to set ASIN: "+(((o=(s=d.response)==null?void 0:s.data)==null?void 0:o.detail)||d.message),"error")}},Be=s=>{T({open:!0,deal:s,deleting:!1})},qe=async()=>{var s,o;if(j.deal){T(d=>({...d,deleting:!0}));try{await W.delete(`/products/deal/${j.deal.deal_id}`),y(`Product "${j.deal.asin}" deleted successfully`,"success"),h(d=>d.filter(C=>C.deal_id!==j.deal.deal_id)),g(d=>d.filter(C=>C!==j.deal.deal_id)),setTimeout(()=>R(!0),500),T({open:!1,deal:null,deleting:!1})}catch(d){console.error("Failed to delete product:",d);const C=((o=(s=d.response)==null?void 0:s.data)==null?void 0:o.detail)||d.message||"Failed to delete product";y(C,"error"),T(w=>({...w,deleting:!1}))}}},_=async s=>{var o,d;try{await W.patch(`/products/deal/${s.deal_id}`,{stage:"buy_list"}),y(`Product "${s.asin}" moved to Buy List`,"success"),R(!0)}catch(C){console.error("Failed to move to buy list:",C),y("Failed to move to buy list: "+(((d=(o=C.response)==null?void 0:o.data)==null?void 0:d.detail)||C.message),"error")}},I=l.useMemo(()=>{let s=c;return S&&(s=s.filter(o=>o.has_promo===!0)),i.pricingStatus&&i.pricingStatus!=="all"&&(s=s.filter(o=>{const d=o.analysis||{},C=d.pricing_status||"complete";return i.pricingStatus==="needs_review"?d.needs_review||C==="no_pricing":C===i.pricingStatus})),s},[c,S,i.pricingStatus]);return e.jsxs(u,{sx:{p:3},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h4",fontWeight:"700",children:"Products"}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[a.length>0&&e.jsx(dt,{productIds:a,buttonText:`Analyze ${a.length} Selected`,onComplete:()=>{g([]),setTimeout(()=>R(),1e3)}}),e.jsx(A,{variant:"outlined",startIcon:e.jsx(cs,{size:16}),onClick:()=>F(!0),children:"Upload File"})]})]}),e.jsx(u,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(Qs,{value:k||"all",onChange:(s,o)=>L(o==="all"?null:o),children:[e.jsx(ds,{value:"all",label:`All (${f.total||0})`}),pt.map(s=>{var o;return e.jsx(ds,{value:s.id,label:`${s.label} (${((o=f.stages)==null?void 0:o[s.id])||0})`,icon:e.jsx(s.icon,{size:14}),iconPosition:"start"},s.id)})]})}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(je,{size:"small",placeholder:"Search ASIN...",value:i.search,onChange:s=>v({...i,search:s.target.value}),InputProps:{startAdornment:e.jsx(fs,{position:"start",children:e.jsx(Ws,{size:16})})},sx:{width:200}}),e.jsx(je,{size:"small",placeholder:"Min ROI %",type:"number",value:i.minRoi,onChange:s=>v({...i,minRoi:s.target.value}),onBlur:()=>setTimeout(()=>R(),500),sx:{width:100}}),e.jsx(je,{size:"small",placeholder:"Min Profit $",type:"number",value:i.minProfit,onChange:s=>v({...i,minProfit:s.target.value}),onBlur:()=>setTimeout(()=>R(),500),sx:{width:100}}),e.jsxs(ke,{size:"small",sx:{width:150},children:[e.jsx(Ae,{children:"Supplier"}),e.jsxs(Pe,{value:i.supplier,label:"Supplier",onChange:s=>{v({...i,supplier:s.target.value}),setTimeout(()=>R(),500)},children:[e.jsx(se,{value:"",children:"All"}),p.map(s=>e.jsx(se,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(ke,{size:"small",sx:{width:180},children:[e.jsx(Ae,{children:"ASIN Status"}),e.jsxs(Pe,{value:i.asinStatus,label:"ASIN Status",onChange:s=>{const o=s.target.value;console.log("ðŸŽ¯ ASIN Status filter changed:",o),v({...i,asinStatus:o}),setTimeout(()=>R(!0),100)},children:[e.jsxs(se,{value:"all",children:["All Products (",M.all||0,")"]}),e.jsxs(se,{value:"asin_found",children:["ASIN Found (",M.asin_found||0,")"]}),e.jsxs(se,{value:"needs_selection",children:["Needs Selection (",M.needs_selection||0,")"]}),e.jsxs(se,{value:"needs_asin",children:["Needs ASIN (",M.needs_asin||0,")"]}),e.jsxs(se,{value:"manual_entry",children:["Manual Entry (",M.manual_entry||0,")"]})]})]}),e.jsxs(ke,{size:"small",sx:{width:150},children:[e.jsx(Ae,{children:"Pricing Status"}),e.jsxs(Pe,{value:i.pricingStatus,label:"Pricing Status",onChange:s=>{v({...i,pricingStatus:s.target.value})},children:[e.jsx(se,{value:"all",children:"All"}),e.jsx(se,{value:"complete",children:"Has Pricing"}),e.jsx(se,{value:"no_pricing",children:"No Pricing"}),e.jsx(se,{value:"manual",children:"Manual Price"}),e.jsx(se,{value:"needs_review",children:"Needs Review"})]})]}),e.jsx(Es,{control:e.jsx(Qe,{checked:S,onChange:s=>E(s.target.checked)}),label:"Has Promo Deal"}),e.jsx(u,{sx:{flex:1}}),a.length>0&&e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:[a.length," selected"]}),e.jsx(A,{size:"small",variant:"outlined",onClick:Ne,children:"Select All"}),e.jsx(A,{size:"small",variant:"contained",startIcon:$?e.jsx(ye,{size:14}):e.jsx(Ds,{size:14}),onClick:Te,disabled:$,children:"Analyze"}),e.jsx(A,{size:"small",variant:"outlined",onClick:()=>Me("buy_list"),children:"Move to Buy List"}),e.jsx(A,{size:"small",variant:"outlined",color:"error",startIcon:e.jsx(Ge,{size:14}),onClick:()=>X({open:!0,count:a.length}),children:"Delete All"}),e.jsx(A,{size:"small",variant:"outlined",color:"error",onClick:()=>g([]),children:e.jsx(Bs,{size:14})})]}),e.jsx(we,{title:"Refresh products (clears cache)",children:e.jsx(fe,{onClick:()=>{R(!0),y("Refreshing products...","info")},children:e.jsx(Gs,{size:18})})}),e.jsx(fe,{onClick:Ue,disabled:!b("export_data"),title:b("export_data")?"Export data":"Export requires Starter or higher",children:e.jsx(nt,{size:18})})]}),U?e.jsx(u,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(ye,{})}):I.length===0?e.jsxs(ge,{sx:{p:4,textAlign:"center"},children:[e.jsx(is,{size:48,color:te.gray[400]}),e.jsx(t,{variant:"h6",sx:{mt:2},children:"No deals found"}),e.jsx(t,{color:"text.secondary",sx:{mb:2},children:"Upload a CSV or Excel file to get started"}),e.jsx(A,{variant:"contained",startIcon:e.jsx(cs,{size:16}),onClick:()=>F(!0),children:"Upload File"})]}):e.jsxs(ge,{children:[e.jsxs(u,{sx:{display:{xs:"none",md:"grid"},gridTemplateColumns:"40px 50px 140px 1fr 120px 70px 60px 80px 80px 90px 80px 80px 60px",p:1.5,borderBottom:"1px solid",borderColor:"divider",bgcolor:"background.paper",gap:1,alignItems:"center"},children:[e.jsx(Qe,{size:"small",checked:a.length===I.length&&I.length>0,indeterminate:a.length>0&&a.length<I.length,onChange:Ce}),e.jsx(u,{})," ",e.jsx(t,{variant:"caption",color:"text.secondary",fontWeight:600,children:"ASIN"}),e.jsx(t,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Product"}),e.jsx(t,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Supplier"}),e.jsx(t,{variant:"caption",color:"text.secondary",align:"center",fontWeight:600,children:"MOQ"}),e.jsx(t,{variant:"caption",color:"text.secondary",align:"center",fontWeight:600,children:"Pack"}),e.jsx(t,{variant:"caption",color:"text.secondary",align:"right",fontWeight:600,children:"Unit $"}),e.jsx(t,{variant:"caption",color:"text.secondary",align:"right",fontWeight:600,children:"Total $"}),e.jsx(t,{variant:"caption",color:"text.secondary",align:"right",fontWeight:600,children:"ROI"}),e.jsx(t,{variant:"caption",color:"text.secondary",align:"right",fontWeight:600,children:"Profit"}),e.jsx(t,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Stage"}),e.jsx(t,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Actions"})]}),e.jsx(u,{sx:{display:{xs:"none",md:"block"}},children:I.map(s=>e.jsx(ws,{deal:s,selected:a.includes(s.deal_id),onSelect:()=>ze(s.deal_id),onClick:()=>n(`/deals/${s.deal_id}`),onUpdateMoq:We,onDelete:Be,onSetAsin:Ee,onSelectAsin:o=>ie({open:!0,product:o}),onEnterAsin:o=>ae({open:!0,product:o,asinInput:""}),onOpenManualPrice:(o,d)=>oe({open:!0,deal:o,analysis:d}),onMoveToBuyList:_,analysis:s.analysis},s.deal_id))}),e.jsx(u,{sx:{display:{xs:"flex",md:"none"},flexDirection:"column",gap:2,p:2},children:I.map(s=>e.jsxs(ge,{sx:{p:2,border:a.includes(s.deal_id)?`2px solid ${te.purple.main}`:"1px solid",borderColor:a.includes(s.deal_id)?te.purple.main:"divider",cursor:"pointer"},onClick:()=>n(`/deals/${s.deal_id}`),children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"start",mb:2,children:[e.jsxs(u,{display:"flex",gap:2,flex:1,children:[s.image_url&&e.jsx(u,{component:"img",src:s.image_url,sx:{width:64,height:64,borderRadius:1,objectFit:"cover"}}),e.jsxs(u,{flex:1,children:[e.jsx(t,{variant:"body2",fontWeight:600,mb:.5,children:s.title||(s.roi===void 0&&s.profit===void 0?"Pending analysis...":"Unknown Product")}),e.jsx(t,{variant:"caption",fontFamily:"monospace",color:"text.secondary",children:s.asin})]})]}),e.jsx(Qe,{size:"small",checked:a.includes(s.deal_id),onClick:o=>{o.stopPropagation(),ze(s.deal_id)}})]}),e.jsxs(u,{display:"flex",justifyContent:"space-between",gap:2,flexWrap:"wrap",children:[e.jsxs(u,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"ROI"}),e.jsx(t,{variant:"body2",fontWeight:600,color:s.roi>=30?"success.main":"text.primary",children:s.roi?`${s.roi.toFixed(0)}%`:"-"})]}),e.jsxs(u,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Profit"}),e.jsxs(t,{variant:"body2",fontWeight:600,color:s.profit>0?"success.main":"error.main",children:["$",s.profit?s.profit.toFixed(2):"-"]})]}),e.jsxs(u,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Cost"}),e.jsxs(t,{variant:"body2",children:["$",(s.buy_cost||0).toFixed(2)]})]}),e.jsx(de,{label:s.stage||"new",size:"small",sx:{height:22,fontSize:11}})]})]},s.deal_id))})]}),e.jsx(lt,{open:z,onClose:()=>F(!1),onComplete:Re}),e.jsx(ut,{open:J.open,onClose:()=>oe({open:!1,deal:null,analysis:null}),deal:J.deal,analysis:J.analysis,onSave:()=>{R(!0)}}),e.jsxs(xe,{open:D.open,onClose:()=>ie({open:!1,product:null}),maxWidth:"md",fullWidth:!0,children:[e.jsx(he,{children:"Choose the Correct ASIN"}),e.jsx(ue,{children:D.product&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{severity:"info",sx:{mb:2},children:["Multiple products found for UPC ",e.jsx("strong",{children:D.product.upc}),". Select the one that matches your supplier's product."]}),e.jsx(u,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2,mt:2},children:(O=D.product.potential_asins)==null?void 0:O.map(s=>e.jsxs(ge,{sx:{cursor:"pointer","&:hover":{boxShadow:6},border:"2px solid transparent",transition:"all 0.2s"},onClick:()=>Ie(D.product.product_id||D.product.id,s.asin),children:[s.image&&e.jsx(u,{component:"img",src:s.image,alt:s.title,sx:{width:"100%",height:200,objectFit:"contain",p:2,bgcolor:"background.default"}}),e.jsxs(ue,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:s.title||"Unknown Product"}),e.jsxs(t,{variant:"body2",color:"text.secondary",fontFamily:"monospace",children:["ASIN: ",s.asin]}),s.brand&&e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Brand: ",s.brand]}),s.category&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Category: ",s.category]}),e.jsx(A,{variant:"contained",fullWidth:!0,sx:{mt:2},onClick:o=>{o.stopPropagation(),Ie(D.product.product_id||D.product.id,s.asin)},children:"Select This One"})]})]},s.asin))})]})}),e.jsx(me,{children:e.jsx(A,{onClick:()=>ie({open:!1,product:null}),children:"Cancel"})})]}),e.jsxs(xe,{open:Q.open,onClose:()=>ae({open:!1,product:null,asinInput:""}),children:[e.jsx(he,{children:"Enter ASIN Manually"}),e.jsx(ue,{children:Q.product&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{severity:"info",sx:{mb:2},children:["No ASIN found for UPC ",e.jsx("strong",{children:Q.product.upc}),". Please enter the Amazon ASIN manually."]}),e.jsx(je,{autoFocus:!0,margin:"dense",label:"ASIN (10 characters)",type:"text",fullWidth:!0,value:Q.asinInput,onChange:s=>ae({...Q,asinInput:s.target.value.toUpperCase().slice(0,10)}),inputProps:{maxLength:10,style:{fontFamily:"monospace",fontSize:14}},helperText:"Example: B07VRZ8TK3"})]})}),e.jsxs(me,{children:[e.jsx(A,{onClick:()=>ae({open:!1,product:null,asinInput:""}),children:"Cancel"}),e.jsx(A,{onClick:De,variant:"contained",disabled:Q.asinInput.length!==10,children:"Save ASIN"})]})]}),e.jsxs(xe,{open:j.open,onClose:()=>!j.deleting&&T({open:!1,deal:null,deleting:!1}),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(he,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{size:24,style:{color:te.warning.main}}),"Delete Product"]}),e.jsxs(ue,{children:[e.jsx(ne,{severity:"warning",sx:{mb:2},children:"This action cannot be undone. All analysis data, pricing history, and related information will be permanently lost."}),j.deal&&e.jsxs(u,{children:[e.jsx(t,{variant:"body1",fontWeight:600,gutterBottom:!0,children:"Are you sure you want to delete this product?"}),e.jsxs(u,{sx:{mt:2,p:2,bgcolor:"background.default",borderRadius:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"ASIN:"}),e.jsx(t,{variant:"body2",fontFamily:"monospace",fontWeight:600,children:j.deal.asin}),j.deal.title&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Product:"}),e.jsx(t,{variant:"body2",children:j.deal.title})]}),(j.deal.roi!==void 0||j.deal.profit!==void 0)&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Analysis Data:"}),e.jsxs(t,{variant:"body2",children:[j.deal.roi!==void 0&&`ROI: ${(V=j.deal.roi)==null?void 0:V.toFixed(0)}%`,j.deal.roi!==void 0&&j.deal.profit!==void 0&&" | ",j.deal.profit!==void 0&&`Profit: $${(le=j.deal.profit)==null?void 0:le.toFixed(2)}`]})]})]}),e.jsx(t,{variant:"body2",color:"error.main",sx:{mt:2,fontWeight:600},children:"âš ï¸ All analysis data, profit calculations, and product history will be permanently deleted."})]})]}),e.jsxs(me,{children:[e.jsx(A,{onClick:()=>T({open:!1,deal:null,deleting:!1}),disabled:j.deleting,children:"Cancel"}),e.jsx(A,{onClick:qe,variant:"contained",color:"error",disabled:j.deleting,startIcon:j.deleting?e.jsx(ye,{size:16}):e.jsx(Ge,{size:16}),children:j.deleting?"Deleting...":"Delete Product"})]})]}),e.jsxs(xe,{open:Z.open,onClose:()=>X({open:!1,count:0}),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(he,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{size:24,style:{color:te.error.main}}),"Delete All Selected Products"]}),e.jsxs(ue,{children:[e.jsxs(ne,{severity:"error",sx:{mb:2},children:[e.jsx(t,{variant:"body2",fontWeight:600,children:"This action cannot be undone!"}),e.jsxs(t,{variant:"body2",sx:{mt:1},children:["All analysis data, pricing history, and related information for ",Z.count," product",Z.count!==1?"s":""," will be permanently lost."]})]}),e.jsxs(t,{variant:"body1",fontWeight:600,gutterBottom:!0,children:["Are you sure you want to delete ",Z.count," product",Z.count!==1?"s":"","?"]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will permanently remove all selected products from your account. This action cannot be reversed."})]}),e.jsxs(me,{children:[e.jsx(A,{onClick:()=>X({open:!1,count:0}),children:"Cancel"}),e.jsxs(A,{onClick:async()=>{X({open:!1,count:0}),await $e()},variant:"contained",color:"error",startIcon:e.jsx(Ge,{size:16}),children:["Delete All ",Z.count," Product",Z.count!==1?"s":""]})]})]})]})}export{zt as default};

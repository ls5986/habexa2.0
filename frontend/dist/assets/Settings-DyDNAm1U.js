import{r as l,t as ue,v as he,w as me,_ as xe,x as T,j as e,y as X,z as ie,E as ge,a3 as Oe,ao as at,af as He,c as fe,o as k,ap as Ke,ab as Te,C as H,b as K,p as ae,B as p,T as h,d as oe,O as J,a as z,h as $,aq as nt,k as rt,q as R,l as st,a4 as Re,a5 as Ee,a6 as $e,ar as ot,J as Ue,I as lt,X as Ge,Y as Je,$ as Xe,D as it,i as ct,u as dt,as as pt,K as ut,f as ht,at as Ae}from"./index-DJeRhYJi.js";import{C as De}from"./check-circle-CDhjJ7dE.js";import{M as we}from"./message-circle-pbtAkKZH.js";import{P as mt,D as Qe}from"./plus-CpQxcSIg.js";import{L as Be,S as Me}from"./Switch-DvySzL94.js";import{T as xt}from"./trash-2-QZjX2iKO.js";import{F as Le}from"./FormControlLabel-jah7zOCe.js";import{C as gt}from"./Checkbox-CBdW0AXR.js";import{T as ft,a as pe}from"./Tabs-CErR3Ypt.js";import{S as Ye}from"./Slider-PMTIm_je.js";import{T as yt,a as bt,b as vt,c as _e}from"./TableRow-CPAAtmGq.js";import{E as jt}from"./external-link-DArXF2mN.js";import"./SwitchBase-LM0WE4No.js";import"./useThemeProps-CpAx3BOw.js";const ke=l.createContext({}),We=l.createContext({});function Ct(a){return ue("MuiStep",a)}he("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const St=["active","children","className","component","completed","disabled","expanded","index","last"],wt=a=>{const{classes:t,orientation:s,alternativeLabel:i,completed:c}=a;return ge({root:["root",s,i&&"alternativeLabel",c&&"completed"]},Ct,t)},_t=X("div",{name:"MuiStep",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:s}=a;return[t.root,t[s.orientation],s.alternativeLabel&&t.alternativeLabel,s.completed&&t.completed]}})(({ownerState:a})=>T({},a.orientation==="horizontal"&&{paddingLeft:8,paddingRight:8},a.alternativeLabel&&{flex:1,position:"relative"})),Lt=l.forwardRef(function(t,s){const i=me({props:t,name:"MuiStep"}),{active:c,children:m,className:g,component:u="div",completed:y,disabled:b,expanded:f=!1,index:x,last:P}=i,C=xe(i,St),{activeStep:n,connector:w,alternativeLabel:d,orientation:v,nonLinear:A}=l.useContext(ke);let[j=!1,V=!1,B=!1]=[c,y,b];n===x?j=c!==void 0?c:!0:!A&&n>x?V=y!==void 0?y:!0:!A&&n<x&&(B=b!==void 0?b:!0);const M=l.useMemo(()=>({index:x,last:P,expanded:f,icon:x+1,active:j,completed:V,disabled:B}),[x,P,f,j,V,B]),Y=T({},i,{active:j,orientation:v,alternativeLabel:d,completed:V,disabled:B,expanded:f,component:u}),O=wt(Y),E=e.jsxs(_t,T({as:u,className:ie(O.root,g),ref:s,ownerState:Y},C,{children:[w&&d&&x!==0?w:null,m]}));return e.jsx(We.Provider,{value:M,children:w&&!d&&x!==0?e.jsxs(l.Fragment,{children:[w,E]}):E})}),kt=Oe(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),zt=Oe(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Pt(a){return ue("MuiStepIcon",a)}const Ie=he("MuiStepIcon",["root","active","completed","error","text"]);var Ve;const Ft=["active","className","completed","error","icon"],At=a=>{const{classes:t,active:s,completed:i,error:c}=a;return ge({root:["root",s&&"active",i&&"completed",c&&"error"],text:["text"]},Pt,t)},Ne=X(at,{name:"MuiStepIcon",slot:"Root",overridesResolver:(a,t)=>t.root})(({theme:a})=>({display:"block",transition:a.transitions.create("color",{duration:a.transitions.duration.shortest}),color:(a.vars||a).palette.text.disabled,[`&.${Ie.completed}`]:{color:(a.vars||a).palette.primary.main},[`&.${Ie.active}`]:{color:(a.vars||a).palette.primary.main},[`&.${Ie.error}`]:{color:(a.vars||a).palette.error.main}})),Mt=X("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(a,t)=>t.text})(({theme:a})=>({fill:(a.vars||a).palette.primary.contrastText,fontSize:a.typography.caption.fontSize,fontFamily:a.typography.fontFamily})),It=l.forwardRef(function(t,s){const i=me({props:t,name:"MuiStepIcon"}),{active:c=!1,className:m,completed:g=!1,error:u=!1,icon:y}=i,b=xe(i,Ft),f=T({},i,{active:c,completed:g,error:u}),x=At(f);if(typeof y=="number"||typeof y=="string"){const P=ie(m,x.root);return u?e.jsx(Ne,T({as:zt,className:P,ref:s,ownerState:f},b)):g?e.jsx(Ne,T({as:kt,className:P,ref:s,ownerState:f},b)):e.jsxs(Ne,T({className:P,ref:s,ownerState:f},b,{children:[Ve||(Ve=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(Mt,{className:x.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:f,children:y})]}))}return y});function Nt(a){return ue("MuiStepLabel",a)}const ne=he("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),Dt=["children","className","componentsProps","error","icon","optional","slotProps","StepIconComponent","StepIconProps"],Tt=a=>{const{classes:t,orientation:s,active:i,completed:c,error:m,disabled:g,alternativeLabel:u}=a;return ge({root:["root",s,m&&"error",g&&"disabled",u&&"alternativeLabel"],label:["label",i&&"active",c&&"completed",m&&"error",g&&"disabled",u&&"alternativeLabel"],iconContainer:["iconContainer",i&&"active",c&&"completed",m&&"error",g&&"disabled",u&&"alternativeLabel"],labelContainer:["labelContainer",u&&"alternativeLabel"]},Nt,t)},Wt=X("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:s}=a;return[t.root,t[s.orientation]]}})(({ownerState:a})=>T({display:"flex",alignItems:"center",[`&.${ne.alternativeLabel}`]:{flexDirection:"column"},[`&.${ne.disabled}`]:{cursor:"default"}},a.orientation==="vertical"&&{textAlign:"left",padding:"8px 0"})),Rt=X("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(a,t)=>t.label})(({theme:a})=>T({},a.typography.body2,{display:"block",transition:a.transitions.create("color",{duration:a.transitions.duration.shortest}),[`&.${ne.active}`]:{color:(a.vars||a).palette.text.primary,fontWeight:500},[`&.${ne.completed}`]:{color:(a.vars||a).palette.text.primary,fontWeight:500},[`&.${ne.alternativeLabel}`]:{marginTop:16},[`&.${ne.error}`]:{color:(a.vars||a).palette.error.main}})),Et=X("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(a,t)=>t.iconContainer})(()=>({flexShrink:0,display:"flex",paddingRight:8,[`&.${ne.alternativeLabel}`]:{paddingRight:0}})),$t=X("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(a,t)=>t.labelContainer})(({theme:a})=>({width:"100%",color:(a.vars||a).palette.text.secondary,[`&.${ne.alternativeLabel}`]:{textAlign:"center"}})),Ze=l.forwardRef(function(t,s){var i;const c=me({props:t,name:"MuiStepLabel"}),{children:m,className:g,componentsProps:u={},error:y=!1,icon:b,optional:f,slotProps:x={},StepIconComponent:P,StepIconProps:C}=c,n=xe(c,Dt),{alternativeLabel:w,orientation:d}=l.useContext(ke),{active:v,disabled:A,completed:j,icon:V}=l.useContext(We),B=b||V;let M=P;B&&!M&&(M=It);const Y=T({},c,{active:v,alternativeLabel:w,completed:j,disabled:A,error:y,orientation:d}),O=Tt(Y),E=(i=x.label)!=null?i:u.label;return e.jsxs(Wt,T({className:ie(O.root,g),ref:s,ownerState:Y},n,{children:[B||M?e.jsx(Et,{className:O.iconContainer,ownerState:Y,children:e.jsx(M,T({completed:j,active:v,error:y,icon:B},C))}):null,e.jsxs($t,{className:O.labelContainer,ownerState:Y,children:[m?e.jsx(Rt,T({ownerState:Y},E,{className:ie(O.label,E==null?void 0:E.className),children:m})):null,f]})]}))});Ze.muiName="StepLabel";function Ut(a){return ue("MuiStepConnector",a)}he("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const Bt=["className"],Yt=a=>{const{classes:t,orientation:s,alternativeLabel:i,active:c,completed:m,disabled:g}=a,u={root:["root",s,i&&"alternativeLabel",c&&"active",m&&"completed",g&&"disabled"],line:["line",`line${He(s)}`]};return ge(u,Ut,t)},Vt=X("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:s}=a;return[t.root,t[s.orientation],s.alternativeLabel&&t.alternativeLabel,s.completed&&t.completed]}})(({ownerState:a})=>T({flex:"1 1 auto"},a.orientation==="vertical"&&{marginLeft:12},a.alternativeLabel&&{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"})),qt=X("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(a,t)=>{const{ownerState:s}=a;return[t.line,t[`line${He(s.orientation)}`]]}})(({ownerState:a,theme:t})=>{const s=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return T({display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:s},a.orientation==="horizontal"&&{borderTopStyle:"solid",borderTopWidth:1},a.orientation==="vertical"&&{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24})}),Ot=l.forwardRef(function(t,s){const i=me({props:t,name:"MuiStepConnector"}),{className:c}=i,m=xe(i,Bt),{alternativeLabel:g,orientation:u="horizontal"}=l.useContext(ke),{active:y,disabled:b,completed:f}=l.useContext(We),x=T({},i,{alternativeLabel:g,orientation:u,active:y,completed:f,disabled:b}),P=Yt(x);return e.jsx(Vt,T({className:ie(P.root,c),ref:s,ownerState:x},m,{children:e.jsx(qt,{className:P.line,ownerState:x})}))});function Ht(a){return ue("MuiStepper",a)}he("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const Kt=["activeStep","alternativeLabel","children","className","component","connector","nonLinear","orientation"],Gt=a=>{const{orientation:t,nonLinear:s,alternativeLabel:i,classes:c}=a;return ge({root:["root",t,s&&"nonLinear",i&&"alternativeLabel"]},Ht,c)},Jt=X("div",{name:"MuiStepper",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:s}=a;return[t.root,t[s.orientation],s.alternativeLabel&&t.alternativeLabel,s.nonLinear&&t.nonLinear]}})(({ownerState:a})=>T({display:"flex"},a.orientation==="horizontal"&&{flexDirection:"row",alignItems:"center"},a.orientation==="vertical"&&{flexDirection:"column"},a.alternativeLabel&&{alignItems:"flex-start"})),Xt=e.jsx(Ot,{}),Qt=l.forwardRef(function(t,s){const i=me({props:t,name:"MuiStepper"}),{activeStep:c=0,alternativeLabel:m=!1,children:g,className:u,component:y="div",connector:b=Xt,nonLinear:f=!1,orientation:x="horizontal"}=i,P=xe(i,Kt),C=T({},i,{nonLinear:f,alternativeLabel:m,orientation:x,component:y}),n=Gt(C),w=l.Children.toArray(g).filter(Boolean),d=w.map((A,j)=>l.cloneElement(A,T({index:j,last:j+1===w.length},A.props))),v=l.useMemo(()=>({activeStep:c,alternativeLabel:m,connector:b,nonLinear:f,orientation:x}),[c,m,b,f,x]);return e.jsx(ke.Provider,{value:v,children:e.jsx(Jt,T({as:y,ownerState:C,className:ie(n.root,u),ref:s},P,{children:d}))})});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=fe("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=fe("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=fe("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=fe("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=fe("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),aa=()=>{const[a,t]=l.useState(null),[s,i]=l.useState(null),[c,m]=l.useState(null),[g,u]=l.useState(!0),[y,b]=l.useState(null),f=async()=>{try{const d=await k.get("/settings/profile");t(d.data)}catch(d){b(d.message)}},x=async()=>{try{const d=await k.get("/settings/alerts");i(d.data)}catch(d){b(d.message)}},P=async()=>{try{const d=await k.get("/settings/costs");m(d.data)}catch(d){b(d.message)}};return l.useEffect(()=>{(async()=>{u(!0),await Promise.all([f(),x(),P()]),u(!1)})()},[]),{profile:a,alertSettings:s,costSettings:c,loading:g,error:y,refetch:async()=>{await Promise.all([f(),x(),P()])},updateProfile:async d=>{var v,A;try{const j=await k.put("/settings/profile",d);return t(j.data),j.data}catch(j){throw new Error(((A=(v=j.response)==null?void 0:v.data)==null?void 0:A.detail)||"Failed to update profile")}},updateAlertSettings:async d=>{var v,A;try{const j=await k.put("/settings/alerts",d);return i(j.data),j.data}catch(j){throw new Error(((A=(v=j.response)==null?void 0:v.data)==null?void 0:A.detail)||"Failed to update alert settings")}},updateCostSettings:async d=>{var v,A;try{const j=await k.put("/settings/costs",d);return m(j.data),j.data}catch(j){throw new Error(((A=(v=j.response)==null?void 0:v.data)==null?void 0:A.detail)||"Failed to update cost settings")}}}};function na(){const[a,t]=Ke(),[s,i]=l.useState(null),[c,m]=l.useState(!0),[g,u]=l.useState(!1),[y,b]=l.useState(null),{showToast:f}=Te();l.useEffect(()=>{if(x(),a.get("amazon_connected")==="true"&&(b({type:"success",text:"Amazon connected successfully!"}),f("Amazon account connected successfully!","success"),a.delete("amazon_connected"),t(a,{replace:!0}),x()),a.get("amazon_error")){const n=a.get("amazon_error");b({type:"error",text:n}),f(`Connection failed: ${n}`,"error"),a.delete("amazon_error"),t(a,{replace:!0})}},[]);const x=async()=>{try{const n=await k.get("/integrations/amazon/connection");i(n.data)}catch(n){console.error("Failed to fetch connection:",n),i({connected:!1})}finally{m(!1)}},P=async()=>{var n,w;u(!0);try{const d=await k.get("/integrations/amazon/oauth/authorize");window.location.href=d.data.authorization_url}catch(d){const v=((w=(n=d.response)==null?void 0:n.data)==null?void 0:w.detail)||"Failed to start connection";b({type:"error",text:v}),f(v,"error"),u(!1)}},C=async()=>{var n,w;if(confirm("Disconnect your Amazon account? You will need to reconnect to check gating status and get accurate fees."))try{await k.delete("/integrations/amazon/disconnect"),i({connected:!1}),b({type:"success",text:"Disconnected successfully"}),f("Amazon account disconnected","success"),x()}catch(d){const v=((w=(n=d.response)==null?void 0:n.data)==null?void 0:w.detail)||"Failed to disconnect";b({type:"error",text:v}),f(v,"error")}};return c?e.jsx(H,{children:e.jsx(K,{sx:{textAlign:"center",py:4},children:e.jsx(ae,{})})}):e.jsx(H,{children:e.jsxs(K,{children:[e.jsxs(p,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(qe,{size:32,style:{color:"#FF9900"}}),e.jsxs(p,{flex:1,children:[e.jsx(h,{variant:"h6",fontWeight:600,children:"Amazon Seller Account"}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Connect to check YOUR gating status and fees"})]}),(s==null?void 0:s.connected)&&e.jsx(oe,{icon:e.jsx(De,{size:16}),label:"Connected",color:"success"})]}),y&&e.jsx(J,{severity:y.type,sx:{mb:2},onClose:()=>b(null),children:y.text}),s!=null&&s.connected?e.jsxs(p,{children:[e.jsxs(p,{mb:2,children:[e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Seller ID:"})," ",s.seller_id||"Not available"]}),e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Marketplace:"})," ",s.marketplace_id||"US"]}),s.connected_at&&e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Connected:"})," ",new Date(s.connected_at).toLocaleDateString()]}),s.last_used_at&&e.jsxs(h,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Last used:"})," ",new Date(s.last_used_at).toLocaleString()]})]}),e.jsx(z,{variant:"outlined",color:"error",startIcon:e.jsx(et,{size:18}),onClick:C,children:"Disconnect"})]}):e.jsxs(p,{children:[e.jsx(J,{severity:"info",sx:{mb:2},children:"Connect your Amazon Seller account to see YOUR eligibility status on products. Each user connects their own account and sees their own gating status."}),e.jsx(z,{variant:"contained",size:"large",startIcon:g?e.jsx(ae,{size:20,color:"inherit"}):e.jsx(qe,{size:20}),onClick:P,disabled:g,sx:{bgcolor:"#FF9900","&:hover":{bgcolor:"#E88B00"},color:"#000"},children:g?"Connecting...":"Connect Amazon"})]}),!(s!=null&&s.connected)&&e.jsxs(p,{sx:{mt:3,p:2,bgcolor:$.gray[50],borderRadius:2,border:"1px solid",borderColor:$.gray[200]},children:[e.jsx(h,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"ðŸ”“ Why Connect?"}),e.jsxs(p,{component:"ul",sx:{m:0,pl:2.5},children:[e.jsx("li",{children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Real gating checks"})," â€” Know if YOU can list a product, not just estimates"]})}),e.jsx("li",{children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Accurate FBA fees"})," â€” Get exact fees from Amazon for your account"]})}),e.jsx("li",{children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Better analysis"})," â€” More accurate profit calculations based on your account"]})})]})]})]})})}const ra=["Enter Phone","Verify Code","Connected"],sa=()=>{const a=nt(),[t,s]=l.useState(null),[i,c]=l.useState(!0),[m,g]=l.useState(0),[u,y]=l.useState(""),[b,f]=l.useState(""),[x,P]=l.useState(""),[C,n]=l.useState(!1),[w,d]=l.useState(!1),[v,A]=l.useState([]),[j,V]=l.useState([]),[B,M]=l.useState(!1),[Y,O]=l.useState(!1),[E,Z]=l.useState({}),[F,G]=l.useState(null),[I,N]=l.useState({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),{showToast:_}=Te(),{getLimit:ye,isLimitReached:ee}=rt();l.useEffect(()=>{te()},[]);const te=async()=>{try{const r=await k.get("/integrations/telegram/status");s(r.data),r.data.connected&&re()}catch(r){console.error("Failed to fetch Telegram status:",r)}finally{c(!1)}},re=async()=>{try{const r=await k.get("/integrations/telegram/channels");A(r.data.channels||[])}catch(r){console.error("Failed to fetch channels:",r)}},be=async()=>{var r,S;if(!u.trim()){_("Please enter your phone number","error");return}d(!0);try{const L=await k.post("/integrations/telegram/auth/start",{phone_number:u});_("Verification code sent to your Telegram app","success"),g(1)}catch(L){_(((S=(r=L.response)==null?void 0:r.data)==null?void 0:S.detail)||"Failed to send code","error")}finally{d(!1)}},ve=async()=>{var r,S;if(!b.trim()){_("Please enter the verification code","error");return}d(!0);try{const L=await k.post("/integrations/telegram/auth/verify",{code:b,password:C?x:void 0});L.data.status==="2fa_required"?(n(!0),_("Please enter your 2FA password","warning")):L.data.status==="connected"&&(_("Telegram connected successfully!","success"),g(2),te())}catch(L){_(((S=(r=L.response)==null?void 0:r.data)==null?void 0:S.detail)||"Verification failed","error")}finally{d(!1)}},D=async()=>{if(confirm("Disconnect Telegram? You will stop receiving deals from your channels."))try{await k.delete("/integrations/telegram/disconnect"),s({connected:!1}),A([]),g(0),y(""),f(""),_("Telegram disconnected","success")}catch{_("Failed to disconnect","error")}},q=async()=>{var r,S;O(!0);try{const L=await k.get("/integrations/telegram/channels/available");V(L.data.channels||[]),M(!0)}catch(L){_(((S=(r=L.response)==null?void 0:r.data)==null?void 0:S.detail)||"Failed to fetch channels","error")}finally{O(!1)}},se=r=>{G(r),N({...I,supplierName:r.title||r.name||""})},ce=async(r=null)=>{var L,U;const S=r||F;if(S)try{const de={channel_id:S.id,channel_name:S.name||S.title,channel_username:S.username,channel_type:S.type||"channel",create_supplier:I.createSupplier,supplier_name:I.supplierName||S.name||S.title,supplier_website:I.supplierWebsite||null,supplier_contact_email:I.supplierEmail||null,supplier_notes:I.supplierNotes||null},Ce=await k.post("/integrations/telegram/channels",de);_(`Added ${S.name}${Ce.data.supplier_id?" and created supplier":""}`,"success"),G(null),N({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),re(),te(),V(Se=>Se.map(le=>le.id===S.id?{...le,is_monitored:!0}:le)),B&&M(!1)}catch(de){_(((U=(L=de.response)==null?void 0:L.data)==null?void 0:U.detail)||"Failed to add channel","error")}},ze=async r=>{var S,L;Z(U=>({...U,[r]:!0}));try{const U=await k.post(`/integrations/telegram/channels/${r}/backfill?days=14`);_(`Synced ${U.data.messages} messages, found ${U.data.deals} deals`,"success"),re()}catch(U){_("Failed to sync: "+(((L=(S=U.response)==null?void 0:S.data)==null?void 0:L.detail)||U.message),"error")}finally{Z(U=>({...U,[r]:!1}))}},je=async r=>{try{await k.delete(`/integrations/telegram/channels/${r}`),_("Channel removed","success"),re(),te()}catch{_("Failed to remove channel","error")}},Pe=async()=>{var r,S;try{const L=await k.post("/integrations/telegram/monitoring/start");_(`Monitoring ${L.data.channels} channels`,"success"),te()}catch(L){_(((S=(r=L.response)==null?void 0:r.data)==null?void 0:S.detail)||"Failed to start monitoring","error")}},Fe=async()=>{try{await k.post("/integrations/telegram/monitoring/stop"),_("Monitoring stopped","success"),te()}catch{_("Failed to stop monitoring","error")}};return i?e.jsx(H,{children:e.jsx(K,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ae,{})})}):e.jsx(H,{children:e.jsxs(K,{children:[e.jsxs(p,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:2,children:[e.jsxs(p,{children:[e.jsxs(p,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(we,{size:20,style:{color:"#0088cc"}}),e.jsx(h,{variant:"h6",fontWeight:600,children:"Telegram Monitoring"}),e.jsx(oe,{icon:t!=null&&t.connected?e.jsx(De,{size:16}):void 0,label:t!=null&&t.connected?"Connected":"Not Connected",color:t!=null&&t.connected?"success":"default",size:"small"}),(t==null?void 0:t.monitoring)&&e.jsx(oe,{label:"Monitoring",color:"primary",size:"small"})]}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Auto-extract deals from supplier channels"})]}),(t==null?void 0:t.connected)&&e.jsx(z,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(et,{size:18}),onClick:D,children:"Disconnect"})]}),!(t!=null&&t.connected)&&e.jsxs(p,{children:[e.jsx(Qt,{activeStep:m,sx:{mb:3},children:ra.map(r=>e.jsx(Lt,{children:e.jsx(Ze,{children:r})},r))}),m===0&&e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:2,children:"Enter your phone number to connect your Telegram account. We'll send a verification code to your Telegram app."}),e.jsx(R,{label:"Phone Number",placeholder:"+1 234 567 8900",value:u,onChange:r=>y(r.target.value),fullWidth:!0,sx:{mb:2},helperText:"Include country code (e.g., +1 for US)"}),e.jsx(z,{variant:"contained",onClick:be,disabled:w,startIcon:w?e.jsx(ae,{size:16}):e.jsx(we,{size:18}),sx:{bgcolor:"#0088cc","&:hover":{bgcolor:"#006699"}},children:w?"Sending...":"Send Code"})]}),m===1&&e.jsxs(p,{children:[e.jsx(J,{severity:"info",sx:{mb:2},children:"Check your Telegram app for the verification code"}),e.jsx(R,{label:"Verification Code",placeholder:"12345",value:b,onChange:r=>f(r.target.value.replace(/\D/g,"")),fullWidth:!0,autoFocus:!0,inputProps:{maxLength:5,inputMode:"numeric",pattern:"[0-9]*"},sx:{mb:2},helperText:"Enter the 5-digit code from Telegram"}),C&&e.jsx(R,{label:"2FA Password",type:"password",autoComplete:"current-password",value:x,onChange:r=>P(r.target.value),fullWidth:!0,sx:{mb:2},helperText:"Your Telegram 2FA password"}),e.jsxs(p,{display:"flex",gap:1,children:[e.jsx(z,{variant:"outlined",onClick:()=>{g(0),f(""),n(!1)},children:"Back"}),e.jsx(z,{variant:"contained",onClick:ve,disabled:w,startIcon:w?e.jsx(ae,{size:16}):e.jsx(De,{size:18}),children:w?"Verifying...":"Verify"})]})]})]}),(t==null?void 0:t.connected)&&e.jsxs(p,{children:[e.jsx(p,{mb:2,children:e.jsx(st,{label:"Monitored Channels",used:v.length,limit:(t==null?void 0:t.channel_limit)||ye("telegram_channels")})}),e.jsxs(p,{display:"flex",gap:1,mb:2,children:[t!=null&&t.monitoring?e.jsx(z,{variant:"outlined",color:"warning",startIcon:e.jsx(ta,{size:18}),onClick:Fe,children:"Stop Monitoring"}):e.jsx(z,{variant:"contained",color:"success",startIcon:e.jsx(Zt,{size:18}),onClick:Pe,disabled:v.length===0,children:"Start Monitoring"}),e.jsx(z,{variant:"outlined",startIcon:Y?e.jsx(ae,{size:16}):e.jsx(mt,{size:18}),onClick:q,disabled:Y||ee("telegram_channels",v.length),children:"Add Channel"})]}),(v||[]).length>0?e.jsx(Re,{dense:!0,children:(v||[]).map(r=>e.jsxs(Ee,{children:[e.jsx(Be,{children:e.jsx(we,{size:18,style:{color:a.palette.primary.main}})}),e.jsx($e,{primary:r.channel_name,secondary:e.jsxs(p,{display:"flex",gap:2,children:[e.jsxs("span",{children:[r.messages_received||0," messages"]}),e.jsxs("span",{children:[r.deals_extracted||0," deals"]})]}),secondaryTypographyProps:{component:"div"}}),e.jsx(ot,{children:e.jsxs(p,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(Ue,{title:"Sync last 14 days of messages",children:e.jsx(z,{size:"small",variant:"outlined",onClick:()=>ze(r.channel_id),disabled:E[r.channel_id],startIcon:E[r.channel_id]?e.jsx(ae,{size:14}):e.jsx(ea,{size:14}),children:E[r.channel_id]?"Syncing...":"Sync 14 Days"})}),e.jsx(Ue,{title:"Remove channel",children:e.jsx(lt,{edge:"end",size:"small",onClick:()=>je(r.channel_id),children:e.jsx(xt,{size:18})})})]})})]},r.id))}):e.jsx(J,{severity:"info",children:'No channels added yet. Click "Add Channel" to select channels to monitor.'}),(t==null?void 0:t.monitoring)&&e.jsxs(p,{mt:2,p:2,sx:{bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:2},children:[e.jsx(h,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Monitoring Active"}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Deals will be automatically extracted and appear in your feed."})]})]}),e.jsxs(Ge,{open:B,onClose:()=>{M(!1),G(null),N({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},maxWidth:"sm",fullWidth:!0,children:[e.jsx(Je,{children:"Add Telegram Channel"}),e.jsx(Xe,{dividers:!0,children:(j||[]).length>0?e.jsxs(e.Fragment,{children:[e.jsx(Re,{children:(j||[]).map(r=>e.jsxs(Ee,{button:!0,selected:(F==null?void 0:F.id)===r.id,onClick:()=>se(r),children:[e.jsx(Be,{children:e.jsx(we,{size:20})}),e.jsx($e,{primary:r.name,secondary:`${r.type} â€¢ ${r.member_count||"?"} members`}),r.is_monitored&&e.jsx(oe,{label:"Monitoring",size:"small",color:"success",sx:{ml:2}})]},r.id))}),F&&e.jsxs(e.Fragment,{children:[e.jsx(it,{sx:{my:2}}),e.jsxs(p,{sx:{mb:2,p:2,bgcolor:"#252540",borderRadius:2},children:[e.jsxs(h,{variant:"subtitle2",color:"primary",children:["Selected: ",F.name||F.title]}),e.jsxs(h,{variant:"caption",color:"text.secondary",children:["@",F.username||"no-username"]})]}),e.jsx(Le,{control:e.jsx(gt,{checked:I.createSupplier,onChange:r=>N({...I,createSupplier:r.target.checked})}),label:"Create as Supplier"}),I.createSupplier&&e.jsxs(p,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(R,{label:"Supplier Name",value:I.supplierName,onChange:r=>N({...I,supplierName:r.target.value}),placeholder:(F==null?void 0:F.name)||(F==null?void 0:F.title)||"Supplier name",fullWidth:!0,size:"small"}),e.jsx(R,{label:"Website (optional)",value:I.supplierWebsite,onChange:r=>N({...I,supplierWebsite:r.target.value}),placeholder:"https://...",fullWidth:!0,size:"small"}),e.jsx(R,{label:"Contact Email (optional)",value:I.supplierEmail,onChange:r=>N({...I,supplierEmail:r.target.value}),placeholder:"contact@supplier.com",fullWidth:!0,size:"small"}),e.jsx(R,{label:"Notes (optional)",value:I.supplierNotes,onChange:r=>N({...I,supplierNotes:r.target.value}),placeholder:"Any notes about this supplier...",multiline:!0,rows:2,fullWidth:!0,size:"small"})]})]})]}):e.jsx(h,{color:"text.secondary",textAlign:"center",py:4,children:"No channels found. Make sure you're a member of some Telegram channels or groups."})}),e.jsxs(Qe,{children:[e.jsx(z,{onClick:()=>{M(!1),G(null),N({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},children:"Cancel"}),e.jsx(z,{variant:"contained",onClick:()=>ce(),disabled:!F||ee("telegram_channels",v.length),children:"Add Channel"})]})]})]})})},va=()=>{var Ce,Se,le;const[a]=Ke(),t=a.get("tab"),s={profile:0,integrations:1,alerts:2,costs:3,billing:4},i=t&&s[t]!==void 0?s[t]:0,[c,m]=l.useState(i);l.useEffect(()=>{t&&s[t]!==void 0&&m(s[t])},[t,a]);const{profile:g,alertSettings:u,costSettings:y,loading:b,updateProfile:f,updateAlertSettings:x,updateCostSettings:P}=aa(),{showToast:C}=Te(),{subscription:n,openPortal:w,cancelSubscription:d,reactivateSubscription:v,refreshSubscription:A}=ct(),j=dt(),[V,B]=l.useState([]),[M,Y]=l.useState(null),[O,E]=l.useState(!1),[Z,F]=l.useState(!1),[G,I]=l.useState({full_name:"",avatar_url:""}),[N,_]=l.useState({current_password:"",new_password:"",confirm_password:""}),[ye,ee]=l.useState(""),[te,re]=l.useState(!1),[be,ve]=l.useState(!1),[D,q]=l.useState({min_roi:20,min_profit:3,max_rank:1e5,alerts_enabled:!0,alert_min_roi:30,alert_channels:["push","email"]}),[se,ce]=l.useState({default_prep_cost:.5,default_inbound_shipping:.5});l.useEffect(()=>{g&&I({full_name:g.full_name||"",avatar_url:g.avatar_url||""})},[g]),l.useEffect(()=>{u&&q({min_roi:u.min_roi||20,min_profit:u.min_profit||3,max_rank:u.max_rank||1e5,alerts_enabled:u.alerts_enabled!==!1,alert_min_roi:u.alert_min_roi||30,alert_channels:u.alert_channels||["push","email"]})},[u]),l.useEffect(()=>{y&&ce({default_prep_cost:y.default_prep_cost||.5,default_inbound_shipping:y.default_inbound_shipping||.5})},[y]),l.useEffect(()=>{c===4&&(ze(),je())},[c]);const ze=async()=>{try{const o=await k.get("/billing/invoices");B(o.data.invoices||[])}catch(o){console.error("Failed to fetch invoices:",o)}},je=async()=>{try{const o=await k.get("/billing/usage");Y(o.data)}catch(o){console.error("Failed to fetch usage:",o)}},Pe=async(o=!1)=>{var W,Q;F(!0);try{o?(await k.post("/billing/cancel-immediately"),C("Subscription cancelled. You've been moved to the Free plan.","info")):(await d(!0),C("Subscription will cancel at end of billing period","info")),E(!1),await A(),await je()}catch(tt){C(((Q=(W=tt.response)==null?void 0:W.data)==null?void 0:Q.detail)||"Failed to cancel subscription","error")}finally{F(!1)}},Fe=async()=>{F(!0);try{await v(),C("Subscription reactivated","success")}catch{C("Failed to reactivate subscription","error")}finally{F(!1)}},r=async()=>{F(!0);try{await w()}catch{C("Failed to open billing portal","error"),F(!1)}},S=async()=>{try{await f(G),C("Profile updated successfully","success")}catch(o){C(o.message||"Failed to update profile","error")}},L=async()=>{try{await x(D),C("Alert settings saved","success")}catch(o){C(o.message||"Failed to save alert settings","error")}},U=async()=>{try{await P(se),C("Cost settings saved","success")}catch(o){C(o.message||"Failed to save cost settings","error")}},de=async()=>{if(ee(""),re(!1),N.new_password!==N.confirm_password){ee("New passwords do not match");return}if(N.new_password.length<8){ee("Password must be at least 8 characters");return}ve(!0);try{const{data:{user:o}}=await Ae.auth.getUser();if(!o)throw new Error("Not authenticated");const{error:W}=await Ae.auth.signInWithPassword({email:o.email,password:N.current_password});if(W){ee("Current password is incorrect"),C("Current password is incorrect","error");return}const{error:Q}=await Ae.auth.updateUser({password:N.new_password});if(Q)throw Q;re(!0),_({current_password:"",new_password:"",confirm_password:""}),C("Password changed successfully","success")}catch(o){ee(o.message||"Failed to change password"),C(o.message||"Failed to change password","error")}finally{ve(!1)}};return b?e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ae,{})}):e.jsxs(p,{children:[e.jsx(h,{variant:"h4",fontWeight:700,mb:4,children:"Settings"}),e.jsxs(ft,{value:c,onChange:(o,W)=>m(W),sx:{mb:4},children:[e.jsx(pe,{label:"Profile"}),e.jsx(pe,{label:"Integrations"}),e.jsx(pe,{label:"Alerts"}),e.jsx(pe,{label:"Costs"}),e.jsx(pe,{label:"Billing"})]}),c===0&&e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Profile Settings"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(R,{label:"Full Name",value:G.full_name,onChange:o=>I({...G,full_name:o.target.value}),fullWidth:!0}),e.jsx(R,{label:"Avatar URL",value:G.avatar_url,onChange:o=>I({...G,avatar_url:o.target.value}),fullWidth:!0,placeholder:"https://..."}),e.jsx(z,{variant:"contained",onClick:S,sx:{backgroundColor:$.purple.main,"&:hover":{backgroundColor:$.purple.dark},alignSelf:"flex-start"},children:"Save Profile"})]})]})}),e.jsx(H,{sx:{mt:3},children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Change Password"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[ye&&e.jsx(J,{severity:"error",children:ye}),te&&e.jsx(J,{severity:"success",children:"Password changed successfully!"}),e.jsx(R,{label:"Current Password",type:"password",autoComplete:"current-password",value:N.current_password,onChange:o=>_({...N,current_password:o.target.value}),fullWidth:!0,required:!0}),e.jsx(R,{label:"New Password",type:"password",autoComplete:"new-password",value:N.new_password,onChange:o=>_({...N,new_password:o.target.value}),fullWidth:!0,required:!0,inputProps:{minLength:8},helperText:"Must be at least 8 characters"}),e.jsx(R,{label:"Confirm New Password",type:"password",autoComplete:"new-password",value:N.confirm_password,onChange:o=>_({...N,confirm_password:o.target.value}),fullWidth:!0,required:!0}),e.jsx(z,{variant:"contained",onClick:de,disabled:be,sx:{backgroundColor:$.purple.main,"&:hover":{backgroundColor:$.purple.dark},alignSelf:"flex-start"},children:be?"Changing...":"Change Password"})]})]})})]}),c===1&&e.jsxs(p,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(na,{}),e.jsx(sa,{})]}),c===2&&e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Alert Settings"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI for alerts"}),e.jsx(Ye,{value:D.alert_min_roi,onChange:(o,W)=>q({...D,alert_min_roi:W}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:o=>`${o}%`})]}),e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI to consider profitable"}),e.jsx(Ye,{value:D.min_roi,onChange:(o,W)=>q({...D,min_roi:W}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:o=>`${o}%`})]}),e.jsx(R,{label:"Minimum profit per unit",type:"number",value:D.min_profit,onChange:o=>q({...D,min_profit:parseFloat(o.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0}),e.jsx(R,{label:"Maximum sales rank",type:"number",value:D.max_rank,onChange:o=>q({...D,max_rank:parseInt(o.target.value)||0}),fullWidth:!0}),e.jsx(Le,{control:e.jsx(Me,{checked:D.alerts_enabled,onChange:o=>q({...D,alerts_enabled:o.target.checked})}),label:"Enable alerts"}),e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:1,children:"Notification Channels"}),e.jsx(Le,{control:e.jsx(Me,{checked:(Ce=D.alert_channels)==null?void 0:Ce.includes("push"),onChange:o=>{const W=D.alert_channels||[];o.target.checked?q({...D,alert_channels:[...W,"push"]}):q({...D,alert_channels:W.filter(Q=>Q!=="push")})}}),label:"Push notifications"}),e.jsx(Le,{control:e.jsx(Me,{checked:(Se=D.alert_channels)==null?void 0:Se.includes("email"),onChange:o=>{const W=D.alert_channels||[];o.target.checked?q({...D,alert_channels:[...W,"email"]}):q({...D,alert_channels:W.filter(Q=>Q!=="email")})}}),label:"Email alerts"})]}),e.jsx(z,{variant:"contained",onClick:L,sx:{backgroundColor:$.purple.main,"&:hover":{backgroundColor:$.purple.dark},alignSelf:"flex-start"},children:"Save Settings"})]})]})}),c===3&&e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Cost Settings"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(R,{label:"Default Prep Cost",type:"number",value:se.default_prep_cost,onChange:o=>ce({...se,default_prep_cost:parseFloat(o.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0,helperText:"Default cost per unit for prep/packaging"}),e.jsx(R,{label:"Default Inbound Shipping",type:"number",value:se.default_inbound_shipping,onChange:o=>ce({...se,default_inbound_shipping:parseFloat(o.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0,helperText:"Default cost per unit for inbound shipping to Amazon"}),e.jsx(z,{variant:"contained",onClick:U,sx:{backgroundColor:$.purple.main,"&:hover":{backgroundColor:$.purple.dark},alignSelf:"flex-start"},children:"Save Cost Settings"})]})]})}),c===4&&e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(H,{children:e.jsxs(K,{children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(p,{children:[e.jsx(h,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Current Plan"}),e.jsxs(p,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(oe,{label:((le=n==null?void 0:n.tier)==null?void 0:le.toUpperCase())||"FREE",color:(n==null?void 0:n.tier)==="free"?"default":"primary",sx:{fontWeight:600}}),(n==null?void 0:n.cancel_at_period_end)&&e.jsx(oe,{label:"Cancels at period end",color:"warning",size:"small"})]}),(n==null?void 0:n.status)==="trialing"&&(n==null?void 0:n.trial_end)&&e.jsxs(J,{severity:"info",sx:{mt:1,mb:1},children:["ðŸŽ‰ Free trial ends ",new Date(n.trial_end).toLocaleDateString()]}),(n==null?void 0:n.current_period_end)&&(n==null?void 0:n.status)!=="trialing"&&e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Renews: ",new Date(n.current_period_end).toLocaleDateString()]}),(n==null?void 0:n.cancel_at_period_end)&&e.jsxs(J,{severity:"warning",sx:{mt:1},children:["âš ï¸ Cancels on ",n!=null&&n.current_period_end?new Date(n.current_period_end).toLocaleDateString():"period end"]})]}),e.jsxs(p,{display:"flex",gap:1,children:[n!=null&&n.cancel_at_period_end?e.jsx(z,{variant:"outlined",onClick:Fe,disabled:Z,children:"Reactivate"}):(n==null?void 0:n.tier)!=="free"?e.jsx(z,{variant:"outlined",color:"error",onClick:()=>E(!0),disabled:Z,children:"Cancel"}):null,e.jsx(z,{variant:"contained",onClick:()=>j("/pricing"),sx:{backgroundColor:$.purple.main,"&:hover":{backgroundColor:$.purple.dark}},children:(n==null?void 0:n.tier)==="free"?"Upgrade":"Change Plan"})]})]}),(n==null?void 0:n.tier)!=="free"&&e.jsx(z,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(pt,{size:18}),onClick:r,disabled:Z,sx:{mt:2},children:"Manage Billing & Payment Methods"})]})}),M&&e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:2,children:"Usage This Period"}),e.jsxs(p,{mb:2,children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(h,{variant:"body2",color:"text.secondary",children:"Analyses"}),e.jsxs(h,{variant:"body2",fontWeight:600,children:[M.analyses.used," / ",M.analyses.unlimited?"âˆž":M.analyses.limit]})]}),!M.analyses.unlimited&&e.jsx(ut,{variant:"determinate",value:Math.min(M.analyses.used/M.analyses.limit*100,100),sx:{height:8,borderRadius:4,backgroundColor:$.gray[200],"& .MuiLinearProgress-bar":{backgroundColor:M.analyses.used>=M.analyses.limit*.9?$.error.main:$.purple.main}}})]})]})}),e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:2,children:"Invoice History"}),V.length===0?e.jsx(h,{variant:"body2",color:"text.secondary",children:"No invoices yet"}):e.jsx(yt,{size:"small",children:e.jsx(bt,{children:V.map(o=>e.jsxs(vt,{children:[e.jsx(_e,{children:e.jsx(h,{variant:"body2",fontWeight:600,children:new Date(o.created_at).toLocaleDateString()})}),e.jsx(_e,{children:e.jsx(h,{variant:"body2",color:"text.secondary",children:ht((o.amount_paid||o.amount_due||0)/100)})}),e.jsx(_e,{children:e.jsx(oe,{label:o.status,size:"small",color:o.status==="paid"?"success":"default"})}),e.jsx(_e,{align:"right",children:o.stripe_invoice_url&&e.jsx(z,{size:"small",startIcon:e.jsx(jt,{size:14}),href:o.stripe_invoice_url,target:"_blank",children:"View"})})]},o.id))})})]})}),e.jsxs(Ge,{open:O,onClose:()=>E(!1),children:[e.jsx(Je,{children:"Cancel Subscription?"}),e.jsx(Xe,{children:(n==null?void 0:n.status)==="trialing"?e.jsxs(e.Fragment,{children:[e.jsx(J,{severity:"warning",sx:{mb:2},children:"Your trial will end immediately and you'll be downgraded to the Free plan."}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"You can resubscribe anytime, but won't be eligible for another free trial."})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{severity:"warning",sx:{mb:2},children:"Your subscription will remain active until the end of your current billing period. You'll continue to have access to all features until then."}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"After cancellation, you'll be moved to the Free plan. You can reactivate anytime."})]})}),e.jsxs(Qe,{children:[e.jsx(z,{onClick:()=>E(!1),children:"Keep Subscription"}),e.jsx(z,{onClick:()=>Pe((n==null?void 0:n.status)==="trialing"),color:"error",variant:"contained",disabled:Z,children:Z?"Canceling...":"Yes, Cancel"})]})]})]})]})};export{va as default};

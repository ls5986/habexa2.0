import{r as l,u as S,n as u,R as v,j as e,B as n,o as k,T as i,k as D,Z as F,I as z,b as T,p as _,S as $,C,P as I,d as B}from"./index-k5Kw9esk.js";import{R as E,I as L}from"./refresh-cw-BLfRxQGh.js";import{T as W,a as j}from"./Tabs-BXHcFz71.js";import{C as N}from"./clock-B6zaM-pb.js";import{E as Z}from"./external-link-_GANzbDM.js";function J(){const[r,g]=l.useState([]),[s,x]=l.useState({total:0,pending:0,analyzed:0,profitable:0}),[h,d]=l.useState(!0),[c,w]=l.useState(0),[p,A]=l.useState(""),P=S(),f=l.useRef(!1);l.useEffect(()=>{f.current||(f.current=!0,m())},[]);const m=async()=>{d(!0);const t=Date.now();try{const[a,o]=await Promise.all([u.get("/deals?limit=50"),u.get("/deals/stats")]);console.log(`✅ API calls took ${Date.now()-t}ms`),g(a.data.deals||a.data||[]),x(o.data||{total:0,pending:0,analyzed:0,profitable:0})}catch(a){console.error("Fetch error:",a)}finally{d(!1)}},y=v.useMemo(()=>{let t=r;return c===1?t=r.filter(a=>{var o;return((o=a.analysis)==null?void 0:o.roi)>=30}):c===2&&(t=r.filter(a=>a.status==="pending"||!a.status)),p&&(t=t.filter(a=>{var o;return(o=a.asin)==null?void 0:o.toLowerCase().includes(p.toLowerCase())})),t},[r,c,p]),b=()=>{f.current=!1,m()},R=async()=>{try{await u.post("/deals/analyze-batch",{analyze_all_pending:!0}),b()}catch(t){console.error("Batch analysis failed:",t)}};return h?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(k,{})}):e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{children:[e.jsx(i,{variant:"h4",fontWeight:"700",children:"Deal Feed"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[s.total," deals - ",s.pending," pending - ",s.profitable," profitable"]})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[s.pending>0&&e.jsxs(D,{variant:"contained",startIcon:e.jsx(F,{size:16}),onClick:R,children:["Analyze All (",s.pending,")"]}),e.jsx(z,{onClick:b,children:e.jsx(E,{size:20})})]})]}),e.jsxs(W,{value:c,onChange:(t,a)=>w(a),sx:{mb:3},children:[e.jsx(j,{label:`All (${s.total})`}),e.jsx(j,{icon:e.jsx(T,{size:14}),iconPosition:"start",label:`Profitable (${s.profitable})`}),e.jsx(j,{icon:e.jsx(N,{size:14}),iconPosition:"start",label:`Pending (${s.pending})`})]}),e.jsx(_,{size:"small",placeholder:"Search ASIN...",value:p,onChange:t=>A(t.target.value),sx:{mb:3,width:250},InputProps:{startAdornment:e.jsx(L,{position:"start",children:e.jsx($,{size:16})})}}),y.length===0?e.jsxs(C,{sx:{p:4,textAlign:"center"},children:[e.jsx(I,{size:48,color:"#666"}),e.jsx(i,{variant:"h6",sx:{mt:2},children:"No deals found"})]}):e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:y.map(t=>e.jsx(M,{deal:t,onClick:()=>P(`/deals/${t.id}`)},t.id))})]})}const M=v.memo(({deal:r,onClick:g})=>{var h,d;const s=r.analysis,x=(s==null?void 0:s.roi)||0;return e.jsxs(C,{onClick:g,sx:{p:2,cursor:"pointer",display:"flex",alignItems:"center",gap:2,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(n,{sx:{width:50,height:50,bgcolor:"#252540",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s!=null&&s.image_url?e.jsx("img",{src:s.image_url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}):e.jsx(I,{size:24,color:"#666"})}),e.jsxs(n,{sx:{flex:1,minWidth:0},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",fontFamily:"monospace",children:r.asin}),e.jsx(B,{label:r.status||"pending",size:"small",color:r.status==="analyzed"?"success":"warning",sx:{height:20,fontSize:11}})]}),e.jsx(i,{variant:"body2",noWrap:!0,color:"text.secondary",children:(s==null?void 0:s.product_title)||r.product_title||"Pending analysis..."})]}),e.jsxs(n,{sx:{display:"flex",gap:3,alignItems:"center"},children:[e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Buy"}),e.jsxs(i,{variant:"body2",children:["$",((h=r.buy_cost)==null?void 0:h.toFixed(2))||"—"]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Profit"}),e.jsxs(i,{variant:"body2",color:s.profit>0?"success.main":"error.main",children:["$",((d=s.profit)==null?void 0:d.toFixed(2))||"—"]})]}),e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"ROI"}),e.jsxs(i,{variant:"body2",fontWeight:"700",color:x>=30?"success.main":"warning.main",children:[x.toFixed(0),"%"]})]})]})]}),e.jsx(z,{size:"small",component:"a",href:`https://amazon.com/dp/${r.asin}`,target:"_blank",onClick:c=>c.stopPropagation(),children:e.jsx(Z,{size:16})})]})});export{J as default};

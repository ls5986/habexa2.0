import{r as l,u as B,o as j,R as z,j as e,B as a,p as k,T as i,a as D,Z as F,I as C,e as T,q as _,S as $,C as A,P as I,d as E}from"./index-iiuQpHm4.js";import{R as L}from"./refresh-cw-AFREdOkb.js";import{T as W,a as m}from"./Tabs-Ct7BY6q0.js";import{C as N}from"./clock-Buz3XdbZ.js";import{I as Z}from"./InputAdornment-Db7rGxuS.js";import{E as q}from"./external-link-CvsoqFPL.js";function Q(){const[r,f]=l.useState([]),[s,h]=l.useState({total:0,pending:0,analyzed:0,profitable:0}),[p,d]=l.useState(!0),[c,w]=l.useState(0),[g,P]=l.useState(""),R=B(),u=l.useRef(!1);l.useEffect(()=>{u.current||(u.current=!0,y())},[]);const y=async()=>{d(!0);const t=Date.now();try{const[n,o]=await Promise.all([j.get("/deals?limit=50"),j.get("/deals/stats")]);console.log(`✅ API calls took ${Date.now()-t}ms`),f(n.data.deals||n.data||[]),h(o.data||{total:0,pending:0,analyzed:0,profitable:0})}catch(n){console.error("Fetch error:",n)}finally{d(!1)}},b=z.useMemo(()=>{const t=Array.isArray(r)?r:[];let n=t;return c===1?n=t.filter(o=>{var x;return((x=o.analysis)==null?void 0:x.roi)>=30}):c===2&&(n=t.filter(o=>o.status==="pending"||!o.status)),g&&(n=n.filter(o=>{var x;return(x=o.asin)==null?void 0:x.toLowerCase().includes(g.toLowerCase())})),n},[r,c,g]),v=()=>{u.current=!1,y()},S=async()=>{try{await j.post("/deals/analyze-batch",{analyze_all_pending:!0}),v()}catch(t){console.error("Batch analysis failed:",t)}};return p?e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(k,{})}):e.jsxs(a,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"h4",fontWeight:"700",children:"Deal Feed"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[s.total," deals - ",s.pending," pending - ",s.profitable," profitable"]})]}),e.jsxs(a,{sx:{display:"flex",gap:2},children:[s.pending>0&&e.jsxs(D,{variant:"contained",startIcon:e.jsx(F,{size:16}),onClick:S,children:["Analyze All (",s.pending,")"]}),e.jsx(C,{onClick:v,children:e.jsx(L,{size:20})})]})]}),e.jsxs(W,{value:c,onChange:(t,n)=>w(n),sx:{mb:3},children:[e.jsx(m,{label:`All (${s.total})`}),e.jsx(m,{icon:e.jsx(T,{size:14}),iconPosition:"start",label:`Profitable (${s.profitable})`}),e.jsx(m,{icon:e.jsx(N,{size:14}),iconPosition:"start",label:`Pending (${s.pending})`})]}),e.jsx(_,{size:"small",placeholder:"Search ASIN...",value:g,onChange:t=>P(t.target.value),sx:{mb:3,width:250},InputProps:{startAdornment:e.jsx(Z,{position:"start",children:e.jsx($,{size:16})})}}),b.length===0?e.jsxs(A,{sx:{p:4,textAlign:"center"},children:[e.jsx(I,{size:48,color:"#8B8B9B"}),e.jsx(i,{variant:"h6",sx:{mt:2},children:"No deals found"})]}):e.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:1},children:b.map(t=>e.jsx(M,{deal:t,onClick:()=>R(`/deals/${t.id}`)},t.id))})]})}const M=z.memo(({deal:r,onClick:f})=>{var p,d;const s=r.analysis,h=(s==null?void 0:s.roi)||0;return e.jsxs(A,{onClick:f,sx:{p:2,cursor:"pointer",display:"flex",alignItems:"center",gap:2,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(a,{sx:{width:50,height:50,bgcolor:"background.paper",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s!=null&&s.image_url?e.jsx("img",{src:s.image_url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}):e.jsx(I,{size:24,color:"#8B8B9B"})}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",fontFamily:"monospace",children:r.asin}),e.jsx(E,{label:r.status||"pending",size:"small",color:r.status==="analyzed"?"success":"warning",sx:{height:20,fontSize:11}})]}),e.jsx(i,{variant:"body2",noWrap:!0,color:"text.secondary",children:(s==null?void 0:s.product_title)||r.product_title||"Pending analysis..."})]}),e.jsxs(a,{sx:{display:"flex",gap:3,alignItems:"center"},children:[e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Buy"}),e.jsxs(i,{variant:"body2",children:["$",((p=r.buy_cost)==null?void 0:p.toFixed(2))||"—"]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Profit"}),e.jsxs(i,{variant:"body2",color:s.profit>0?"success.main":"error.main",children:["$",((d=s.profit)==null?void 0:d.toFixed(2))||"—"]})]}),e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"ROI"}),e.jsxs(i,{variant:"body2",fontWeight:"700",color:h>=30?"success.main":"warning.main",children:[h.toFixed(0),"%"]})]})]})]}),e.jsx(C,{size:"small",component:"a",href:`https://amazon.com/dp/${r.asin}`,target:"_blank",onClick:c=>c.stopPropagation(),children:e.jsx(q,{size:16})})]})});export{Q as default};

import{r as l,t as pe,v as ue,w as he,_ as me,x as D,j as e,y as J,z as ie,E as xe,a3 as qe,ao as tt,af as Oe,c as ge,o as z,ap as He,ab as De,C as H,b as K,p as te,B as p,T as h,d as oe,O as G,a as P,h as E,aq as at,k as nt,q as R,l as rt,a4 as We,a5 as Re,a6 as Ee,ar as st,J as $e,I as ot,X as Ke,Y as Ge,$ as Je,D as lt,i as it,u as ct,as as dt,K as pt,f as ut,at as Fe}from"./index-DDnPEUpM.js";import{C as Ne}from"./check-circle-DccMl6Uc.js";import{M as je}from"./message-circle-osDtqOVg.js";import{P as ht,D as Xe}from"./plus-Ce53r8zA.js";import{L as Ue,S as Ae}from"./Switch-C8n6EF2m.js";import{T as mt}from"./trash-2-CMdECZIP.js";import{F as Se}from"./FormControlLabel-DcP4RVDt.js";import{C as xt}from"./Checkbox-YJBIZ0Xw.js";import{T as gt,a as de}from"./Tabs-DUviKOEk.js";import{S as Be}from"./Slider-BDhxxwG4.js";import{T as ft,a as yt,b as bt,c as Ce}from"./TableRow-DKpnzsGP.js";import{E as vt}from"./external-link-C0U1Th68.js";import"./SwitchBase-BymON1Oy.js";import"./useThemeProps-gKucurRW.js";const we=l.createContext({}),Te=l.createContext({});function jt(a){return pe("MuiStep",a)}ue("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Ct=["active","children","className","component","completed","disabled","expanded","index","last"],St=a=>{const{classes:t,orientation:o,alternativeLabel:i,completed:c}=a;return xe({root:["root",o,i&&"alternativeLabel",c&&"completed"]},jt,t)},wt=J("div",{name:"MuiStep",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:o}=a;return[t.root,t[o.orientation],o.alternativeLabel&&t.alternativeLabel,o.completed&&t.completed]}})(({ownerState:a})=>D({},a.orientation==="horizontal"&&{paddingLeft:8,paddingRight:8},a.alternativeLabel&&{flex:1,position:"relative"})),_t=l.forwardRef(function(t,o){const i=he({props:t,name:"MuiStep"}),{active:c,children:m,className:g,component:u="div",completed:y,disabled:b,expanded:f=!1,index:x,last:F}=i,S=me(i,Ct),{activeStep:n,connector:_,alternativeLabel:d,orientation:j,nonLinear:A}=l.useContext(we);let[v=!1,O=!1,M=!1]=[c,y,b];n===x?v=c!==void 0?c:!0:!A&&n>x?O=y!==void 0?y:!0:!A&&n<x&&(M=b!==void 0?b:!0);const Y=l.useMemo(()=>({index:x,last:F,expanded:f,icon:x+1,active:v,completed:O,disabled:M}),[x,F,f,v,O,M]),V=D({},i,{active:v,orientation:j,alternativeLabel:d,completed:O,disabled:M,expanded:f,component:u}),$=St(V),T=e.jsxs(wt,D({as:u,className:ie($.root,g),ref:o,ownerState:V},S,{children:[_&&d&&x!==0?_:null,m]}));return e.jsx(Te.Provider,{value:Y,children:_&&!d&&x!==0?e.jsxs(l.Fragment,{children:[_,T]}):T})}),Lt=qe(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),kt=qe(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function zt(a){return pe("MuiStepIcon",a)}const Me=ue("MuiStepIcon",["root","active","completed","error","text"]);var Ye;const Pt=["active","className","completed","error","icon"],Ft=a=>{const{classes:t,active:o,completed:i,error:c}=a;return xe({root:["root",o&&"active",i&&"completed",c&&"error"],text:["text"]},zt,t)},Ie=J(tt,{name:"MuiStepIcon",slot:"Root",overridesResolver:(a,t)=>t.root})(({theme:a})=>({display:"block",transition:a.transitions.create("color",{duration:a.transitions.duration.shortest}),color:(a.vars||a).palette.text.disabled,[`&.${Me.completed}`]:{color:(a.vars||a).palette.primary.main},[`&.${Me.active}`]:{color:(a.vars||a).palette.primary.main},[`&.${Me.error}`]:{color:(a.vars||a).palette.error.main}})),At=J("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(a,t)=>t.text})(({theme:a})=>({fill:(a.vars||a).palette.primary.contrastText,fontSize:a.typography.caption.fontSize,fontFamily:a.typography.fontFamily})),Mt=l.forwardRef(function(t,o){const i=he({props:t,name:"MuiStepIcon"}),{active:c=!1,className:m,completed:g=!1,error:u=!1,icon:y}=i,b=me(i,Pt),f=D({},i,{active:c,completed:g,error:u}),x=Ft(f);if(typeof y=="number"||typeof y=="string"){const F=ie(m,x.root);return u?e.jsx(Ie,D({as:kt,className:F,ref:o,ownerState:f},b)):g?e.jsx(Ie,D({as:Lt,className:F,ref:o,ownerState:f},b)):e.jsxs(Ie,D({className:F,ref:o,ownerState:f},b,{children:[Ye||(Ye=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(At,{className:x.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:f,children:y})]}))}return y});function It(a){return pe("MuiStepLabel",a)}const ae=ue("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),Nt=["children","className","componentsProps","error","icon","optional","slotProps","StepIconComponent","StepIconProps"],Dt=a=>{const{classes:t,orientation:o,active:i,completed:c,error:m,disabled:g,alternativeLabel:u}=a;return xe({root:["root",o,m&&"error",g&&"disabled",u&&"alternativeLabel"],label:["label",i&&"active",c&&"completed",m&&"error",g&&"disabled",u&&"alternativeLabel"],iconContainer:["iconContainer",i&&"active",c&&"completed",m&&"error",g&&"disabled",u&&"alternativeLabel"],labelContainer:["labelContainer",u&&"alternativeLabel"]},It,t)},Tt=J("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:o}=a;return[t.root,t[o.orientation]]}})(({ownerState:a})=>D({display:"flex",alignItems:"center",[`&.${ae.alternativeLabel}`]:{flexDirection:"column"},[`&.${ae.disabled}`]:{cursor:"default"}},a.orientation==="vertical"&&{textAlign:"left",padding:"8px 0"})),Wt=J("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(a,t)=>t.label})(({theme:a})=>D({},a.typography.body2,{display:"block",transition:a.transitions.create("color",{duration:a.transitions.duration.shortest}),[`&.${ae.active}`]:{color:(a.vars||a).palette.text.primary,fontWeight:500},[`&.${ae.completed}`]:{color:(a.vars||a).palette.text.primary,fontWeight:500},[`&.${ae.alternativeLabel}`]:{marginTop:16},[`&.${ae.error}`]:{color:(a.vars||a).palette.error.main}})),Rt=J("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(a,t)=>t.iconContainer})(()=>({flexShrink:0,display:"flex",paddingRight:8,[`&.${ae.alternativeLabel}`]:{paddingRight:0}})),Et=J("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(a,t)=>t.labelContainer})(({theme:a})=>({width:"100%",color:(a.vars||a).palette.text.secondary,[`&.${ae.alternativeLabel}`]:{textAlign:"center"}})),Qe=l.forwardRef(function(t,o){var i;const c=he({props:t,name:"MuiStepLabel"}),{children:m,className:g,componentsProps:u={},error:y=!1,icon:b,optional:f,slotProps:x={},StepIconComponent:F,StepIconProps:S}=c,n=me(c,Nt),{alternativeLabel:_,orientation:d}=l.useContext(we),{active:j,disabled:A,completed:v,icon:O}=l.useContext(Te),M=b||O;let Y=F;M&&!Y&&(Y=Mt);const V=D({},c,{active:j,alternativeLabel:_,completed:v,disabled:A,error:y,orientation:d}),$=Dt(V),T=(i=x.label)!=null?i:u.label;return e.jsxs(Tt,D({className:ie($.root,g),ref:o,ownerState:V},n,{children:[M||Y?e.jsx(Rt,{className:$.iconContainer,ownerState:V,children:e.jsx(Y,D({completed:v,active:j,error:y,icon:M},S))}):null,e.jsxs(Et,{className:$.labelContainer,ownerState:V,children:[m?e.jsx(Wt,D({ownerState:V},T,{className:ie($.label,T==null?void 0:T.className),children:m})):null,f]})]}))});Qe.muiName="StepLabel";function $t(a){return pe("MuiStepConnector",a)}ue("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const Ut=["className"],Bt=a=>{const{classes:t,orientation:o,alternativeLabel:i,active:c,completed:m,disabled:g}=a,u={root:["root",o,i&&"alternativeLabel",c&&"active",m&&"completed",g&&"disabled"],line:["line",`line${Oe(o)}`]};return xe(u,$t,t)},Yt=J("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:o}=a;return[t.root,t[o.orientation],o.alternativeLabel&&t.alternativeLabel,o.completed&&t.completed]}})(({ownerState:a})=>D({flex:"1 1 auto"},a.orientation==="vertical"&&{marginLeft:12},a.alternativeLabel&&{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"})),Vt=J("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(a,t)=>{const{ownerState:o}=a;return[t.line,t[`line${Oe(o.orientation)}`]]}})(({ownerState:a,theme:t})=>{const o=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return D({display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:o},a.orientation==="horizontal"&&{borderTopStyle:"solid",borderTopWidth:1},a.orientation==="vertical"&&{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24})}),qt=l.forwardRef(function(t,o){const i=he({props:t,name:"MuiStepConnector"}),{className:c}=i,m=me(i,Ut),{alternativeLabel:g,orientation:u="horizontal"}=l.useContext(we),{active:y,disabled:b,completed:f}=l.useContext(Te),x=D({},i,{alternativeLabel:g,orientation:u,active:y,completed:f,disabled:b}),F=Bt(x);return e.jsx(Yt,D({className:ie(F.root,c),ref:o,ownerState:x},m,{children:e.jsx(Vt,{className:F.line,ownerState:x})}))});function Ot(a){return pe("MuiStepper",a)}ue("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const Ht=["activeStep","alternativeLabel","children","className","component","connector","nonLinear","orientation"],Kt=a=>{const{orientation:t,nonLinear:o,alternativeLabel:i,classes:c}=a;return xe({root:["root",t,o&&"nonLinear",i&&"alternativeLabel"]},Ot,c)},Gt=J("div",{name:"MuiStepper",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:o}=a;return[t.root,t[o.orientation],o.alternativeLabel&&t.alternativeLabel,o.nonLinear&&t.nonLinear]}})(({ownerState:a})=>D({display:"flex"},a.orientation==="horizontal"&&{flexDirection:"row",alignItems:"center"},a.orientation==="vertical"&&{flexDirection:"column"},a.alternativeLabel&&{alignItems:"flex-start"})),Jt=e.jsx(qt,{}),Xt=l.forwardRef(function(t,o){const i=he({props:t,name:"MuiStepper"}),{activeStep:c=0,alternativeLabel:m=!1,children:g,className:u,component:y="div",connector:b=Jt,nonLinear:f=!1,orientation:x="horizontal"}=i,F=me(i,Ht),S=D({},i,{nonLinear:f,alternativeLabel:m,orientation:x,component:y}),n=Kt(S),_=l.Children.toArray(g).filter(Boolean),d=_.map((A,v)=>l.cloneElement(A,D({index:v,last:v+1===_.length},A.props))),j=l.useMemo(()=>({activeStep:c,alternativeLabel:m,connector:b,nonLinear:f,orientation:x}),[c,m,b,f,x]);return e.jsx(we.Provider,{value:j,children:e.jsx(Gt,D({as:y,ownerState:S,className:ie(n.root,u),ref:o},F,{children:d}))})});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=ge("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=ge("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=ge("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=ge("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=ge("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),ta=()=>{const[a,t]=l.useState(null),[o,i]=l.useState(null),[c,m]=l.useState(null),[g,u]=l.useState(!0),[y,b]=l.useState(null),f=async()=>{try{const d=await z.get("/settings/profile");t(d.data)}catch(d){b(d.message)}},x=async()=>{try{const d=await z.get("/settings/alerts");i(d.data)}catch(d){b(d.message)}},F=async()=>{try{const d=await z.get("/settings/costs");m(d.data)}catch(d){b(d.message)}};return l.useEffect(()=>{(async()=>{u(!0),await Promise.all([f(),x(),F()]),u(!1)})()},[]),{profile:a,alertSettings:o,costSettings:c,loading:g,error:y,refetch:async()=>{await Promise.all([f(),x(),F()])},updateProfile:async d=>{var j,A;try{const v=await z.put("/settings/profile",d);return t(v.data),v.data}catch(v){throw new Error(((A=(j=v.response)==null?void 0:j.data)==null?void 0:A.detail)||"Failed to update profile")}},updateAlertSettings:async d=>{var j,A;try{const v=await z.put("/settings/alerts",d);return i(v.data),v.data}catch(v){throw new Error(((A=(j=v.response)==null?void 0:j.data)==null?void 0:A.detail)||"Failed to update alert settings")}},updateCostSettings:async d=>{var j,A;try{const v=await z.put("/settings/costs",d);return m(v.data),v.data}catch(v){throw new Error(((A=(j=v.response)==null?void 0:j.data)==null?void 0:A.detail)||"Failed to update cost settings")}}}};function aa(){const[a,t]=He(),[o,i]=l.useState(null),[c,m]=l.useState(!0),[g,u]=l.useState(!1),[y,b]=l.useState(null),{showToast:f}=De();l.useEffect(()=>{if(x(),a.get("amazon_connected")==="true"&&(b({type:"success",text:"Amazon connected successfully!"}),f("Amazon account connected successfully!","success"),a.delete("amazon_connected"),t(a,{replace:!0}),x()),a.get("amazon_error")){const n=a.get("amazon_error");b({type:"error",text:n}),f(`Connection failed: ${n}`,"error"),a.delete("amazon_error"),t(a,{replace:!0})}},[]);const x=async()=>{try{const n=await z.get("/integrations/amazon/connection");i(n.data)}catch(n){console.error("Failed to fetch connection:",n),i({connected:!1})}finally{m(!1)}},F=async()=>{var n,_;u(!0);try{const d=await z.get("/integrations/amazon/oauth/authorize");window.location.href=d.data.authorization_url}catch(d){const j=((_=(n=d.response)==null?void 0:n.data)==null?void 0:_.detail)||"Failed to start connection";b({type:"error",text:j}),f(j,"error"),u(!1)}},S=async()=>{var n,_;if(confirm("Disconnect your Amazon account? You will need to reconnect to check gating status and get accurate fees."))try{await z.delete("/integrations/amazon/disconnect"),i({connected:!1}),b({type:"success",text:"Disconnected successfully"}),f("Amazon account disconnected","success"),x()}catch(d){const j=((_=(n=d.response)==null?void 0:n.data)==null?void 0:_.detail)||"Failed to disconnect";b({type:"error",text:j}),f(j,"error")}};return c?e.jsx(H,{children:e.jsx(K,{sx:{textAlign:"center",py:4},children:e.jsx(te,{})})}):e.jsx(H,{children:e.jsxs(K,{children:[e.jsxs(p,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Ve,{size:32,style:{color:"#FF9900"}}),e.jsxs(p,{flex:1,children:[e.jsx(h,{variant:"h6",fontWeight:600,children:"Amazon Seller Account"}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Connect to check YOUR gating status and fees"})]}),(o==null?void 0:o.connected)&&e.jsx(oe,{icon:e.jsx(Ne,{size:16}),label:"Connected",color:"success"})]}),y&&e.jsx(G,{severity:y.type,sx:{mb:2},onClose:()=>b(null),children:y.text}),o!=null&&o.connected?e.jsxs(p,{children:[e.jsxs(p,{mb:2,children:[e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Seller ID:"})," ",o.seller_id||"Not available"]}),e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Marketplace:"})," ",o.marketplace_id||"US"]}),o.connected_at&&e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Connected:"})," ",new Date(o.connected_at).toLocaleDateString()]}),o.last_used_at&&e.jsxs(h,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Last used:"})," ",new Date(o.last_used_at).toLocaleString()]})]}),e.jsx(P,{variant:"outlined",color:"error",startIcon:e.jsx(Ze,{size:18}),onClick:S,children:"Disconnect"})]}):e.jsxs(p,{children:[e.jsx(G,{severity:"info",sx:{mb:2},children:"Connect your Amazon Seller account to see YOUR eligibility status on products. Each user connects their own account and sees their own gating status."}),e.jsx(P,{variant:"contained",size:"large",startIcon:g?e.jsx(te,{size:20,color:"inherit"}):e.jsx(Ve,{size:20}),onClick:F,disabled:g,sx:{bgcolor:"#FF9900","&:hover":{bgcolor:"#E88B00"},color:"#000"},children:g?"Connecting...":"Connect Amazon"})]}),!(o!=null&&o.connected)&&e.jsxs(p,{sx:{mt:3,p:2,bgcolor:E.gray[50],borderRadius:2,border:"1px solid",borderColor:E.gray[200]},children:[e.jsx(h,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"ðŸ”“ Why Connect?"}),e.jsxs(p,{component:"ul",sx:{m:0,pl:2.5},children:[e.jsx("li",{children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Real gating checks"})," â€” Know if YOU can list a product, not just estimates"]})}),e.jsx("li",{children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Accurate FBA fees"})," â€” Get exact fees from Amazon for your account"]})}),e.jsx("li",{children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Better analysis"})," â€” More accurate profit calculations based on your account"]})})]})]})]})})}const na=["Enter Phone","Verify Code","Connected"],ra=()=>{const a=at(),[t,o]=l.useState(null),[i,c]=l.useState(!0),[m,g]=l.useState(0),[u,y]=l.useState(""),[b,f]=l.useState(""),[x,F]=l.useState(""),[S,n]=l.useState(!1),[_,d]=l.useState(!1),[j,A]=l.useState([]),[v,O]=l.useState([]),[M,Y]=l.useState(!1),[V,$]=l.useState(!1),[T,X]=l.useState({}),[I,ee]=l.useState(null),[C,U]=l.useState({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),{showToast:L}=De(),{getLimit:ne,isLimitReached:fe}=nt();l.useEffect(()=>{Q()},[]);const Q=async()=>{try{const r=await z.get("/integrations/telegram/status");o(r.data),r.data.connected&&re()}catch(r){console.error("Failed to fetch Telegram status:",r)}finally{c(!1)}},re=async()=>{try{const r=await z.get("/integrations/telegram/channels");A(r.data.channels||[])}catch(r){console.error("Failed to fetch channels:",r)}},ye=async()=>{var r,w;if(!u.trim()){L("Please enter your phone number","error");return}d(!0);try{const k=await z.post("/integrations/telegram/auth/start",{phone_number:u});L("Verification code sent to your Telegram app","success"),g(1)}catch(k){L(((w=(r=k.response)==null?void 0:r.data)==null?void 0:w.detail)||"Failed to send code","error")}finally{d(!1)}},N=async()=>{var r,w;if(!b.trim()){L("Please enter the verification code","error");return}d(!0);try{const k=await z.post("/integrations/telegram/auth/verify",{code:b,password:S?x:void 0});k.data.status==="2fa_required"?(n(!0),L("Please enter your 2FA password","warning")):k.data.status==="connected"&&(L("Telegram connected successfully!","success"),g(2),Q())}catch(k){L(((w=(r=k.response)==null?void 0:r.data)==null?void 0:w.detail)||"Verification failed","error")}finally{d(!1)}},q=async()=>{if(confirm("Disconnect Telegram? You will stop receiving deals from your channels."))try{await z.delete("/integrations/telegram/disconnect"),o({connected:!1}),A([]),g(0),y(""),f(""),L("Telegram disconnected","success")}catch{L("Failed to disconnect","error")}},se=async()=>{var r,w;$(!0);try{const k=await z.get("/integrations/telegram/channels/available");O(k.data.channels||[]),Y(!0)}catch(k){L(((w=(r=k.response)==null?void 0:r.data)==null?void 0:w.detail)||"Failed to fetch channels","error")}finally{$(!1)}},ce=r=>{ee(r),U({...C,supplierName:r.title||r.name||""})},_e=async(r=null)=>{var k,B;const w=r||I;if(w)try{const le={channel_id:w.id,channel_name:w.name||w.title,channel_username:w.username,channel_type:w.type||"channel",create_supplier:C.createSupplier,supplier_name:C.supplierName||w.name||w.title,supplier_website:C.supplierWebsite||null,supplier_contact_email:C.supplierEmail||null,supplier_notes:C.supplierNotes||null},be=await z.post("/integrations/telegram/channels",le);L(`Added ${w.name}${be.data.supplier_id?" and created supplier":""}`,"success"),ee(null),U({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""}),re(),Q(),O(ve=>ve.map(s=>s.id===w.id?{...s,is_monitored:!0}:s)),M&&Y(!1)}catch(le){L(((B=(k=le.response)==null?void 0:k.data)==null?void 0:B.detail)||"Failed to add channel","error")}},Le=async r=>{var w,k;X(B=>({...B,[r]:!0}));try{const B=await z.post(`/integrations/telegram/channels/${r}/backfill?days=14`);L(`Synced ${B.data.messages} messages, found ${B.data.deals} deals`,"success"),re()}catch(B){L("Failed to sync: "+(((k=(w=B.response)==null?void 0:w.data)==null?void 0:k.detail)||B.message),"error")}finally{X(B=>({...B,[r]:!1}))}},ke=async r=>{try{await z.delete(`/integrations/telegram/channels/${r}`),L("Channel removed","success"),re(),Q()}catch{L("Failed to remove channel","error")}},ze=async()=>{var r,w;try{const k=await z.post("/integrations/telegram/monitoring/start");L(`Monitoring ${k.data.channels} channels`,"success"),Q()}catch(k){L(((w=(r=k.response)==null?void 0:r.data)==null?void 0:w.detail)||"Failed to start monitoring","error")}},Pe=async()=>{try{await z.post("/integrations/telegram/monitoring/stop"),L("Monitoring stopped","success"),Q()}catch{L("Failed to stop monitoring","error")}};return i?e.jsx(H,{children:e.jsx(K,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(te,{})})}):e.jsx(H,{children:e.jsxs(K,{children:[e.jsxs(p,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:2,children:[e.jsxs(p,{children:[e.jsxs(p,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(je,{size:20,style:{color:"#0088cc"}}),e.jsx(h,{variant:"h6",fontWeight:600,children:"Telegram Monitoring"}),e.jsx(oe,{icon:t!=null&&t.connected?e.jsx(Ne,{size:16}):void 0,label:t!=null&&t.connected?"Connected":"Not Connected",color:t!=null&&t.connected?"success":"default",size:"small"}),(t==null?void 0:t.monitoring)&&e.jsx(oe,{label:"Monitoring",color:"primary",size:"small"})]}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Auto-extract deals from supplier channels"})]}),(t==null?void 0:t.connected)&&e.jsx(P,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(Ze,{size:18}),onClick:q,children:"Disconnect"})]}),!(t!=null&&t.connected)&&e.jsxs(p,{children:[e.jsx(Xt,{activeStep:m,sx:{mb:3},children:na.map(r=>e.jsx(_t,{children:e.jsx(Qe,{children:r})},r))}),m===0&&e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:2,children:"Enter your phone number to connect your Telegram account. We'll send a verification code to your Telegram app."}),e.jsx(R,{label:"Phone Number",placeholder:"+1 234 567 8900",value:u,onChange:r=>y(r.target.value),fullWidth:!0,sx:{mb:2},helperText:"Include country code (e.g., +1 for US)"}),e.jsx(P,{variant:"contained",onClick:ye,disabled:_,startIcon:_?e.jsx(te,{size:16}):e.jsx(je,{size:18}),sx:{bgcolor:"#0088cc","&:hover":{bgcolor:"#006699"}},children:_?"Sending...":"Send Code"})]}),m===1&&e.jsxs(p,{children:[e.jsx(G,{severity:"info",sx:{mb:2},children:"Check your Telegram app for the verification code"}),e.jsx(R,{label:"Verification Code",placeholder:"12345",value:b,onChange:r=>f(r.target.value.replace(/\D/g,"")),fullWidth:!0,autoFocus:!0,inputProps:{maxLength:5,inputMode:"numeric",pattern:"[0-9]*"},sx:{mb:2},helperText:"Enter the 5-digit code from Telegram"}),S&&e.jsx(R,{label:"2FA Password",type:"password",autoComplete:"current-password",value:x,onChange:r=>F(r.target.value),fullWidth:!0,sx:{mb:2},helperText:"Your Telegram 2FA password"}),e.jsxs(p,{display:"flex",gap:1,children:[e.jsx(P,{variant:"outlined",onClick:()=>{g(0),f(""),n(!1)},children:"Back"}),e.jsx(P,{variant:"contained",onClick:N,disabled:_,startIcon:_?e.jsx(te,{size:16}):e.jsx(Ne,{size:18}),children:_?"Verifying...":"Verify"})]})]})]}),(t==null?void 0:t.connected)&&e.jsxs(p,{children:[e.jsx(p,{mb:2,children:e.jsx(rt,{label:"Monitored Channels",used:j.length,limit:(t==null?void 0:t.channel_limit)||ne("telegram_channels")})}),e.jsxs(p,{display:"flex",gap:1,mb:2,children:[t!=null&&t.monitoring?e.jsx(P,{variant:"outlined",color:"warning",startIcon:e.jsx(ea,{size:18}),onClick:Pe,children:"Stop Monitoring"}):e.jsx(P,{variant:"contained",color:"success",startIcon:e.jsx(Qt,{size:18}),onClick:ze,disabled:j.length===0,children:"Start Monitoring"}),e.jsx(P,{variant:"outlined",startIcon:V?e.jsx(te,{size:16}):e.jsx(ht,{size:18}),onClick:se,disabled:V||fe("telegram_channels",j.length),children:"Add Channel"})]}),(j||[]).length>0?e.jsx(We,{dense:!0,children:(j||[]).map(r=>e.jsxs(Re,{children:[e.jsx(Ue,{children:e.jsx(je,{size:18,style:{color:a.palette.primary.main}})}),e.jsx(Ee,{primary:r.channel_name,secondary:e.jsxs(p,{display:"flex",gap:2,children:[e.jsxs("span",{children:[r.messages_received||0," messages"]}),e.jsxs("span",{children:[r.deals_extracted||0," deals"]})]}),secondaryTypographyProps:{component:"div"}}),e.jsx(st,{children:e.jsxs(p,{display:"flex",gap:1,alignItems:"center",children:[e.jsx($e,{title:"Sync last 14 days of messages",children:e.jsx(P,{size:"small",variant:"outlined",onClick:()=>Le(r.channel_id),disabled:T[r.channel_id],startIcon:T[r.channel_id]?e.jsx(te,{size:14}):e.jsx(Zt,{size:14}),children:T[r.channel_id]?"Syncing...":"Sync 14 Days"})}),e.jsx($e,{title:"Remove channel",children:e.jsx(ot,{edge:"end",size:"small",onClick:()=>ke(r.channel_id),children:e.jsx(mt,{size:18})})})]})})]},r.id))}):e.jsx(G,{severity:"info",children:'No channels added yet. Click "Add Channel" to select channels to monitor.'}),(t==null?void 0:t.monitoring)&&e.jsxs(p,{mt:2,p:2,sx:{bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:2},children:[e.jsx(h,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Monitoring Active"}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Deals will be automatically extracted and appear in your feed."})]})]}),e.jsxs(Ke,{open:M,onClose:()=>{Y(!1),ee(null),U({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ge,{children:"Add Telegram Channel"}),e.jsx(Je,{dividers:!0,children:(v||[]).length>0?e.jsxs(e.Fragment,{children:[e.jsx(We,{children:(v||[]).map(r=>e.jsxs(Re,{button:!0,selected:(I==null?void 0:I.id)===r.id,onClick:()=>ce(r),children:[e.jsx(Ue,{children:e.jsx(je,{size:20})}),e.jsx(Ee,{primary:r.name,secondary:`${r.type} â€¢ ${r.member_count||"?"} members`}),r.is_monitored&&e.jsx(oe,{label:"Monitoring",size:"small",color:"success",sx:{ml:2}})]},r.id))}),I&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{sx:{my:2}}),e.jsxs(p,{sx:{mb:2,p:2,bgcolor:"#252540",borderRadius:2},children:[e.jsxs(h,{variant:"subtitle2",color:"primary",children:["Selected: ",I.name||I.title]}),e.jsxs(h,{variant:"caption",color:"text.secondary",children:["@",I.username||"no-username"]})]}),e.jsx(Se,{control:e.jsx(xt,{checked:C.createSupplier,onChange:r=>U({...C,createSupplier:r.target.checked})}),label:"Create as Supplier"}),C.createSupplier&&e.jsxs(p,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(R,{label:"Supplier Name",value:C.supplierName,onChange:r=>U({...C,supplierName:r.target.value}),placeholder:(I==null?void 0:I.name)||(I==null?void 0:I.title)||"Supplier name",fullWidth:!0,size:"small"}),e.jsx(R,{label:"Website (optional)",value:C.supplierWebsite,onChange:r=>U({...C,supplierWebsite:r.target.value}),placeholder:"https://...",fullWidth:!0,size:"small"}),e.jsx(R,{label:"Contact Email (optional)",value:C.supplierEmail,onChange:r=>U({...C,supplierEmail:r.target.value}),placeholder:"contact@supplier.com",fullWidth:!0,size:"small"}),e.jsx(R,{label:"Notes (optional)",value:C.supplierNotes,onChange:r=>U({...C,supplierNotes:r.target.value}),placeholder:"Any notes about this supplier...",multiline:!0,rows:2,fullWidth:!0,size:"small"})]})]})]}):e.jsx(h,{color:"text.secondary",textAlign:"center",py:4,children:"No channels found. Make sure you're a member of some Telegram channels or groups."})}),e.jsxs(Xe,{children:[e.jsx(P,{onClick:()=>{Y(!1),ee(null),U({createSupplier:!0,supplierName:"",supplierWebsite:"",supplierEmail:"",supplierNotes:""})},children:"Cancel"}),e.jsx(P,{variant:"contained",onClick:()=>_e(),disabled:!I||fe("telegram_channels",j.length),children:"Add Channel"})]})]})]})})},ba=()=>{var le,be,ve;const[a]=He(),t=a.get("tab"),o={profile:0,integrations:1,alerts:2,costs:3,billing:4},i=t&&o[t]!==void 0?o[t]:0,[c,m]=l.useState(i);l.useEffect(()=>{t&&o[t]!==void 0&&m(o[t])},[t,a]);const{profile:g,alertSettings:u,costSettings:y,loading:b,updateProfile:f,updateAlertSettings:x,updateCostSettings:F}=ta(),{showToast:S}=De(),{subscription:n,openPortal:_,cancelSubscription:d,reactivateSubscription:j}=it(),A=ct(),[v,O]=l.useState([]),[M,Y]=l.useState(null),[V,$]=l.useState(!1),[T,X]=l.useState(!1),[I,ee]=l.useState({full_name:"",avatar_url:""}),[C,U]=l.useState({current_password:"",new_password:"",confirm_password:""}),[L,ne]=l.useState(""),[fe,Q]=l.useState(!1),[re,ye]=l.useState(!1),[N,q]=l.useState({min_roi:20,min_profit:3,max_rank:1e5,alerts_enabled:!0,alert_min_roi:30,alert_channels:["push","email"]}),[se,ce]=l.useState({default_prep_cost:.5,default_inbound_shipping:.5});l.useEffect(()=>{g&&ee({full_name:g.full_name||"",avatar_url:g.avatar_url||""})},[g]),l.useEffect(()=>{u&&q({min_roi:u.min_roi||20,min_profit:u.min_profit||3,max_rank:u.max_rank||1e5,alerts_enabled:u.alerts_enabled!==!1,alert_min_roi:u.alert_min_roi||30,alert_channels:u.alert_channels||["push","email"]})},[u]),l.useEffect(()=>{y&&ce({default_prep_cost:y.default_prep_cost||.5,default_inbound_shipping:y.default_inbound_shipping||.5})},[y]),l.useEffect(()=>{c===4&&(_e(),Le())},[c]);const _e=async()=>{try{const s=await z.get("/billing/invoices");O(s.data.invoices||[])}catch(s){console.error("Failed to fetch invoices:",s)}},Le=async()=>{try{const s=await z.get("/billing/usage");Y(s.data)}catch(s){console.error("Failed to fetch usage:",s)}},ke=async(s=!1)=>{var W,Z;X(!0);try{s?(await z.post("/billing/cancel-immediately"),S("Subscription cancelled. You've been moved to the Free plan.","info")):(await d(!0),S("Subscription will cancel at end of billing period","info")),$(!1),window.location.reload()}catch(et){S(((Z=(W=et.response)==null?void 0:W.data)==null?void 0:Z.detail)||"Failed to cancel subscription","error")}finally{X(!1)}},ze=async()=>{X(!0);try{await j(),S("Subscription reactivated","success")}catch{S("Failed to reactivate subscription","error")}finally{X(!1)}},Pe=async()=>{X(!0);try{await _()}catch{S("Failed to open billing portal","error"),X(!1)}},r=async()=>{try{await f(I),S("Profile updated successfully","success")}catch(s){S(s.message||"Failed to update profile","error")}},w=async()=>{try{await x(N),S("Alert settings saved","success")}catch(s){S(s.message||"Failed to save alert settings","error")}},k=async()=>{try{await F(se),S("Cost settings saved","success")}catch(s){S(s.message||"Failed to save cost settings","error")}},B=async()=>{if(ne(""),Q(!1),C.new_password!==C.confirm_password){ne("New passwords do not match");return}if(C.new_password.length<8){ne("Password must be at least 8 characters");return}ye(!0);try{const{data:{user:s}}=await Fe.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:W}=await Fe.auth.signInWithPassword({email:s.email,password:C.current_password});if(W){ne("Current password is incorrect"),S("Current password is incorrect","error");return}const{error:Z}=await Fe.auth.updateUser({password:C.new_password});if(Z)throw Z;Q(!0),U({current_password:"",new_password:"",confirm_password:""}),S("Password changed successfully","success")}catch(s){ne(s.message||"Failed to change password"),S(s.message||"Failed to change password","error")}finally{ye(!1)}};return b?e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(te,{})}):e.jsxs(p,{children:[e.jsx(h,{variant:"h4",fontWeight:700,mb:4,children:"Settings"}),e.jsxs(gt,{value:c,onChange:(s,W)=>m(W),sx:{mb:4},children:[e.jsx(de,{label:"Profile"}),e.jsx(de,{label:"Integrations"}),e.jsx(de,{label:"Alerts"}),e.jsx(de,{label:"Costs"}),e.jsx(de,{label:"Billing"})]}),c===0&&e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Profile Settings"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(R,{label:"Full Name",value:I.full_name,onChange:s=>ee({...I,full_name:s.target.value}),fullWidth:!0}),e.jsx(R,{label:"Avatar URL",value:I.avatar_url,onChange:s=>ee({...I,avatar_url:s.target.value}),fullWidth:!0,placeholder:"https://..."}),e.jsx(P,{variant:"contained",onClick:r,sx:{backgroundColor:E.purple.main,"&:hover":{backgroundColor:E.purple.dark},alignSelf:"flex-start"},children:"Save Profile"})]})]})}),e.jsx(H,{sx:{mt:3},children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Change Password"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[L&&e.jsx(G,{severity:"error",children:L}),fe&&e.jsx(G,{severity:"success",children:"Password changed successfully!"}),e.jsx(R,{label:"Current Password",type:"password",autoComplete:"current-password",value:C.current_password,onChange:s=>U({...C,current_password:s.target.value}),fullWidth:!0,required:!0}),e.jsx(R,{label:"New Password",type:"password",autoComplete:"new-password",value:C.new_password,onChange:s=>U({...C,new_password:s.target.value}),fullWidth:!0,required:!0,inputProps:{minLength:8},helperText:"Must be at least 8 characters"}),e.jsx(R,{label:"Confirm New Password",type:"password",autoComplete:"new-password",value:C.confirm_password,onChange:s=>U({...C,confirm_password:s.target.value}),fullWidth:!0,required:!0}),e.jsx(P,{variant:"contained",onClick:B,disabled:re,sx:{backgroundColor:E.purple.main,"&:hover":{backgroundColor:E.purple.dark},alignSelf:"flex-start"},children:re?"Changing...":"Change Password"})]})]})})]}),c===1&&e.jsxs(p,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(aa,{}),e.jsx(ra,{})]}),c===2&&e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Alert Settings"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI for alerts"}),e.jsx(Be,{value:N.alert_min_roi,onChange:(s,W)=>q({...N,alert_min_roi:W}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:s=>`${s}%`})]}),e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:1,children:"Minimum ROI to consider profitable"}),e.jsx(Be,{value:N.min_roi,onChange:(s,W)=>q({...N,min_roi:W}),min:0,max:100,valueLabelDisplay:"auto",valueLabelFormat:s=>`${s}%`})]}),e.jsx(R,{label:"Minimum profit per unit",type:"number",value:N.min_profit,onChange:s=>q({...N,min_profit:parseFloat(s.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0}),e.jsx(R,{label:"Maximum sales rank",type:"number",value:N.max_rank,onChange:s=>q({...N,max_rank:parseInt(s.target.value)||0}),fullWidth:!0}),e.jsx(Se,{control:e.jsx(Ae,{checked:N.alerts_enabled,onChange:s=>q({...N,alerts_enabled:s.target.checked})}),label:"Enable alerts"}),e.jsxs(p,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",mb:1,children:"Notification Channels"}),e.jsx(Se,{control:e.jsx(Ae,{checked:(le=N.alert_channels)==null?void 0:le.includes("push"),onChange:s=>{const W=N.alert_channels||[];s.target.checked?q({...N,alert_channels:[...W,"push"]}):q({...N,alert_channels:W.filter(Z=>Z!=="push")})}}),label:"Push notifications"}),e.jsx(Se,{control:e.jsx(Ae,{checked:(be=N.alert_channels)==null?void 0:be.includes("email"),onChange:s=>{const W=N.alert_channels||[];s.target.checked?q({...N,alert_channels:[...W,"email"]}):q({...N,alert_channels:W.filter(Z=>Z!=="email")})}}),label:"Email alerts"})]}),e.jsx(P,{variant:"contained",onClick:w,sx:{backgroundColor:E.purple.main,"&:hover":{backgroundColor:E.purple.dark},alignSelf:"flex-start"},children:"Save Settings"})]})]})}),c===3&&e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:3,children:"Cost Settings"}),e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(R,{label:"Default Prep Cost",type:"number",value:se.default_prep_cost,onChange:s=>ce({...se,default_prep_cost:parseFloat(s.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0,helperText:"Default cost per unit for prep/packaging"}),e.jsx(R,{label:"Default Inbound Shipping",type:"number",value:se.default_inbound_shipping,onChange:s=>ce({...se,default_inbound_shipping:parseFloat(s.target.value)||0}),InputProps:{startAdornment:"$"},fullWidth:!0,helperText:"Default cost per unit for inbound shipping to Amazon"}),e.jsx(P,{variant:"contained",onClick:k,sx:{backgroundColor:E.purple.main,"&:hover":{backgroundColor:E.purple.dark},alignSelf:"flex-start"},children:"Save Cost Settings"})]})]})}),c===4&&e.jsxs(p,{display:"flex",flexDirection:"column",gap:3,children:[e.jsx(H,{children:e.jsxs(K,{children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(p,{children:[e.jsx(h,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Current Plan"}),e.jsxs(p,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(oe,{label:((ve=n==null?void 0:n.tier)==null?void 0:ve.toUpperCase())||"FREE",color:(n==null?void 0:n.tier)==="free"?"default":"primary",sx:{fontWeight:600}}),(n==null?void 0:n.cancel_at_period_end)&&e.jsx(oe,{label:"Cancels at period end",color:"warning",size:"small"})]}),(n==null?void 0:n.status)==="trialing"&&(n==null?void 0:n.trial_end)&&e.jsxs(G,{severity:"info",sx:{mt:1,mb:1},children:["ðŸŽ‰ Free trial ends ",new Date(n.trial_end).toLocaleDateString()]}),(n==null?void 0:n.current_period_end)&&(n==null?void 0:n.status)!=="trialing"&&e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Renews: ",new Date(n.current_period_end).toLocaleDateString()]}),(n==null?void 0:n.cancel_at_period_end)&&e.jsxs(G,{severity:"warning",sx:{mt:1},children:["âš ï¸ Cancels on ",n!=null&&n.current_period_end?new Date(n.current_period_end).toLocaleDateString():"period end"]})]}),e.jsxs(p,{display:"flex",gap:1,children:[n!=null&&n.cancel_at_period_end?e.jsx(P,{variant:"outlined",onClick:ze,disabled:T,children:"Reactivate"}):(n==null?void 0:n.tier)!=="free"?e.jsx(P,{variant:"outlined",color:"error",onClick:()=>$(!0),disabled:T,children:"Cancel"}):null,e.jsx(P,{variant:"contained",onClick:()=>A("/pricing"),sx:{backgroundColor:E.purple.main,"&:hover":{backgroundColor:E.purple.dark}},children:(n==null?void 0:n.tier)==="free"?"Upgrade":"Change Plan"})]})]}),(n==null?void 0:n.tier)!=="free"&&e.jsx(P,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(dt,{size:18}),onClick:Pe,disabled:T,sx:{mt:2},children:"Manage Billing & Payment Methods"})]})}),M&&e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:2,children:"Usage This Period"}),e.jsxs(p,{mb:2,children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(h,{variant:"body2",color:"text.secondary",children:"Analyses"}),e.jsxs(h,{variant:"body2",fontWeight:600,children:[M.analyses.used," / ",M.analyses.unlimited?"âˆž":M.analyses.limit]})]}),!M.analyses.unlimited&&e.jsx(pt,{variant:"determinate",value:Math.min(M.analyses.used/M.analyses.limit*100,100),sx:{height:8,borderRadius:4,backgroundColor:E.gray[200],"& .MuiLinearProgress-bar":{backgroundColor:M.analyses.used>=M.analyses.limit*.9?E.error.main:E.purple.main}}})]})]})}),e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(h,{variant:"h6",fontWeight:600,mb:2,children:"Invoice History"}),v.length===0?e.jsx(h,{variant:"body2",color:"text.secondary",children:"No invoices yet"}):e.jsx(ft,{size:"small",children:e.jsx(yt,{children:v.map(s=>e.jsxs(bt,{children:[e.jsx(Ce,{children:e.jsx(h,{variant:"body2",fontWeight:600,children:new Date(s.created_at).toLocaleDateString()})}),e.jsx(Ce,{children:e.jsx(h,{variant:"body2",color:"text.secondary",children:ut((s.amount_paid||s.amount_due||0)/100)})}),e.jsx(Ce,{children:e.jsx(oe,{label:s.status,size:"small",color:s.status==="paid"?"success":"default"})}),e.jsx(Ce,{align:"right",children:s.stripe_invoice_url&&e.jsx(P,{size:"small",startIcon:e.jsx(vt,{size:14}),href:s.stripe_invoice_url,target:"_blank",children:"View"})})]},s.id))})})]})}),e.jsxs(Ke,{open:V,onClose:()=>$(!1),children:[e.jsx(Ge,{children:"Cancel Subscription?"}),e.jsx(Je,{children:(n==null?void 0:n.status)==="trialing"?e.jsxs(e.Fragment,{children:[e.jsx(G,{severity:"warning",sx:{mb:2},children:"Your trial will end immediately and you'll be downgraded to the Free plan."}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"You can resubscribe anytime, but won't be eligible for another free trial."})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{severity:"warning",sx:{mb:2},children:"Your subscription will remain active until the end of your current billing period. You'll continue to have access to all features until then."}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"After cancellation, you'll be moved to the Free plan. You can reactivate anytime."})]})}),e.jsxs(Xe,{children:[e.jsx(P,{onClick:()=>$(!1),children:"Keep Subscription"}),e.jsx(P,{onClick:()=>ke((n==null?void 0:n.status)==="trialing"),color:"error",variant:"contained",disabled:T,children:T?"Canceling...":"Yes, Cancel"})]})]})]})]})};export{ba as default};
